<!DOCTYPE HTML>
<html lang="default">
    



<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="烽火项目分类任务总结, Dian.AI CV ADV NLP DeepLearning MachineLearning 逯润雨 Lurunyu CV,NLP,ADV 深度学习">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="KeoTn_OFy4ndJwXNmm2gMeQfPhd7alqE9vQDwI32KCY">
    <meta name="description" content="
项目GitHub仓库地址：https://github.com/LRY89757/mmdet-for-fenghuo

2021.11.29日晚更新远程仓库创建成功，仓库地址：烽火检测
目前需要做的事情：

写一个关于这类Labelme文">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>烽火项目分类任务总结 | LRY&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/lightgallery/1.6.12/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <style type="text/css">
        
            
            code[class*="language-"],
            pre[class*="language-"] {
                white-space: pre !important;
            }

        
    </style>

    <script src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

    <body>

        <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://dian.org.cn/static/dian/images/logo.dd99a9865177.gif" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">LRY's Blog</span>
                </a>
            </div>
            


<!-- <a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>Index</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>Tags</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>Categories</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>Archives</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/galleries" class="waves-effect waves-light">
            
            <i class="fa fa-photo"></i>
            
            <span>Galleries</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>About</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-envelope"></i>
            
            <span>Contact</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>Friends</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="Search"></i>
        </a>
    </li>
</ul> -->

<!-- 支持二级菜单特性   -->
<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right nav-menu">
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/" class="waves-effect waves-light">
              
                <i class="fa fa-home"></i>
              
              <span>Index</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/tags" class="waves-effect waves-light">
              
                <i class="fa fa-tags"></i>
              
              <span>Tags</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/categories" class="waves-effect waves-light">
              
                <i class="fa fa-bookmark"></i>
              
              <span>Categories</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/archives" class="waves-effect waves-light">
              
                <i class="fa fa-archive"></i>
              
              <span>Archives</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/galleries" class="waves-effect waves-light">
              
                <i class="fa fa-photo"></i>
              
              <span>Galleries</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/about" class="waves-effect waves-light">
              
                <i class="fa fa-user-circle-o"></i>
              
              <span>About</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/contact" class="waves-effect waves-light">
              
                <i class="fa fa-envelope"></i>
              
              <span>Contact</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/friends" class="waves-effect waves-light">
              
                <i class="fa fa-address-book"></i>
              
              <span>Friends</span>
            </a>

            
      </li>
    

    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="Search"></i>
        </a>
    </li>

</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://dian.org.cn/static/dian/images/logo.dd99a9865177.gif" class="logo-img circle responsive-img">
        
        <div class="logo-name">LRY's Blog</div>
        <div class="logo-desc">
            
            华中科技大学 | 计算机科学与技术 | 深度学习
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                Index
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                Tags
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                Categories
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                Archives
            </a>
        </li>
        
        <li>
            <a href="/galleries" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-photo"></i>
                
                Galleries
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                About
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-envelope"></i>
                
                Contact
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                Friends
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/LRY89757" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>

   
   
<!-- 支持二级菜单特性   -->
<!-- <ul class="menu-list mobile-menu-list">
    
        <li class="m-nav-item">
                
                    <a href="/" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-home"></i>
                        
                        Index
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/tags" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-tags"></i>
                        
                        Tags
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/categories" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-bookmark"></i>
                        
                        Categories
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/archives" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-archive"></i>
                        
                        Archives
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/galleries" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-photo"></i>
                        
                        Galleries
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/about" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-user-circle-o"></i>
                        
                        About
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/contact" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-envelope"></i>
                        
                        Contact
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/friends" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-address-book"></i>
                        
                        Friends
                    </a>
              
            </li>
        

        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/LRY89757" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul> -->

</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/LRY89757" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

        



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/6.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        烽火项目分类任务总结
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        
<!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/深度学习/" target="_blank">
                                <span class="chip bg-color">深度学习</span>
                            </a>
                        
                            <a href="/tags/烽火集团/" target="_blank">
                                <span class="chip bg-color">烽火集团</span>
                            </a>
                        
                            <a href="/tags/项目/" target="_blank">
                                <span class="chip bg-color">项目</span>
                            </a>
                        
                            <a href="/tags/图像处理/" target="_blank">
                                <span class="chip bg-color">图像处理</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/深度学习/" class="post-category" target="_blank">
                                深度学习
                            </a>
                        
                    </div>
                    
                </div>
            </div>
            
            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-12-05
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>Author:&nbsp;&nbsp;
                    
                        逯润雨
                    
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>Words:&nbsp;&nbsp;
                        7.4k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>Read Times:&nbsp;&nbsp;
                        31 Min
                    </div>
                    
                
                
                
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        <i class="fa fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv" ></span>
    
                

            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>项目GitHub仓库地址：<a href="https://github.com/LRY89757/mmdet-for-fenghuo" target="_blank" rel="noopener">https://github.com/LRY89757/mmdet-for-fenghuo</a></p>
</blockquote>
<h1 id="2021-11-29日晚更新"><a href="#2021-11-29日晚更新" class="headerlink" title="2021.11.29日晚更新"></a>2021.11.29日晚更新</h1><p>远程仓库创建成功，仓库地址：<a href="https://github.com/LRY89757/mmdet-for-fenghuo" target="_blank" rel="noopener">烽火检测</a></p>
<p>目前需要做的事情：</p>
<ul>
<li>写一个关于这类Labelme文档需要的dataloader，写一个尽量比较全面适配性比较强、可迁移性比较好的dataloader</li>
<li>对于运行出来的结果的图像做一个简单的切分，平均分为19份然后将每一个单独的盘都crop出来然后将非盘区域标黑放到resnet101等各类分类网络中进行相关的分类任务。</li>
<li>划分测试集和训练集的时候选择使用生成val.txt还有train.txt文件的格式，每个.txt文件内防止相关数据的路径。而不是将其复制到一个新的文件夹中进行分类，万一硬盘没有那么大的空间怎么办，不要滥用硬盘资源。</li>
</ul>
<h1 id="2021-11-30日晚更新"><a href="#2021-11-30日晚更新" class="headerlink" title="2021.11.30日晚更新"></a>2021.11.30日晚更新</h1><p>目前已经确定本周现做第二项，就是做一下目前盘符的分类操作。</p>
<p>目前第一步遇到的困难就是暂时不知道我们<code>inference_detector()</code>这个函数得到的结果的大致形式。因为之前做分割的时候直接将结果放到函数的参数中<code>model.show_result(img, result, out_file=f&#39;/home/lry/projects/mmdetection/lry/demo{i}.jpg&#39;)</code>来显示结果了，再加上我本来对这个也不太熟悉，所以目前打算深入理解下关于函数<code>inference_detector()</code>，顺便将这一系列有关的都了解一下：<code>init_detector,inference_detector, show_result_pyplot</code>,这些都是源于库<code>mmdet.apis</code>,所以我们来找一下<a href="https://mmdetection.readthedocs.io/en/latest/api.html" target="_blank" rel="noopener">官方文档</a>关于mmdet.apis的有关解释：<br>实际上有关<code>inference_detector</code>的<a href="https://mmdetection.readthedocs.io/en/latest/api.html#mmdet.apis.inference_detector" target="_blank" rel="noopener">内容</a>十分有限：</p>
<blockquote>
<p>mmdet.apis.inference_detector(<em>model</em>, <em>imgs</em>)<a href="https://mmdetection.readthedocs.io/en/latest/_modules/mmdet/apis/inference.html#inference_detector" target="_blank" rel="noopener">[SOURCE]</a></p>
<p>Inference image(s) with the detector.</p>
<ul>
<li><p>Parameters</p>
<p><strong>model</strong> (<em>nn.Module</em>) – The loaded detector.<strong>imgs</strong> (<em>str/ndarray</em> <em>or</em> <em>list<strong>[</strong>str/ndarray**] or</em> <em>tuple<strong>[</strong>str/ndarray**]</em>) – Either image files or loaded images.</p>
</li>
<li><p>Returns</p>
<p>If imgs is a list or tuple, the same length list type results will be returned, otherwise return the detection results directly.</p>
</li>
</ul>
</blockquote>
<p>当然感兴趣可以去选择看一下有关源码.这里我选择用代码来探索下有关的结果:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> mmdet<span class="token punctuation">.</span>apis <span class="token keyword">import</span> init_detector<span class="token punctuation">,</span>inference_detector<span class="token punctuation">,</span> show_result_pyplot
<span class="token keyword">import</span> mmcv
<span class="token keyword">import</span> os
<span class="token keyword">import</span> glob
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor

config_file <span class="token operator">=</span> <span class="token string">"/home/lry/projects/mmdetection/configs/fenghuo/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo.py"</span>
checkpoint_file <span class="token operator">=</span> <span class="token string">"/home/lry/projects/mmdetection/work_dirs/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo/latest.pth"</span>
model <span class="token operator">=</span> init_detector<span class="token punctuation">(</span>config_file<span class="token punctuation">,</span> checkpoint_file<span class="token punctuation">,</span>device<span class="token operator">=</span><span class="token string">"cuda:3"</span><span class="token punctuation">)</span>

img <span class="token operator">=</span> <span class="token string">'/home/lry/projects/mmdetection/data/780b_std/IMG_20211021_153945.jpg'</span>
result <span class="token operator">=</span> inference_detector<span class="token punctuation">(</span>model<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'\n\n'</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'\n\n'</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
img <span class="token operator">=</span> Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>有关这部分主要就看result的输出到底是什么东西,如果我们想要保存结果到某地或是展示结果可以用<code>model.show_result(img, result, out_file=f&#39;/home/lry/projects/mmdetection/lry/demo{i}.jpg&#39;)</code>来显示.</p>
<p>简单来看下代码运行结果:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">[</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3.6979218e+02</span><span class="token punctuation">,</span> <span class="token number">2.3255410e+03</span><span class="token punctuation">,</span> <span class="token number">2.7979324e+03</span><span class="token punctuation">,</span> <span class="token number">4.2280156e+03</span><span class="token punctuation">,</span>
        <span class="token number">9.9831665e-01</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float32<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 

 <span class="token punctuation">[</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3.6979218e+02</span><span class="token punctuation">,</span> <span class="token number">2.3255410e+03</span><span class="token punctuation">,</span> <span class="token number">2.7979324e+03</span><span class="token punctuation">,</span> <span class="token number">4.2280156e+03</span><span class="token punctuation">,</span>
        <span class="token number">9.9831665e-01</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float32<span class="token punctuation">)</span><span class="token punctuation">]</span> 

 <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3.6979218e+02</span> <span class="token number">2.3255410e+03</span> <span class="token number">2.7979324e+03</span> <span class="token number">4.2280156e+03</span> <span class="token number">9.9831665e-01</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token number">4608</span><span class="token punctuation">,</span> <span class="token number">3456</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4608</span><span class="token punctuation">,</span> <span class="token number">3456</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到,result是一个元组,元组的第一个元素是一个np.array,含有5个元素,5个元素中第一个代表的是检测框的准确度,然后四个参数代表的是图片的检测框的左上右下相关参数,然后第二个元素就是图片分割数据集的分割结果了.这个结果是由True和False组成的和图像本身Tensor大小相同的一个矩阵.(True代表该像素是含有物体的)</p>
<h2 id="Code-Trace-of-mmdet-apis-inference-detector"><a href="#Code-Trace-of-mmdet-apis-inference-detector" class="headerlink" title="Code Trace of mmdet.apis.inference_detector()"></a>Code Trace of <code>mmdet.apis.inference_detector()</code></h2><p>的确刚才我们将这个接口当作黑盒来探索到了他的一些具体功能。这样对于做项目来说非常足够了，但是我们这里深入一下来探索一下他的源码是怎么样的（<del>感谢蒋哥带我飞</del>）。</p>
<p>首先来看我们的inference_detector()源码<code>mmdet/apis/inference.py</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">inference_detector</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> imgs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Inference image(s) with the detector.

    Args:
        model (nn.Module): The loaded detector.
        imgs (str/ndarray or list[str/ndarray] or tuple[str/ndarray]):
           Either image files or loaded images.

    Returns:
        If imgs is a list or tuple, the same length list type results
        will be returned, otherwise return the detection results directly.
    """</span>

    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>imgs<span class="token punctuation">,</span> <span class="token punctuation">(</span>list<span class="token punctuation">,</span> tuple<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        is_batch <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        imgs <span class="token operator">=</span> <span class="token punctuation">[</span>imgs<span class="token punctuation">]</span>
        is_batch <span class="token operator">=</span> <span class="token boolean">False</span>

    cfg <span class="token operator">=</span> model<span class="token punctuation">.</span>cfg
    device <span class="token operator">=</span> next<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>device  <span class="token comment" spellcheck="true"># model device</span>

    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>imgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cfg <span class="token operator">=</span> cfg<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># set loading pipeline type</span>
        cfg<span class="token punctuation">.</span>data<span class="token punctuation">.</span>test<span class="token punctuation">.</span>pipeline<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'LoadImageFromWebcam'</span>

    cfg<span class="token punctuation">.</span>data<span class="token punctuation">.</span>test<span class="token punctuation">.</span>pipeline <span class="token operator">=</span> replace_ImageToTensor<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>data<span class="token punctuation">.</span>test<span class="token punctuation">.</span>pipeline<span class="token punctuation">)</span>
    test_pipeline <span class="token operator">=</span> Compose<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>data<span class="token punctuation">.</span>test<span class="token punctuation">.</span>pipeline<span class="token punctuation">)</span>

    datas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> img <span class="token keyword">in</span> imgs<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># prepare data</span>
        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>img<span class="token punctuation">,</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># directly add img</span>
            data <span class="token operator">=</span> dict<span class="token punctuation">(</span>img<span class="token operator">=</span>img<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># add information into dict</span>
            data <span class="token operator">=</span> dict<span class="token punctuation">(</span>img_info<span class="token operator">=</span>dict<span class="token punctuation">(</span>filename<span class="token operator">=</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> img_prefix<span class="token operator">=</span>None<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># build the data pipeline</span>
        data <span class="token operator">=</span> test_pipeline<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        datas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    data <span class="token operator">=</span> collate<span class="token punctuation">(</span>datas<span class="token punctuation">,</span> samples_per_gpu<span class="token operator">=</span>len<span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># just get the actual data from DataContainer</span>
    data<span class="token punctuation">[</span><span class="token string">'img_metas'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>img_metas<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> img_metas <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'img_metas'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    data<span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>img<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> img <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> next<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>is_cuda<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># scatter to specified GPU</span>
        data <span class="token operator">=</span> scatter<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">[</span>device<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> m <span class="token keyword">in</span> model<span class="token punctuation">.</span>modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">assert</span> <span class="token operator">not</span> isinstance<span class="token punctuation">(</span>
                m<span class="token punctuation">,</span> RoIPool
            <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'CPU inference with RoIPool is not supported currently.'</span>

    <span class="token comment" spellcheck="true"># forward the model</span>
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        results <span class="token operator">=</span> model<span class="token punctuation">(</span>return_loss<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> rescale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>data<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token operator">not</span> is_batch<span class="token punctuation">:</span>
        <span class="token keyword">return</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> results<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>实际上这么长的源码，真正关键的就倒数第六行的代码<code>results = model(return_loss=False, rescale=True, **data)</code>这行代码调用了model来进行推理然后返回了结果results。我们要看model的而model是我们传进来的参数，是我们使用<code>init_detector</code>这个接口来调用的，这个接口使用了我们的config文件以及相关的checkpoint文件。这里config文件已经非常熟悉了，就是利用这个搭建的模型。我们需要看的是关于config文件里面所用的模型。而要最后的输出是由<code>roi_heads</code>，也就是maskrcnn最后一个模块来输出的。我们先追踪一下有关的config文件：<br>首先是我们自己定义的上层的config文件<code>configs/fenghuo/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo.py</code>, 从这里找可以看到我们继承的是<code>_base_ = &#39;../mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py&#39;</code>那么我们继续找到这个模块就<code>configs/mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py</code>,可以看到他继承的是<code>_base_ = &#39;./mask_rcnn_r50_fpn_1x_coco.py&#39;</code>,我们继续找这个文件<code>configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py</code>,这个文件有点像是一个package的<code>__init__.py</code>，就是代码只有所有需要继承的基本类型：</p>
<pre class="line-numbers language-python"><code class="language-python">_base_ <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'../_base_/models/mask_rcnn_r50_fpn.py'</span><span class="token punctuation">,</span>
    <span class="token string">'../_base_/datasets/coco_instance.py'</span><span class="token punctuation">,</span>
    <span class="token string">'../_base_/schedules/schedule_1x.py'</span><span class="token punctuation">,</span> <span class="token string">'../_base_/default_runtime.py'</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里就是一些模型具体配置的继承基类文件，我们想要看模型的<code>roi_heads</code>部分，那么我们就去找<code>&#39;../_base_/models/mask_rcnn_r50_fpn.py&#39;</code>文件。我们可以在<code>configs/_base_/models/mask_rcnn_r50_fpn.py</code>里找到<code>roi_heads</code>的定义:</p>
<pre class="line-numbers language-python"><code class="language-python">    roi_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'StandardRoIHead'</span><span class="token punctuation">,</span>
        bbox_roi_extractor<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>
            roi_layer<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span> output_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        bbox_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'Shared2FCBBoxHead'</span><span class="token punctuation">,</span>
            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            fc_out_channels<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>
            roi_feat_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span>
            num_classes<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>
            bbox_coder<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'DeltaXYWHBBoxCoder'</span><span class="token punctuation">,</span>
                target_means<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                target_stds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            reg_class_agnostic<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
            loss_cls<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            loss_bbox<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'L1Loss'</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mask_roi_extractor<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>
            roi_layer<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span> output_size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mask_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'FCNMaskHead'</span><span class="token punctuation">,</span>
            num_convs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            conv_out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            num_classes<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>
            loss_mask<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里面可以看到整个<code>roi_head</code>都是属于<code>type=&#39;StandardRoIHead&#39;</code>, 由于MMDetection的注册器Registry机制，我们知道我们需要去到<code>mmdet</code>文件夹中去找这些东西，在<code>mmdet/models/roi_heads</code>中我们可以找到<code>mmdet/models/roi_heads/standard_roi_head.py</code>这个文件。<br>然后我们需要从类中寻找关于forward的有关函数，刚开始找的是<code>forward_dummy()</code>这个函数，但是从这个函数中看不到关于cls_score和bbox_pred以及mask_pred的合并有关步骤，或者说不太能对应上，后来打了一些断点发现似乎程序根本不会经过这个函数。所以应该不是经过这个forward函数，而另外的forward函数，首先可以排除<code>forward_train</code>这个函数，或者是排除所有和train有关的函数，因为我们毕竟这个是做的推断，所以我们需要的不是去train，至少也在test里面。</p>
<p>后来经过打断点发现程序运行在<code>simple_test()</code>这个函数里面：</p>
<pre class="line-numbers language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">simple_test</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>
                    x<span class="token punctuation">,</span>
                    proposal_list<span class="token punctuation">,</span>
                    img_metas<span class="token punctuation">,</span>
                    proposals<span class="token operator">=</span>None<span class="token punctuation">,</span>
                    rescale<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Test without augmentation.

        Args:
            x (tuple[Tensor]): Features from upstream network. Each
                has shape (batch_size, c, h, w).
            proposal_list (list(Tensor)): Proposals from rpn head.
                Each has shape (num_proposals, 5), last dimension
                5 represent (x1, y1, x2, y2, score).
            img_metas (list[dict]): Meta information of images.
            rescale (bool): Whether to rescale the results to
                the original image. Default: True.

        Returns:
            list[list[np.ndarray]] or list[tuple]: When no mask branch,
            it is bbox results of each image and classes with type
            `list[list[np.ndarray]]`. The outer list
            corresponds to each image. The inner list
            corresponds to each class. When the model has mask branch,
            it contains bbox results and mask results.
            The outer list corresponds to each image, and first element
            of tuple is bbox results, second element is mask results.
        """</span>
        <span class="token keyword">assert</span> self<span class="token punctuation">.</span>with_bbox<span class="token punctuation">,</span> <span class="token string">'Bbox head must be implemented.'</span>

        det_bboxes<span class="token punctuation">,</span> det_labels <span class="token operator">=</span> self<span class="token punctuation">.</span>simple_test_bboxes<span class="token punctuation">(</span>
            x<span class="token punctuation">,</span> img_metas<span class="token punctuation">,</span> proposal_list<span class="token punctuation">,</span> self<span class="token punctuation">.</span>test_cfg<span class="token punctuation">,</span> rescale<span class="token operator">=</span>rescale<span class="token punctuation">)</span>

        bbox_results <span class="token operator">=</span> <span class="token punctuation">[</span>
            bbox2result<span class="token punctuation">(</span>det_bboxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> det_labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        self<span class="token punctuation">.</span>bbox_head<span class="token punctuation">.</span>num_classes<span class="token punctuation">)</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>det_bboxes<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>with_mask<span class="token punctuation">:</span>
            <span class="token keyword">return</span> bbox_results
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            segm_results <span class="token operator">=</span> self<span class="token punctuation">.</span>simple_test_mask<span class="token punctuation">(</span>
                x<span class="token punctuation">,</span> img_metas<span class="token punctuation">,</span> det_bboxes<span class="token punctuation">,</span> det_labels<span class="token punctuation">,</span> rescale<span class="token operator">=</span>rescale<span class="token punctuation">)</span>
            <span class="token keyword">return</span> list<span class="token punctuation">(</span>zip<span class="token punctuation">(</span>bbox_results<span class="token punctuation">,</span> segm_results<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接着调试发现这里调用了函数bbox2result()来实现了关于转化的一些问题。</p>
<p>实际上到此就结束了，当然<code>forward_dummy()</code>这个函数是非常有研究意义的，在<code>mmdet/models/detectors/two_stage.py</code>里可以看到这个是为了，特别是这里调用了<code>_bbox_forward()</code>这个函数,值得注意一下。</p>
<p>另外我们以上仅仅是讲了一个mask_rcnn的一个很小的<code>roi_head</code>部分，如果要总体看全体的一个概况的话，可以选择去看一下<code>mmdet/models/detectors/two_stage.py</code>虽然也不算是总体，但是也高了一级，可以看一下具体的这个<code>TwoStageDetector</code>是怎么调度的，是如何运行起来的。</p>
<h2 id="dataloader-in-mmdetection"><a href="#dataloader-in-mmdetection" class="headerlink" title="dataloader in mmdetection"></a><strong>dataloader in mmdetection</strong></h2><p>其次是关于这周要做的第一个任务，这个任务实际上就是来做一个Labelme数据的dataloader,当然说起来容易，这个要把dataloader融到MMDetection里面还是需要深入理解他的Rigistry机制的，而且光写代码这一步如果完全不看他的关于COCODataset的代码靠自己写恐怕是非常难办的。所以我们这里一步一步的来探索。</p>
<p>首先我们来找到COCO的dataloader到底在哪里。</p>
<p>还是从config文件开始找，由于上文已经找过了，这里直接引用上文的寻找过程：</p>
<p>“”””</p>
<p>首先是我们自己定义的上层的config文件<code>configs/fenghuo/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo.py</code>, 从这里找可以看到我们继承的是<code>_base_ = &#39;../mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py&#39;</code>那么我们继续找到这个模块就<code>configs/mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py</code>,可以看到他继承的是<code>_base_ = &#39;./mask_rcnn_r50_fpn_1x_coco.py&#39;</code>,我们继续找这个文件<code>configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py</code>,这个文件有点像是一个package的<code>__init__.py</code>，就是代码只有所有需要继承的基本类型：</p>
<p>```python</p>
<p><em>base</em> = [</p>
<p>  ‘../<em>base</em>/models/mask_rcnn_r50_fpn.py’,</p>
<p>  ‘../<em>base</em>/datasets/coco_instance.py’,</p>
<p>  ‘../<em>base</em>/schedules/schedule_1x.py’, ‘../<em>base</em>/default_runtime.py’</p>
<p>]</p>
<p>```</p>
<p>“””</p>
<p>然后我们可以看到在<code>&#39;../_base_/datasets/coco_instance.py&#39;</code>里面，前几行代码就有<code>dataset_type = &#39;CocoDataset&#39;</code>和上文相同的Registry机制，我们到<code>mmdet</code>文件夹中去寻找，可以发现在<code>mmdet/datasets/coco.py</code>里面有<code>CocoDataset</code>这个类。这个就是关于CocoDataset的dataloader.终于找到了！</p>
<p>但是有574行代码……………………蚌埠住了😥。</p>
<h1 id="2021-12-1日上午更新"><a href="#2021-12-1日上午更新" class="headerlink" title="2021.12.1日上午更新"></a>2021.12.1日上午更新</h1><h2 id="dataloader-in-mmdet"><a href="#dataloader-in-mmdet" class="headerlink" title="dataloader in mmdet"></a>dataloader in mmdet</h2><p>再稍微说一下关于Rigistry还有继承类需要做的一些东西。</p>
<p>我们继续从上文中得到的在<code>mmdet/datasets/coco.py</code>中看到的CocoDataset类的内容（仅仅选择了一部分，完整版看<a href="https://github.com/open-mmlab/mmdetection/blob/master/mmdet/datasets/coco.py" target="_blank" rel="noopener">这里</a>）：</p>
<p>```python</p>
<p># Copyright (c) OpenMMLab. All rights reserved.</p>
<p>@DATASETS.register_module()</p>
<p>class CocoDataset(CustomDataset):</p>
<p>  CLASSES = (‘person’, ‘bicycle’, ‘car’, ‘motorcycle’, ‘airplane’, ‘bus’,</p>
<p>​        ‘train’, ‘truck’, ‘boat’, ‘traffic light’, ‘fire hydrant’,</p>
<p>​        ‘stop sign’, ‘parking meter’, ‘bench’, ‘bird’, ‘cat’, ‘dog’,</p>
<p>​        ‘horse’, ‘sheep’, ‘cow’, ‘elephant’, ‘bear’, ‘zebra’, ‘giraffe’,</p>
<p>​        ‘backpack’, ‘umbrella’, ‘handbag’, ‘tie’, ‘suitcase’, ‘frisbee’,</p>
<p>​        ‘skis’, ‘snowboard’, ‘sports ball’, ‘kite’, ‘baseball bat’,</p>
<p>​        ‘baseball glove’, ‘skateboard’, ‘surfboard’, ‘tennis racket’,</p>
<p>​        ‘bottle’, ‘wine glass’, ‘cup’, ‘fork’, ‘knife’, ‘spoon’, ‘bowl’,</p>
<p>​        ‘banana’, ‘apple’, ‘sandwich’, ‘orange’, ‘broccoli’, ‘carrot’,</p>
<p>​        ‘hot dog’, ‘pizza’, ‘donut’, ‘cake’, ‘chair’, ‘couch’,</p>
<p>​        ‘potted plant’, ‘bed’, ‘dining table’, ‘toilet’, ‘tv’, ‘laptop’,</p>
<p>​        ‘mouse’, ‘remote’, ‘keyboard’, ‘cell phone’, ‘microwave’,</p>
<p>​        ‘oven’, ‘toaster’, ‘sink’, ‘refrigerator’, ‘book’, ‘clock’,</p>
<p>​        ‘vase’, ‘scissors’, ‘teddy bear’, ‘hair drier’, ‘toothbrush’)</p>
<p>  def load_annotations(self, ann_file):</p>
<p>​    “””Load annotation from COCO style annotation file.</p>
<p>​    Args:</p>
<p>​      ann_file (str): Path of annotation file.</p>
<p>​    Returns:</p>
<p>```</p>
<p>主要是看一下<code>@DATASETS.register_module()</code>这个装饰器，关于装饰器的语法深入的部分不再说，我们这里只需要知道这个就相当于我们注册了有关的<code>Rigistry</code>,从这个定义之后，我们只需要就像前面一样<code>dataset_type = &#39;CocoDataset&#39;</code>就可以将这个dataloader放到MMdet中。</p>
<p>另外如果自己要写dataloader的话，类需要继承的就是<code>from .custom import CustomDataset</code>中的<code>CustomDataset</code>.</p>
<p>另外我们还要注意的是</p>
<h2 id="图像分割盘符切片数据预处理操作"><a href="#图像分割盘符切片数据预处理操作" class="headerlink" title="图像分割盘符切片数据预处理操作"></a>图像分割盘符切片数据预处理操作</h2><h3 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h3><p>昨天本来打算认真做一下关于盘符分类的任务的，没想到还是最终没有弄，光顾着搞MMdetection的源码这些东西了没有来得及搞，目前已知接口<code>inference_detector</code>返回的result的结果了，就是一个元组tuple，第一个元素是检测框的位置和置信度，然后第二个元素就是分割的结果，是一个与图片大小相同的一个二维矩阵，由True和False组成。</p>
<p>我们接下来开始尝试做图像的处理。</p>
<p>首先构建detector得到一些具体结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/12/01/LqL6m6.png" alt></p>
<h3 id="图像处理算法分析与算法步骤实现"><a href="#图像处理算法分析与算法步骤实现" class="headerlink" title="图像处理算法分析与算法步骤实现"></a>图像处理算法分析与算法步骤实现</h3><h4 id="对于分割的结果预处理"><a href="#对于分割的结果预处理" class="headerlink" title="对于分割的结果预处理"></a>对于分割的结果预处理</h4><p>首先，这个检测框的结果并不是非常靠谱,很明显如果我们选择对得到的bbox来进行均等分割是完全不行的，分割的结果还要好一些相对而言，所以我们这里可以选择考虑一下使用分割数据但是要对分割数据进行一些转换或者是说修补。</p>
<p>目前一个想法是对于分割结果的边界取平均值来得到4条可以用的边组成一个新的bbox。然后我们再对得到的新的bbox进行平均切分成19等份，当然这里没有考虑是否是倾斜的，因为我们要切出的图片要都是水平矩形，然后根据坐标关系将我们切除矩形部分不包含盘符的部分涂黑（所以写代码时不妨先将非盘符部分涂黑。）</p>
<p>目前考虑的算法步骤是：</p>
<ul>
<li><p>根据构建detector得到的分割结果矩阵，根据边界平均思想得到一个 bbox</p>
</li>
<li><p>得到bbox的四个顶点（一定是bbox矩阵最靠左，最靠右，最靠上，最靠下的四个顶点）。</p>
</li>
<li><p>根据四个顶点的关系得到左右的两组边的点，然后根据左右等比例关系标注好中间要切分的18个点，连同着左右两端点都放到一个列表里，上下都要有，（其实也就通过给bbox的矩阵上下两条边等分成19份，以利于后续画图切割。）</p>
</li>
<li><p>开始切割，并选择将图片中非盘符的部分涂黑（这个可以在切割之前就涂黑了）</p>
</li>
<li><p>对一张图片得到的19个盘符标上种类，至于种类可以选择利用当时的json文件来标种类。</p>
</li>
</ul>
<p>细节补充：</p>
<ul>
<li><p>首先通过四个顶点得到一个水平bbox可以写一个函数复用</p>
</li>
<li><p>给定两个顶点将其连线等分割成19份并返回该直线所分坐标列表，或者说给定四个顶点返回切分好的各个小盘符顶点坐标列表（意思就是列表中每个元素都是一个分好的小框的四个顶点坐标）。</p>
</li>
<li><p>涂黑操作定义一个函数，输入为</p>
</li>
<li><p><strong>以上所有的操作都放到一个类里统一处理，然后到时候调用直接构建类的时候就调用了进行完预处理操作。</strong></p>
</li>
</ul>
<h3 id="对于普通标注labelme文件的结果预处理"><a href="#对于普通标注labelme文件的结果预处理" class="headerlink" title="对于普通标注labelme文件的结果预处理"></a><strong>对于普通标注labelme文件的结果预处理</strong></h3><p>因为Labelme文件是对于每一个图片都有一个单独的json文件，然后每一个json文件都会有各个盘符的位置信息还有具体的坐标种类，所以这样一来相比于分割的结果要好很多，所以我们这里思路简单很多：</p>
<ul>
<li><p>读取<code>.json</code>文件</p>
</li>
<li><p>对于将每个小盘符四个顶点转化为一个较大的bbox</p>
</li>
<li><p>大框bbox内非盘符部分涂黑</p>
</li>
<li><p>保存，注意图片标签的保存</p>
</li>
</ul>
<h3 id="普通labelme文件读取分析"><a href="#普通labelme文件读取分析" class="headerlink" title="普通labelme文件读取分析"></a>普通labelme文件读取分析</h3><h1 id="2021-12-2日下午更新"><a href="#2021-12-2日下午更新" class="headerlink" title="2021.12.2日下午更新"></a>2021.12.2日下午更新</h1><p>昨天做了关于数据集的整理操作以及关于数据的转化操作，目前一个成熟的数据集已经转化完成，不过<strong>相关记录文档没有完成</strong>，确实没有时间记录了，等这两天记录一下。<br>同时昨天也写了关于文件的dataloader的读取，这方面还是花了一些心思的，目前接下来的任务就是构建相关模型然后进行有关的训练，当然这里考虑使用不同的有关模型比如说resnet101, regnet这类都尝试一下，当然可以直接从torchvision.models直接导入有关的模型。</p>
<p>这里需要注意的是正好我们可以将整个的模型的训练，数据可视化，调整可视化等等这一系列的操作都尝试学习操作一遍，虽然之前也整过好多遍，但是自从学了mmdetection之后就很少弄了，可以再深入探索一下。</p>
<p>另外</p>
<p>一些参考文档：</p>
<ul>
<li><a href="https://blog.csdn.net/weixin_36670529/article/details/105910572" target="_blank" rel="noopener">https://blog.csdn.net/weixin_36670529/article/details/105910572</a></li>
<li></li>
</ul>
<h1 id="2021-12-3日-amp-amp-4日-amp-amp-5日更新"><a href="#2021-12-3日-amp-amp-4日-amp-amp-5日更新" class="headerlink" title="2021.12.3日&amp;&amp;4日&amp;&amp;5日更新"></a>2021.12.3日&amp;&amp;4日&amp;&amp;5日更新</h1><h2 id="Preface-1"><a href="#Preface-1" class="headerlink" title="Preface"></a>Preface</h2><p>数据处理有关的记录文档昨天已经整理完毕。为了吸取教训，以后还是边写边整理文档比较好，除非是时间过于紧急。</p>
<p>今天就写一下有关模型，根据目前的进展，任务主要如下：</p>
<ul>
<li>关于验证集、训练集的划分</li>
<li>train_one_epoch函数</li>
<li>计算验证集准确率的函数</li>
<li>使用自己的数据集</li>
<li>使用tqdm</li>
</ul>
<h2 id="验证集、训练集的划分"><a href="#验证集、训练集的划分" class="headerlink" title="验证集、训练集的划分"></a>验证集、训练集的划分</h2><p>大概8：2划分，具体难度并不高。仅仅是记得使用函数shutil就OK了。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""本模块用于划分验证集和测试集，大概比例为8：2"""</span>

<span class="token keyword">import</span> shutil
<span class="token keyword">import</span> os
<span class="token keyword">import</span> random
<span class="token keyword">import</span> glob

<span class="token keyword">def</span> <span class="token function">move_file</span><span class="token punctuation">(</span>imgs<span class="token punctuation">,</span>  new_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''这个函数是用来移动图片从旧路径移到新路径'''</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>new_path<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># filelist = os.listdir(old_path) # 列出该目录下的所有文件,listdir返回的文件列表是不包含路径的。</span>
    filelist <span class="token operator">=</span> imgs
    <span class="token keyword">print</span><span class="token punctuation">(</span>filelist<span class="token punctuation">)</span>
    <span class="token keyword">for</span> file <span class="token keyword">in</span> filelist<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># file = file - "/home/lry/data/780b_std/"</span>
        src <span class="token operator">=</span> file
        dst <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>new_path<span class="token punctuation">,</span> file<span class="token punctuation">[</span>len<span class="token punctuation">(</span><span class="token string">'/home/lry/data/780b_singe_padded/'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'src:'</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'dst:'</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
        shutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># old_path = "/home/lry/data/780b_std"</span>

new_val <span class="token operator">=</span> <span class="token string">"/home/lry/data/780b_singe_padded_std/val"</span>
new_train <span class="token operator">=</span> <span class="token string">"/home/lry/data/780b_singe_padded_std/train"</span>

pics <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">"/home/lry/data/780b_singe_padded/*.jpg"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(pics)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>pics<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(pics[0][-30:])</span>
<span class="token comment" spellcheck="true"># print(len(pics))</span>
<span class="token comment" spellcheck="true"># print(pics[0][len("/home/lry/data/780b_std/"):-5] + ".jpg")</span>
<span class="token comment" spellcheck="true"># print(pics[0][:-4])</span>
<span class="token comment" spellcheck="true"># print(pics)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"moving...."</span><span class="token punctuation">)</span>
move_file<span class="token punctuation">(</span>pics<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">702</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train end!"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"moving..."</span><span class="token punctuation">)</span>
move_file<span class="token punctuation">(</span>pics<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">702</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_val<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"val end!"</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># if __name__ == '__main__':</span>
<span class="token comment" spellcheck="true">#     pics = glob.glob("/home/lry/data/780b_singe_padded_std/train/*.jpg")</span>
<span class="token comment" spellcheck="true">#     print(len(pics))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="train-one-epoch函数"><a href="#train-one-epoch函数" class="headerlink" title="train_one_epoch函数"></a>train_one_epoch函数</h2><p>这个具体的不多说，这里就写一下大致的流程：</p>
<ol>
<li>利用dataloader加载数据</li>
<li>数据、模型部署到cudaGPU中</li>
<li>前向传播</li>
<li>计算loss</li>
<li>反向传播计算梯度</li>
<li>调用优化器优化更新权重</li>
<li>在torch.no_grad条件下计算val准确率。</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">train_one_epoch</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> trainloader<span class="token punctuation">,</span> valloader<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> criterion<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    训练一个epoch，返回该epoch的train_loss, train_acc, val_acc准确率
    '''</span>
    device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># train</span>
    correct <span class="token operator">=</span> <span class="token number">0</span>
    total <span class="token operator">=</span> <span class="token number">0</span>
    train_loss <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> data <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>trainloader<span class="token punctuation">)</span><span class="token punctuation">:</span>

        labels<span class="token punctuation">,</span> inputs <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>

        output <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>

        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>output<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>
        train_loss <span class="token operator">+=</span> loss
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>

    train_loss <span class="token operator">=</span> train_loss <span class="token operator">/</span> <span class="token number">2808</span>
    train_acc <span class="token operator">=</span> correct <span class="token operator">/</span> total

    <span class="token comment" spellcheck="true"># val准确率</span>
    correct <span class="token operator">=</span> <span class="token number">0</span>
    total <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> data <span class="token keyword">in</span> valloader<span class="token punctuation">:</span>
            labels<span class="token punctuation">,</span> images <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
            outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
            _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
    val_acc <span class="token operator">=</span> correct <span class="token operator">/</span> total

    <span class="token keyword">return</span> train_loss<span class="token punctuation">,</span> train_acc<span class="token punctuation">,</span> val_acc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="关于导入模型"><a href="#关于导入模型" class="headerlink" title="关于导入模型"></a>关于导入模型</h2><blockquote>
<p>2021.12.4更新。<br>所有模型都在torchvision库里面，其中torchvision.models保存定义了许许多多我们需要的模型。具体导入方式也非常简单：直接<code>torchivision.models.resnet50(pretrained=True)</code>像这类就行,当然如果我们想要改一些东西，比如resnet50最后有一个一层的全连接层，我们想要改一下这个最后全连接层的输出,比方说目前我有14类输出但是torchvision官方的resnet50的model默认最后的全连接层是<code>nn.Linear(2048, 1000)</code>,因为这个是基于<code>Imagenet</code>数据集的。那么如果我们要更改，一个方法是可以查看该模型pytorch定义的源代码，因为<br><code>torchivision.models.resnet50(pretrained=True)</code>这个或者说这类函数是有相关的参数用来改最后全连接层的output的，或者可以选择 直接更改，就像我这里一样：</p>
</blockquote>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 导入模型</span>
model <span class="token operator">=</span> models<span class="token punctuation">.</span>resnet50<span class="token punctuation">(</span>pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(model)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>fc<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 查看默认最后一层全连接层的结构</span>
<span class="token comment" spellcheck="true"># print(type(model.fc))</span>
<span class="token comment" spellcheck="true"># print(dict(model.fc.named_parameters()).keys())</span>
model<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>fc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>就是利用<code>model.fc = nn.Linear(2048, num_classes)</code>来定义最后一层的参数，这个很巧妙实际上，就相当于重新定义了一遍，改了相关的结构。</p>
<h2 id="关于部署到cuda上"><a href="#关于部署到cuda上" class="headerlink" title="关于部署到cuda上"></a>关于部署到cuda上</h2><blockquote>
<p>2021.12.4更新。</p>
</blockquote>
<p>这个我之前一直使用的是关于<code>device = torch.device(&quot;cuda:0&quot; if torch.cuda.is_available() else &quot;cpu&quot;)</code>来指定gpu训练，但是结果却并不是我想的那样在特定的gpu上训练. 这里用到了之前组长建议的一种用法，也是他们常用的做法,甚至当时我还在分割任务中做了的，这是我当时分割任务的运行代码：</p>
<pre class="line-numbers language-python"><code class="language-python">CUDA_VISIBLE_DEVICES<span class="token operator">=</span><span class="token number">1</span> python tools<span class="token operator">/</span>test<span class="token punctuation">.</span>py configs<span class="token operator">/</span>fenghuo<span class="token operator">/</span>mask_rcnn_r50_caffe_fpn_mstrain<span class="token operator">-</span>poly_1x_fenghuo<span class="token punctuation">.</span>py work_dirs<span class="token operator">/</span>mask_rcnn_r50_caffe_fpn_mstrain<span class="token operator">-</span>poly_1x_fenghuo<span class="token operator">/</span>latest<span class="token punctuation">.</span>pth  <span class="token operator">-</span><span class="token operator">-</span>eval bbox segm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>实际上也就是在相关运行python命令前加了<code>CUDA_VISIBLE_DEVICES=1</code>,CUDA：1，有时候要使用多张卡并行可以选择使用逗号分开两张卡，例如：CUDA_VISIBLE_DEVICES=1, 2。<br>这样做之后模型会进行单卡训练，另外当我们要进行实时监控显存和进程相关使用的时候我们可以考虑使用<code>watch</code>命令，比如说使用以下命令：</p>
<pre class="line-numbers language-python"><code class="language-python">watch <span class="token operator">-</span>n <span class="token number">1</span> nvidia<span class="token operator">-</span>smi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这个代表每一秒刷新一次显卡使用情况。<br>关于多卡这方面，是一门大学问，暂时先不在这里展开说。</p>
<h2 id="关于batch-size"><a href="#关于batch-size" class="headerlink" title="关于batch_size"></a>关于batch_size</h2><blockquote>
<p>2021.12.4更新。<br>最一开始的时候调的batch_size=128，但是结果一下子显存不足导致程序终止了。本来我以为这么好的显卡，害。还是我太肤浅了，本身图片大小就不小，一张图片<code>1800×180</code>这么大的图片确实(一般科研或是一些经典数据集训练都是<code>224×224</code>这类大小),再加上这些显存什么的和卡本身是2080ti还是3090没有关系，这个和显存有关系。而这个服务器的显存是12G，也不是很大，所以说最好还是不要用到这么大的batch_size了，后来改成<code>batch_size=4</code>,结果发现仅仅4个batch_size就消耗了几乎4个G的显存，后来试了试将batch_size调至10，结果差不多占了8个G的显存，预计batch_size=16能完全占满，不过这里没有继续实验。</p>
</blockquote>
<h2 id="关于并行GPU计算"><a href="#关于并行GPU计算" class="headerlink" title="关于并行GPU计算"></a>关于并行GPU计算</h2><blockquote>
<p>2021.12.4更新。</p>
</blockquote>
<h2 id="进度条tqdm"><a href="#进度条tqdm" class="headerlink" title="进度条tqdm"></a>进度条tqdm</h2><blockquote>
<p>2021.12.4更新。<br>进度条怎么用，目前我只会用非常基本的，就是用一个<code>tqdm.tqdm()</code>内含一个iterable的参数比如列表这类。然后放到for里面进行循环。当然这似乎对我目前来说算是够了，但是如果想要更进一步的话可以看看<a href="https://github.com/tqdm/tqdm" target="_blank" rel="noopener">GitHub源码地址</a>，也有一个较为详细的introduction.</p>
</blockquote>
<h2 id="任务完成启示与不足"><a href="#任务完成启示与不足" class="headerlink" title="任务完成启示与不足"></a>任务完成启示与不足</h2><p>以上的任务成功写完，模型也成功跑完，结果如下(一个简单的结果)：<br><a href="https://imagelol.com/image/LnBiyC" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/12/03/LnBiyC.png" alt></a><br>目前只是完成了一个小的demo而已，整个项目有着非常多的任务需要继续做，还有好多代码继续写。<br>接下来要完成的以及目前工作的不足在于：</p>
<ul>
<li>标签没有合并来训练，目前各个小类没有合并，仅仅是把每一个小类都分开训练了。</li>
<li>batch_size可以继续调高，因为目前的任务尝试batch_size=4可以发现显存占用了4000多兆，然而服务器单卡2080ti可以使用超过11000兆的显存，所以可以尝试跑满。当然目前4张卡有2张是空闲的，如果要进一步使用2张卡并行的话，可以试试<a href="https://pytorch.org/tutorials/intermediate/ddp_tutorial.html" target="_blank" rel="noopener">DISTRIBUTED DATA PARALLEL</a>,当然这个可能目前比较难，不过可以适当看一看，这样的话batch_size甚至可以调到20。</li>
<li>目前仅仅导入使用了官方的resnet101，还可以试试其他模型</li>
<li>epoch可以往上调调试试</li>
<li><strong>模型、训练log记得保存</strong>，包括一些关键的数据可以放到一个txt文档里面，写代码实现log的记录，可以参考mmdetection，它的记录就非常详细。</li>
</ul>
<h2 id="保存训练权重，模型方法"><a href="#保存训练权重，模型方法" class="headerlink" title="保存训练权重，模型方法"></a>保存训练权重，模型方法</h2><blockquote>
<p>2021.12.4更新。</p>
</blockquote>
<p>主要参考的就是以下文档们：</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/38056115" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/38056115</a></li>
<li><a href="https://blog.csdn.net/weixin_40522801/article/details/106563354" target="_blank" rel="noopener">https://blog.csdn.net/weixin_40522801/article/details/106563354</a></li>
<li><a href="https://pytorch.org/tutorials/beginner/saving_loading_models.html" target="_blank" rel="noopener">https://pytorch.org/tutorials/beginner/saving_loading_models.html</a></li>
</ul>
<p>当然代码写得参考的最开始那篇知乎文档，模型保存代码为：</p>
<pre class="line-numbers language-python"><code class="language-python">launchTimestamp <span class="token operator">=</span> str<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'epoch'</span><span class="token punctuation">:</span> epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'state_dict'</span><span class="token punctuation">:</span> model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'best_loss'</span><span class="token punctuation">:</span> best_loss<span class="token punctuation">,</span>
                            <span class="token string">'optimizer'</span><span class="token punctuation">:</span> optimizer<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                           <span class="token string">'/home/lry/projects/mmdetection/lry/model_classification/checkpoints'</span> <span class="token operator">+</span> <span class="token string">'/resnet50-m-'</span> <span class="token operator">+</span> launchTimestamp <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> str<span class="token punctuation">(</span><span class="token string">"%.4f"</span> <span class="token operator">%</span> best_loss<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.pth.tar'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'model {launchTimestamp} saved!'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>目前还没尝试过加载模型，先不考虑了，以后再说吧。</p>
<h2 id="模型的类别合并"><a href="#模型的类别合并" class="headerlink" title="模型的类别合并"></a>模型的类别合并</h2><blockquote>
<p>2021.12.4更新。<br>这方面实际上大多都是脏活累活，需要介绍的恰恰不太多.<br>不过确实比较考验代码能力。</p>
</blockquote>
<h2 id="关于lr-scheduler"><a href="#关于lr-scheduler" class="headerlink" title="关于lr_scheduler"></a>关于lr_scheduler</h2><blockquote>
<p>2021.12.4更新。<br>参考文档：<a href="https://www.kaggle.com/isbhargav/guide-to-pytorch-learning-rate-scheduling" target="_blank" rel="noopener">https://www.kaggle.com/isbhargav/guide-to-pytorch-learning-rate-scheduling</a></p>
</blockquote>
<h2 id="分类任务完成启示与不足"><a href="#分类任务完成启示与不足" class="headerlink" title="分类任务完成启示与不足"></a>分类任务完成启示与不足</h2><p>本人任务接近收尾，目前还是非常满意的，至少对于结果来说：<br><a href="https://imagelol.com/image/LnTsAT" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/12/03/LnTsAT.png" alt></a></p>
<p>本来我还想进一步尝试一下不同的学习率和一些其他的模型，但是由于本次实验实际上对于任务本身已经完成了，如果想要深入研究可以之后做研究时或是想要探索再说了。<br>而对于本次来看，实际上完全够了。接下来就我个人而言，我想做的一些东西就是：</p>
<ul>
<li><a href="https://pytorch.org/tutorials/intermediate/ddp_tutorial.html" target="_blank" rel="noopener">DISTRIBUTED DATA PARALLEL</a>多卡训练，可以问一下张维天学姐她的多卡训练是怎么弄的。</li>
<li>多看看别人写的pytorch代码，不管是哪一类的代码都行</li>
<li>关于分割任务的iou调节探索</li>
<li>transformer论文的阅读与学习，尤其是关于</li>
<li>写完上面的文档(<del>唉好多文档要写，可以先写多卡训练部分：边学多卡训练边写</del>)</li>
<li>导入模型方式也可以看看<code>hello-dian-ai</code>中的lab2导入预训练backbone的方式。</li>
</ul>
<p>这是截止到本周五我的这五天相关任务代码和时间的统计，python代码敲了16个小时，markdown笔记记了5个小时。总体来看本周三（12.1日）敲得最多，敲了7个多小时python代码。对于工作还是非常满意的！<br><a href="https://imagelol.com/image/LnT0pO" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/12/03/LnT0pO.png" alt></a></p>
<h2 id="DISTRIBUTED-DATA-PARALLEL"><a href="#DISTRIBUTED-DATA-PARALLEL" class="headerlink" title="DISTRIBUTED DATA PARALLEL"></a>DISTRIBUTED DATA PARALLEL</h2><p>Reference:</p>
<ul>
<li><a href="https://pytorch.org/tutorials/intermediate/ddp_tutorial.html" target="_blank" rel="noopener">https://pytorch.org/tutorials/intermediate/ddp_tutorial.html</a></li>
<li><a href="https://github.com/tczhangzhi/pytorch-distributed" target="_blank" rel="noopener">https://github.com/tczhangzhi/pytorch-distributed</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/31558973" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/31558973</a></li>
<li><a href="https://www.cnblogs.com/jiangkejie/p/14603479.html" target="_blank" rel="noopener">https://www.cnblogs.com/jiangkejie/p/14603479.html</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/86441879" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/86441879</a></li>
</ul>
<h2 id="修改分割任务的IOU"><a href="#修改分割任务的IOU" class="headerlink" title="修改分割任务的IOU"></a>修改分割任务的IOU</h2><p>mmlab最初默认的配置为：</p>
<pre class="line-numbers language-python"><code class="language-python">    <span class="token comment" spellcheck="true"># model training and testing settings</span>
    train_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            allowed_border<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rpn_proposal<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            mask_size<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    test_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            score_thr<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
            mask_thr_binary<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们这里调整了相关的<code>pos_iou_thread=0.9 or 0.8</code>,当然rpn和rcnn以及nms部分都调了。调整后为：</p>
<pre class="line-numbers language-python"><code class="language-python">    <span class="token comment" spellcheck="true"># model training and testing settings</span>
    train_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            allowed_border<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rpn_proposal<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            mask_size<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    test_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            score_thr<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
            mask_thr_binary<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个文档是我找config来回找最后回溯到的，由于回溯过程比较麻烦，文件名什么的命名，最后也是找了挺长时间找<strong>准</strong>了。精确位置在<code>/home/lry/projects/mmdetection/configs/_base_/models/mask_rcnn_r50_fpn.py</code>这里。</p>
<p>别的没有太多改变，就训练完了之后有些了一个新的inference的python代码，在<code>/home/lry/projects/mmdetection/lry/compare_sege.py</code>,代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""本模块是一个小demo，用来对比单张图片结果怎么样"""</span>

<span class="token keyword">from</span> mmdet<span class="token punctuation">.</span>apis <span class="token keyword">import</span> init_detector<span class="token punctuation">,</span>inference_detector<span class="token punctuation">,</span> show_result_pyplot
<span class="token keyword">import</span> mmcv
<span class="token keyword">import</span> os
<span class="token keyword">import</span> glob
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor
<span class="token keyword">import</span> torch <span class="token keyword">as</span> t

<span class="token comment" spellcheck="true"># 定义model</span>
config_file <span class="token operator">=</span> <span class="token string">"/home/lry/projects/mmdetection/configs/fenghuo/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo.py"</span>
checkpoint_file_before <span class="token operator">=</span> <span class="token string">"/home/lry/projects/mmdetection/work_dirs/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo/latest.pth"</span>
checkpoint_file_after <span class="token operator">=</span> <span class="token string">"/home/lry/checkpoints/fenghuo/model_segementation_maskrcnn_10/latest.pth"</span>
model_before <span class="token operator">=</span> init_detector<span class="token punctuation">(</span>config_file<span class="token punctuation">,</span> checkpoint_file_before<span class="token punctuation">,</span>device<span class="token operator">=</span><span class="token string">"cuda:3"</span><span class="token punctuation">)</span>
model_after <span class="token operator">=</span> init_detector<span class="token punctuation">(</span>config_file<span class="token punctuation">,</span> checkpoint_file_after<span class="token punctuation">,</span>device<span class="token operator">=</span><span class="token string">"cuda:2"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 选取验证集的前10张图片进行验证</span>
imgs <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'/home/lry/data/780b_std/val/*.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span> img <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result_b <span class="token operator">=</span> inference_detector<span class="token punctuation">(</span>model_before<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
    model_before<span class="token punctuation">.</span>show_result<span class="token punctuation">(</span>img<span class="token punctuation">,</span> result_b<span class="token punctuation">,</span> out_file<span class="token operator">=</span>f<span class="token string">'/home/lry/checkpoints/fenghuo/compare/before/demo_val{i}.jpg'</span><span class="token punctuation">)</span>

    result_a <span class="token operator">=</span> inference_detector<span class="token punctuation">(</span>model_after<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
    model_after<span class="token punctuation">.</span>show_result<span class="token punctuation">(</span>img<span class="token punctuation">,</span> result_a<span class="token punctuation">,</span> out_file<span class="token operator">=</span>f<span class="token string">'/home/lry/checkpoints/fenghuo/compare/after/demo_val{i}.jpg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="训练注意"><a href="#训练注意" class="headerlink" title="训练注意"></a>训练注意</h2><p>这里训练的时候与组长交流的时候发现有这么一些问题：</p>

            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力!</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.bmp" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.bmp" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone, qq, weibo, douban"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            
            
            
            <div class="reprint1">
                <p>
                    <span class="reprint1-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;Reprint policy:
                    </span>
                    <a href="https://lry89757.github.io" class="b-link-green">LRY's Blog</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2021/12/05/feng-huo-xiang-mu-fen-lei-ren-wu-zong-jie/" class="b-link-green">烽火项目分类任务总结</a>
                </p>
            </div>

        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-dot-circle-o"></i>&nbsp;Current
            </div>
            <div class="card">
                <a href="/2021/12/05/feng-huo-xiang-mu-fen-lei-ren-wu-zong-jie/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="烽火项目分类任务总结">
                        
                        <span class="card-title">烽火项目分类任务总结</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
项目GitHub仓库地址：https://github.com/LRY89757/mmdet-for-fenghuo

2021.11.29日晚更新远程仓库创建成功，仓库地址：烽火检测
目前需要做的事情：

写一个关于这类Labelme文
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-12-05
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/深度学习/" class="post-category" target="_blank">
                                    深度学习
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/深度学习/" target="_blank">
                        <span class="chip bg-color">深度学习</span>
                    </a>
                    
                    <a href="/tags/烽火集团/" target="_blank">
                        <span class="chip bg-color">烽火集团</span>
                    </a>
                    
                    <a href="/tags/项目/" target="_blank">
                        <span class="chip bg-color">项目</span>
                    </a>
                    
                    <a href="/tags/图像处理/" target="_blank">
                        <span class="chip bg-color">图像处理</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/12/05/feng-huo-xiang-mu-fen-ge-ren-wu-zong-jie/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="烽火项目分割任务总结">
                        
                        <span class="card-title">烽火项目分割任务总结</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
项目GitHub仓库地址：https://github.com/LRY89757/mmdet-for-fenghuo

2021.11.9日晚更新差不多确定计划之后，这一晚上还是先看看我之前的所有关于MMDetection的博客，对于训练
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-12-05
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/深度学习/" class="post-category" target="_blank">
                                    深度学习
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/深度学习/" target="_blank">
                        <span class="chip bg-color">深度学习</span>
                    </a>
                    
                    <a href="/tags/烽火集团/" target="_blank">
                        <span class="chip bg-color">烽火集团</span>
                    </a>
                    
                    <a href="/tags/项目/" target="_blank">
                        <span class="chip bg-color">项目</span>
                    </a>
                    
                    <a href="/tags/图像处理/" target="_blank">
                        <span class="chip bg-color">图像处理</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'From: LRY's Blog<br />'
            + 'Author: 逯润雨<br />'
            + 'Link: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者Lurunyu所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4, h5, h6, h7'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5, h6, h7').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


        <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            Copyright&copy; 2021 逯润雨. 

            <br>
            <span id="sitetime"></span><span class="my-face">ღゝ◡╹)ノ♡</span>
            <br>

            

            
                    
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        总访问量: <span id="busuanzi_value_site_pv" class="white-color"></span>
                    
        
                    
                        <span id="busuanzi_container_site_uv" style='display:none'></span>
                        人次&nbsp; | &nbsp;访客人数: <span id="busuanzi_value_site_uv" class="white-color"></span> 人
                    
    
            

            
                &nbsp; | &nbsp;字数统计:&nbsp;
                <span class="white-color">213.8k</span> 字
            

            
            <br>

        </div>

        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/LRY89757" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>


 
    <a href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=lry89757@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>




    <a href="https://zhihu.com/people/yi-ran-fan-te-xi-57-88" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-inverse">知</i>
    </a>



    <a href="http://wpa.qq.com/msgrd?v=3&uin=1785435713&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的QQ空间" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>

    </div>
</footer>

<div class="progress-bar"></div>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();

        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */

        var t1 = Date.UTC(2021, 07, 29, 00, 00, 00); //北京时间2019-8-1 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes *
            minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已勉强运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours +
            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒" ;
    } /*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>






        <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
        <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


        <script src="https://cdn.bootcss.com/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdn.bootcss.com/masonry/4.2.2/masonry.pkgd.min.js"></script>
        <script src="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.js"></script>
        <script src="https://cdn.bootcss.com/scrollprogress/3.0.2/scrollProgress.min.js"></script>
        <script src="https://cdn.bootcss.com/lightgallery/1.6.12/js/lightgallery-all.min.js"></script>
        <script src="/js/matery.js"></script>

        <!-- Global site tag (gtag.js) - Google Analytics -->



        
            <script src="/libs/others/clicklove.js"></script>
        

        
            <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        

        
        <script type="text/javascript">
            var OriginTitile = document.title,
                st;
            document.addEventListener("visibilitychange", function () {
                document.hidden ? (document.title = "看不见我🙈~看不见我🙈~", clearTimeout(st)) : (document.title =
                    "(๑•̀ㅂ•́) ✧被发现了～", st = setTimeout(function () {
                        document.title = OriginTitile
                    }, 3e3))
            })
        </script>

        <!-- 鼠标点击烟花爆炸效果   -->
        
            <canvas class="fireworks" style="position: fixed; left: 0; top: 0; z-index: 1; pointer-events: none;"></canvas>
            <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
            <script type="text/javascript" src="/js/fireworks.js"></script>
        

        <!-- 背景雪花飘落特效 -->
        

        <!-- 鼠标点击文字特效 -->
        
            <script src="/js/wenzi.js" type="text/javascript"></script>
        

        <!-- 背景雪花飘落特效  -->
        
            <script type="text/javascript">
                var windowWidth = $(window).width();
                if (windowWidth > 768) {
                    document.write('<script type="text/javascript" src="/js/xuehuapiaoluo.js"><\/script>');
                }
            </script>
        

        <!-- 在线聊天工具   -->
        
            <script src="//code.tidio.co/xxxxxxxxxxxxxxxxxxxxxxxxxxx.js"></script>
            <!--  在线聊天位置自定义    -->
            <script> 
                $(document).ready(function () {

                    setInterval(change_Tidio, 50);  
                    function change_Tidio() { 

                        var tidio=$("#tidio-chat iframe");
                        if(tidio.css("display")=="block"&& $(window).width()>977 ){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"80px":"20px";   
                            document.getElementById("tidio-chat-iframe").style.right="-15px";   
                            document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        } 
                        else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                            document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        }
                        else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        }

                        if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                            document.getElementById("tidio-chat-iframe").style.zIndex="998";
                        }
                    } 
                }); 
            </script>
        

        <!-- 背景 canvas-nest  -->
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" color="0,0,255" pointColor="0,0,255" opacity= "0.8" zIndex="--1" count="150"src="/libs/background/canvas-nest.js"><\/script>');
            }
            </script>
        

        <!-- 背景静止彩带  -->
        

        <!-- 背景动态彩带 -->
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" src="/libs/background/ribbon-dynamic.js"><\/script>');
            }
            </script>
        

    <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":200},"mobile":{"show":false},"react":{"opacity":0.7}});</script><script>!function(e){var r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function t(){for(var c=0;c<r.length;c++)t=r[c],void 0,0<=(n=t.getBoundingClientRect()).top&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=r[c];t=o,n=function(){r=r.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}t(),e.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(t,e)})}(this);</script></body>
</html>