<!DOCTYPE HTML>
<html lang="default">
    



<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="mmdet &amp;&amp; project of fenghuo, Dian.AI CV ADV NLP DeepLearning MachineLearning ÈÄØÊ∂¶Èõ® Lurunyu CV,NLP,ADV Ê∑±Â∫¶Â≠¶‰π†">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="KeoTn_OFy4ndJwXNmm2gMeQfPhd7alqE9vQDwI32KCY">
    <meta name="description" content="
È°πÁõÆGitHub‰ªìÂ∫ìÂú∞ÂùÄÔºöhttps://github.com/LRY89757/mmdet-for-fenghuo

Preface
2021.11.9Êó•Êõ¥Êñ∞Ôºö

Êú¨ÂçöÂÆ¢ËÆ∞ÂΩïÁÉΩÁÅ´È°πÁõÆÊú¨‰∫∫ÁöÑÂÅöÈ°πÁõÆÁöÑÊäÄÊúØËøáÁ®ã„ÄÇÈ¶ñÂÖà‚Äî‚ÄîÊàë‰∏ç‰ºöÂàÜÂâ≤Âë¢Ëøòüò£üò£">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>mmdet &amp;&amp; project of fenghuo | LRY&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/lightgallery/1.6.12/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <style type="text/css">
        
            
            code[class*="language-"],
            pre[class*="language-"] {
                white-space: pre !important;
            }

        
    </style>

    <script src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

    <body>

        <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://dian.org.cn/static/dian/images/logo.dd99a9865177.gif" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">LRY's Blog</span>
                </a>
            </div>
            


<!-- <a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>Index</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>Tags</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>Categories</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>Archives</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/galleries" class="waves-effect waves-light">
            
            <i class="fa fa-photo"></i>
            
            <span>Galleries</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>About</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-envelope"></i>
            
            <span>Contact</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>Friends</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="Search"></i>
        </a>
    </li>
</ul> -->

<!-- ÊîØÊåÅ‰∫åÁ∫ßËèúÂçïÁâπÊÄß   -->
<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right nav-menu">
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/" class="waves-effect waves-light">
              
                <i class="fa fa-home"></i>
              
              <span>Index</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/tags" class="waves-effect waves-light">
              
                <i class="fa fa-tags"></i>
              
              <span>Tags</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/categories" class="waves-effect waves-light">
              
                <i class="fa fa-bookmark"></i>
              
              <span>Categories</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/archives" class="waves-effect waves-light">
              
                <i class="fa fa-archive"></i>
              
              <span>Archives</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/galleries" class="waves-effect waves-light">
              
                <i class="fa fa-photo"></i>
              
              <span>Galleries</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/about" class="waves-effect waves-light">
              
                <i class="fa fa-user-circle-o"></i>
              
              <span>About</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/contact" class="waves-effect waves-light">
              
                <i class="fa fa-envelope"></i>
              
              <span>Contact</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/friends" class="waves-effect waves-light">
              
                <i class="fa fa-address-book"></i>
              
              <span>Friends</span>
            </a>

            
      </li>
    

    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="Search"></i>
        </a>
    </li>

</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://dian.org.cn/static/dian/images/logo.dd99a9865177.gif" class="logo-img circle responsive-img">
        
        <div class="logo-name">LRY's Blog</div>
        <div class="logo-desc">
            
            Âçé‰∏≠ÁßëÊäÄÂ§ßÂ≠¶ | ËÆ°ÁÆóÊú∫ÁßëÂ≠¶‰∏éÊäÄÊúØ | Ê∑±Â∫¶Â≠¶‰π†
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                Index
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                Tags
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                Categories
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                Archives
            </a>
        </li>
        
        <li>
            <a href="/galleries" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-photo"></i>
                
                Galleries
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                About
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-envelope"></i>
                
                Contact
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                Friends
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/LRY89757" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>

   
   
<!-- ÊîØÊåÅ‰∫åÁ∫ßËèúÂçïÁâπÊÄß   -->
<!-- <ul class="menu-list mobile-menu-list">
    
        <li class="m-nav-item">
                
                    <a href="/" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-home"></i>
                        
                        Index
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/tags" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-tags"></i>
                        
                        Tags
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/categories" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-bookmark"></i>
                        
                        Categories
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/archives" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-archive"></i>
                        
                        Archives
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/galleries" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-photo"></i>
                        
                        Galleries
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/about" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-user-circle-o"></i>
                        
                        About
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/contact" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-envelope"></i>
                        
                        Contact
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/friends" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-address-book"></i>
                        
                        Friends
                    </a>
              
            </li>
        

        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/LRY89757" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul> -->

</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/LRY89757" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

        



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/17.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        mmdet &amp;&amp; project of fenghuo
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        
<!-- ÊñáÁ´†ÂÜÖÂÆπËØ¶ÊÉÖ -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Ê∑±Â∫¶Â≠¶‰π†/" target="_blank">
                                <span class="chip bg-color">Ê∑±Â∫¶Â≠¶‰π†</span>
                            </a>
                        
                            <a href="/tags/ÁÉΩÁÅ´ÈõÜÂõ¢/" target="_blank">
                                <span class="chip bg-color">ÁÉΩÁÅ´ÈõÜÂõ¢</span>
                            </a>
                        
                            <a href="/tags/È°πÁõÆ/" target="_blank">
                                <span class="chip bg-color">È°πÁõÆ</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Ê∑±Â∫¶Â≠¶‰π†/" class="post-category" target="_blank">
                                Ê∑±Â∫¶Â≠¶‰π†
                            </a>
                        
                    </div>
                    
                </div>
            </div>
            
            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-11-09
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>Author:&nbsp;&nbsp;
                    
                        ÈÄØÊ∂¶Èõ®
                    
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>Words:&nbsp;&nbsp;
                        14.7k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>Read Times:&nbsp;&nbsp;
                        65 Min
                    </div>
                    
                
                
                
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        <i class="fa fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv" ></span>
    
                

            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>È°πÁõÆGitHub‰ªìÂ∫ìÂú∞ÂùÄÔºö<a href="https://github.com/LRY89757/mmdet-for-fenghuo" target="_blank" rel="noopener">https://github.com/LRY89757/mmdet-for-fenghuo</a></p>
</blockquote>
<h1 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h1><blockquote>
<p>2021.11.9Êó•Êõ¥Êñ∞Ôºö</p>
</blockquote>
<p>Êú¨ÂçöÂÆ¢ËÆ∞ÂΩïÁÉΩÁÅ´È°πÁõÆÊú¨‰∫∫ÁöÑÂÅöÈ°πÁõÆÁöÑÊäÄÊúØËøáÁ®ã„ÄÇÈ¶ñÂÖà‚Äî‚ÄîÊàë‰∏ç‰ºöÂàÜÂâ≤Âë¢Ëøòüò£üò£üò£ÔºåÊàëÂ∞±Â§ßÊ¶ÇÁü•ÈÅìÂàÜÂâ≤ÊòØ‰ªÄ‰πàÂè¶Â§ñÂ∞±ÊòØÊï∞ÊçÆÈõÜÂ§ßËá¥ÂΩ¢Âºè‚Ä¶‚Ä¶Ôºà<del>ËôΩÁÑ∂ÁõÆÂâçÊù•Áúã‰πüÂ§ü‰∫Ü‚Ä¶‚Ä¶</del>Ôºâ</p>
<p>ËøôÂ∞±ÊòØ‚ÄùÂπ≤‰∏≠Â≠¶‚ÄùÂòõüò≠üò≠„ÄÇ</p>
<p>Âπ∏‰∫èÁöÑÊòØÔºå‰πãÂâçÁúãÁöÑËÆ∏Â§öÂÆòÊñπÊñáÊ°£ÊàëÈÉΩËÆ∞ÂΩï‰∫ÜÁõ∏ÂÖ≥ÁöÑËøáÁ®ãÔºå‰∏çÈúÄË¶ÅÈáçÂ§çÁúãÊñáÊ°£‰∫ÜÔºåËÄå‰∏î„ÄÇ‰∏Ä‰∏™Êõ¥Â•ΩÁöÑÊ∂àÊÅØÂ∞±ÊòØÊàëÂΩìÊó∂ÁúãÁöÑÂÆòÊñπÊñáÊ°£Âá†‰πéÈÉΩÊòØÂÖ≥‰∫éMaskRCNNÁöÑÔºåÊàëÂÆûÈôÖ‰∏äÂØπËøô‰∫õ‰∏úË•øÁöÑÊµãËØïËÆ≠ÁªÉÁöÑÂæàÂ§öÊµÅÁ®ãÈùûÂ∏∏Ê∏ÖÊ•ö‰∫ÜÔºà<del>Âè™ÊòØ‰∏ÄÈÉ®ÂàÜÔºå‰∏ÄÂ∞èÈÉ®ÂàÜ</del>ÔºâÔºåËøôÂ∞±‰∏∫ÊàëËôΩÁÑ∂‰∏çÁÜüÊÇâ„ÄÅ‰∏çÂ§™‰ºöMaskRCNN‰ΩÜÊòØ‰∏ç‰ºöÂØπÊàëËÆ≠ÁªÉ„ÄÅÂØπÊàëÊé®ÁêÜÁõ∏ÂÖ≥Ê®°Âûã‰∫ßÁîü‰∏Ä‰∫õÂæàÂ§ßÁöÑÈöúÁ¢çÔºåÊàëÊàñËÆ∏Âè™ÈúÄË¶ÅÂ∞±ÊÉ≥Âú®ÂÅöÊ£ÄÊµã‰∏ÄÊ†∑Êù•ÂÅöËøô‰∏Ä‰ª∂‰∫ãÂ∞±Â•Ω‰∫Ü„ÄÇÂΩìÁÑ∂ËæìÂÖ•ÂíåËæìÂá∫ËøòÊòØË¶ÅÊàëËá™Â∑±Êù•ÊêûÂÆöÁöÑÔºåËøô‰πüÊòØÊúÄ‰∏çÂ•ΩÂºÑÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ</p>
<p>Áî±‰∫éÊú¨ÊúàÊúàÊú´‰ºöÊúâ‰∏§Âú∫ÊØîËæÉÈáçË¶ÅÁöÑËÄÉËØïÔºåÊâÄ‰ª•ÊúÄÂ•ΩÊàëËÉΩÂú®Êú¨Âë®Â§ßËá¥ÂÜôÂá∫‰∏ÄÈÉ®ÂàÜ‰ª£Á†ÅÁÑ∂Âêédebug‰∏Ä‰∫õ‰∏úË•øÔºåËøô‰∏§Âë®ÂèØ‰ª•ÈÄÇÂΩìÂ§öÂèÇÂä†‰∏Ä‰∏ãÈ°πÁõÆÁÑ∂ÂêéÂà∞Êú¨ÊúàÂêé‰∏ÄÂë®ÂºÄÂßãÂáÜÂ§áËÄÉËØï„ÄÇ</p>
<h1 id="2021-11-9Êó•ÊôöÊõ¥Êñ∞"><a href="#2021-11-9Êó•ÊôöÊõ¥Êñ∞" class="headerlink" title="2021.11.9Êó•ÊôöÊõ¥Êñ∞"></a>2021.11.9Êó•ÊôöÊõ¥Êñ∞</h1><p>Â∑Æ‰∏çÂ§öÁ°ÆÂÆöËÆ°Âàí‰πãÂêéÔºåËøô‰∏ÄÊôö‰∏äËøòÊòØÂÖàÁúãÁúãÊàë‰πãÂâçÁöÑÊâÄÊúâÂÖ≥‰∫éMMDetectionÁöÑÂçöÂÆ¢ÔºåÂØπ‰∫éËÆ≠ÁªÉÂíåÊµãËØï‰ª•ÂèäÊï∞ÊçÆÈõÜÈáçÊñ∞ÁÜüÊÇâÊï¥Âêà‰∏Ä‰∏ã„ÄÇ</p>
<p><strong>Note</strong>: MMDetection only supports evaluating mask AP of dataset in COCO format for now. So for instance segmentation task users should convert the data into coco format.</p>
<h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><h3 id="dataset-prepare"><a href="#dataset-prepare" class="headerlink" title="dataset prepare"></a>dataset prepare</h3><p>ËøôÈáåÊàëÂàùÊ≠•ÊâìÁÆóÊ†πÊçÆÊàë‰ª¨ÁöÑjsonÊñá‰ª∂ÂÜô‰∏Ä‰∏™ËΩ¨Âåñ‰∏∫COCOÊï∞ÊçÆÈõÜÁöÑ<code>.py</code>Êñá‰ª∂ÔºåÂõ†‰∏∫ÁªÑÈïøÊé®ËçêÁöÑÂÜô‰∏Ä‰∏™dataloaderËøôÁßçÊñπÂºèÊàëÁõÆÂâçÊ≤°ÊúâÂ§™ÊòéÁôΩÔºåÂèçÊ≠£‰∏çÁÆ°ÈªëÁå´ÁôΩÁå´,ÂÖàÂÜôÂá∫Êù•ËÉΩË∑ëÂ∞±Ë°åüòû„ÄÇ</p>
<p>COCOÊï∞ÊçÆÈõÜÂ§ßÊ¶ÇÈïøËøô‰∏™Ê†∑Â≠êÔºö</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span>
    <span class="token string">"images"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>image<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"annotations"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>annotation<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"categories"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>category<span class="token punctuation">]</span>
<span class="token punctuation">}</span>


image <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"width"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"height"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"file_name"</span><span class="token punctuation">:</span> str<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

annotation <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"image_id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"category_id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"segmentation"</span><span class="token punctuation">:</span> RLE <span class="token operator">or</span> <span class="token punctuation">[</span>polygon<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"area"</span><span class="token punctuation">:</span> float<span class="token punctuation">,</span>
    <span class="token string">"bbox"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"iscrowd"</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">or</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> str<span class="token punctuation">,</span>
    <span class="token string">"supercategory"</span><span class="token punctuation">:</span> str<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂΩìÊó∂ÁúãÂÆòÁΩëÂêéÂÜôÁöÑÂçöÂÆ¢ÂΩìÊó∂Á¨¨‰∏ÄÊ≠•Â∞±ÊòØËΩ¨Âåñ‰∏Ä‰∏ãÊï∞ÊçÆÈõÜÔºåÂΩìÊó∂ÂÆòÁΩë‰∏ìÈó®Êèê‰æõ‰∫Ü‰∏Ä‰∏™BallonÊï∞ÊçÆÈõÜÔºå‰πüÊòØ‰∫åÂàÜÁ±ªÁöÑÊï∞ÊçÆÈõÜÔºåÂΩìÊó∂Êï∞ÊçÆÈõÜÁöÑÊ†ºÂºèÁ°ÆÂÆû‰∏çÊòØÈùûÂ∏∏ÂêàÁêÜÁúãÁùÄÔºåÂêéÈòøÈáåÁªèËøáËΩ¨Âåñ‰πãÂêéÂèòÊàê‰∫ÜCOCOÁöÑÊ†áÂáÜÊ†ºÂºèÔºåÊàë‰ª¨ËøôÈáåÈáçÊñ∞Êù•Áúã‰∏Ä‰∏ã,Âê∏Âèñ‰∏äÊ¨°ÁöÑÊïôËÆ≠ÔºåËøôÈáåÈÄâÊã©ÂàÜÂ±ÇÊù•ÁúãÁªìÊûÑÔºö</p>
<ul>
<li>Á¨¨‰∏ÄÂ±ÇÁªìÊûÑÔºö<br><a href="https://imagelol.com/image/I967LC" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/11/09/I967LC.png" alt></a><br>Â§ßÁªìÊûÑÂ∞±ÊòØÂõæÂÉèÈÉΩÊúâ‰ªÄ‰πàÔºåÁÑ∂ÂêéÊ†áËÆ∞ÈÉΩÊòØ‰ªÄ‰πàÔºåÁÑ∂ÂêéÊòØÂàÜÁ±ªÁöÑÁ±ªÂà´ÈÉΩÊúâ‰ªÄ‰πà.Êé•‰∏ãÊù•Ê∑±ÂÖ•ÁúãÔºö</li>
<li>Á¨¨‰∫åÂ±ÇÁªìÊûÑ‰πã<code>images</code><br><a href="https://imagelol.com/image/I96d4R" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/11/09/I96d4R.png" alt></a></li>
</ul>
<p><code>images</code>‰∏ªË¶ÅËÆ∞ÂΩïÁöÑÂ∞±ÊòØÂõæÁâáÁöÑ‰∏Ä‰∏™idsËøòÊúâÈ´òÂÆΩÔºåËøô‰∏™È´òÂÆΩËøòÊòØËõÆÈáçË¶ÅÁöÑÔºå‰ª•ÂèäÊñá‰ª∂Âêç„ÄÇ</p>
<ul>
<li><p>Á¨¨‰∫åÂ±ÇÁªìÊûÑ‰πã<code>annotations</code><br><a href="https://imagelol.com/image/I96eDz" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/11/09/I96eDz.png" alt></a><br>ËØ•Â±ÇÂ∞±ÊòØÊàë‰ª¨ÁöÑÂàÜÁ±ªcategory_idÂíåÊ°ÜbboxËøòÊúâÂàÜÂâ≤Êï∞ÊçÆsegmentationÁöÑÁªìÊûÑ‰∫Ü„ÄÇcategory_idÊòØÁ±ªÂà´ÁöÑÁßçÁ±ªÊï∞ÔºåbboxÊòØÊ£ÄÊµãÊ°ÜÔºåsegmentationÊòØÂàÜÂâ≤ÁöÑÊï∞ÊçÆÊ†áÊ≥®„ÄÇÂÖ∂‰ªñÁöÑÊòØÂíå‰∏äÈù¢ÁöÑ‰∏Ä‰∏ÄÂØπÂ∫îÁöÑÔºà<del>ÊØîÂ¶ÇËØ¥image_idË°®Á§∫ËØ•Ê†áÊ≥®Â±û‰∫éÈÇ£‰∏ÄÂº†ÂõæÁâá‚Ä¶‚Ä¶</del>ÔºâÔºåËøòÊúâ‰∏Ä‰∫õ‰∏çËØ¥‰∫ÜÔºå‰∏çÊòØÈùûÂ∏∏ÈáçË¶Å„ÄÇ<br>Áúã‰∏ãÂÆåÊï¥ÁöÑÂåÖÂê´ÂÖ∑‰ΩìbboxÂíåsegmentationÊï∞ÊçÆÁöÑÂõæÔºö<br><a href="https://imagelol.com/image/I96U2p" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/11/09/I96U2p.png" alt></a></p>
</li>
<li><p>Á¨¨‰∫åÂ±ÇÁªìÊûÑ‰πã<code>categories</code>:<br><a href="https://imagelol.com/image/I96Y9W" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/11/09/I96Y9W.png" alt></a></p>
</li>
</ul>
<p>Áî±‰∫éËøô‰∏™Êï∞ÊçÆÈõÜÈùûÂ∏∏ÁÆÄÂçï,Â∞±ÊòØ‰∏Ä‰∏™ÂÖ≥‰∫éballoonÁöÑÊ£ÄÊµãÂàÜÂâ≤‰ªªÂä°,ÊâÄ‰ª•Á±ªÂà´Âè™Êúâ‰∏Ä‰∏™,Áõ∏ÂØπËÄåË®ÄËøòÊå∫Â•Ω.<br><del>ÊàëÁ™ÅÁÑ∂ËúúÊ±ÅËá™‰ø°,Êàë‰ª¨ÁöÑÊï∞ÊçÆ‰πüÊòØÂàùÊ≠•Âè™Êúâ‰∏Ä‰∏™Ê°ÜËÆ©Êàë‰ª¨Ê£ÄÊµã,ÊàëÊÄé‰πàËßâÂæóÊàëÂèàË°å‰∫Ü</del></p>
<p>Â•ΩÊª¥,Êï∞ÊçÆÈõÜÂ§ßÊ¶ÇÂ∞±ÊòØËøôÊ†∑!Êàë‰ª¨Áªà‰∫éÂèØ‰ª•Êù•Áúã‰∏Ä‰∏ãÂÖ≥‰∫éConfigÁõ∏ÂÖ≥ÁöÑÊñá‰ª∂‰∫Ü.</p>
<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p>ÊàëËá™ËÆ§‰∏∫ÊàëÂΩìÊó∂ÂÜôÂæóÂÖ≥‰∫éConfigÁöÑËß£ÈáäÂ∑≤ÁªèÂ§üËØ¶ÁªÜ‰∫ÜÁõ¥Âà∞ÊàëÂèàÁúã‰∫Ü‰∏ÄÈÅçÁõ∏ÂÖ≥ÁöÑ<a href="https://mmdetection.readthedocs.io/en/latest/tutorials/config.html" target="_blank" rel="noopener">ÂÆòÊñπÊñáÊ°£</a>,ÂèëÁé∞ÂΩìÊó∂Ëß£ÈáäÁöÑÊºèÊ¥ûËøòÊòØÈùûÂ∏∏Â§ö,ÊâÄ‰ª•Âú®ËøôÈáåÂ§öÂÜô‰∏ÄÁÇπ.</p>
<blockquote>
<p>We incorporate modular and inheritance design into our config system, which is convenient to conduct various experiments. If you wish to inspect the config file, you may run <code>python tools/misc/print_config.py /PATH/TO/CONFIG</code> to see the complete config.</p>
</blockquote>
<p>Ê≠£Â¶Ç‰∏äÈù¢Êàë‰ª¨ÂèØ‰ª•ÈÄöËøá<code>python tools/misc/print_config.py /PATH/TO/CONFIG</code> ÂëΩ‰ª§Êù•ÂØπÊàë‰ª¨ÊÉ≥Ë¶Å‰∫ÜËß£ÁöÑconfigÊñá‰ª∂Êù•Áúã‰ªñ‰ª¨Áõ∏ÂÖ≥ÁöÑÂÖ∑‰ΩìÈÖçÁΩÆ.<del>‰∫èÊàëÂΩìÊó∂Ëøò‰∏ìÈó®ÂÜô‰∫Ü‰∏™Áõ∏ÂÖ≥ÁöÑÊâìÂç∞ÈÖçÁΩÆ‰ª£Á†Å‚Ä¶</del></p>
<p>ÊäÑ‰∏Ä‰∏ãÊàëËá™Â∑±ÁöÑblog:</p>
<blockquote>
<p>Êàë‰ª¨ÁöÑconfigÈúÄË¶ÅÊîæÂà∞<code>configs/balloon/</code>ÁõÆÂΩï‰∏ãÂπ∂‰∏îÂëΩÂêç‰∏∫Ôºö<code>mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_balloon.py</code></p>
<p>ÂÖ≥‰∫éËøô‰πà‰∏Ä‰∏™ÂêçÂ≠óÔºå‰∏∫‰ªÄ‰πàËøô‰πàÂ§çÊùÇÊòØÊúâÂéüÂõ†ÁöÑÔºåÂèÇËßÅËøôÈáå:<a href="https://mmdetection.readthedocs.io/zh_CN/v2.18.0/tutorials/config.html#id4" target="_blank" rel="noopener">https://mmdetection.readthedocs.io/zh_CN/v2.18.0/tutorials/config.html#id4</a></p>
</blockquote>
<p>ÂΩìÊó∂ÁöÑÊàë‰πüÁúüÊòØÂ§üËæõËã¶,ÂÆòÁΩëÁªôÁöÑÊå∫Â§ö‰∏úË•øÈÉΩÊúâÈóÆÈ¢ò,ÊàëÂΩìÊó∂Â∞±Ëá™Â∑±‰øÆÊîπ‰∫ÜËÆ∏Â§ö‰∏úË•ø,ÊÄªÁÆóËÆ©Êàë‰ª¨ÁöÑballoon.pyÊàêÂäüËøêË°å‰∫Ü:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># The new config inherits a base config to highlight the necessary modification</span>
_base_ <span class="token operator">=</span> <span class="token string">'../mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py'</span>

<span class="token comment" spellcheck="true"># We also need to change the num_classes in head to match the dataset's annotation</span>
model <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    roi_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        bbox_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mask_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Modify dataset related settings</span>
dataset_type <span class="token operator">=</span> <span class="token string">'COCODataset'</span>
classes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'balloon'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    train<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        img_prefix<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/balloon/train/'</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>
        ann_file<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/balloon/train/annotation_coco.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    val<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        img_prefix<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/balloon/val/'</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>
        ann_file<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/balloon/val/annotation_coco.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    test<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        img_prefix<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/balloon/val/'</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>
        ann_file<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/balloon/val/annotation_coco.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># We can use the pre-trained Mask RCNN model to obtain higher performance</span>
<span class="token comment" spellcheck="true"># load_from = 'checkpoints/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco_bbox_mAP-0.408__segm_mAP-0.37_20200504_163245-42aa3d00.pth'</span>
load_from <span class="token operator">=</span> <span class="token string">'https://download.openmmlab.com/mmdetection/v2.0/mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco_bbox_mAP-0.408__segm_mAP-0.37_20200504_163245-42aa3d00.pth'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂΩìÊó∂ÂÜôÈÇ£ÁØáÂçöÊñá<a href="https://lry89757.github.io/2021/10/12/practice-mmdet-customized-datasets/">practice mmdet(Customized datasets)</a>ÁöÑÊó∂ÂÄô,ËøòÊ≤°ÊúâÂΩªÂ∫ïËØªÊ∫êÁ†ÅËøõË°åÁõ∏ÂÖ≥ÁöÑÊ∫ØÊ∫ê,ËÄåÂú®ÊàëÊ∫ØÊ∫ê‰ª£Á†Å<a href="https://lry89757.github.io/2021/10/16/code-trace-of-mmdetection/">Code Trace of mmdetection</a>‰πãÂêé,ÂØπÊï¥‰∏™Â∑•Á®ãÁöÑÁêÜËß£‰∏äÂçá‰∫Ü‰∏Ä‰∏™Â±ÇÊ¨°,‰∏çÂæó‰∏çËØ¥ËøòÁúüÊòØÂ§üÂèØ‰ª•ÁöÑ,ËøòÊòØÂ≠¶Â•ΩÁõ∏ÂÖ≥ÁöÑÊñá‰ª∂„ÄÅËØªÊáÇÊ∫êÁ†ÅÊâçÁÆóÁúüÊ≠£ÁêÜËß£‰∫ÜÂæàÂ§ö‰∏úË•ø. ËÄåÂ∞ΩÁÆ°ËØª‰∫ÜÈÉ®ÂàÜÊ∫êÁ†Å‰ΩÜËøòÊòØ‰∏çÁü•ÂÖ®Â±Ä,Ê≠£ÊòØÂΩìÊàëÁúã‰∫ÜÁü•‰πéÂÆòÊñπÂÜôÂæóÊï¥‰ΩìÊ°ÜÊû∂ÂêéÊâçÊõ¥Âä†ÂÖ®Â±Ä‰∫ÜËß£‰∫ÜÊúâÂÖ≥ÁöÑÁªìÊûÑ.ÂØπ‰∫éCVÊï¥‰ΩìÁöÑÊµÅÁ®ãÁõÆÂâç‰πüÊúâ‰∫ÜÊõ¥Â•ΩÁöÑÊääÊè°.</p>
<p>‰∏äÈù¢‰∏ÄÊÆµÊâØ‰∫ÜÈÇ£‰πàÂ§ö,Êàë‰ª¨Êù•ËøêË°åÂëΩ‰ª§<code>python tools/misc/print_config.py /home/lry/projects/mmdetection/configs/balloon/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_balloon.py</code>Êù•ÁúãÁúãconfigÂà∞Â∫ïÊòØ‰ªÄ‰πà‰∏úË•ø:<br>ÊàëÂÖàÊääÂæóÂà∞ÁöÑÊï¥‰∏™ÁöÑÁªìÊûúÂ§çÂà∂‰∏ãÊù•‰ª•‰æøÂêÑ‰ΩçÁ†îÁ©∂:</p>
<pre class="line-numbers language-python"><code class="language-python">Config<span class="token punctuation">:</span>
model <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    type<span class="token operator">=</span><span class="token string">'MaskRCNN'</span><span class="token punctuation">,</span>
    backbone<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'ResNet'</span><span class="token punctuation">,</span>
        depth<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>
        num_stages<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        frozen_stages<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
        norm_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'BN'</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        norm_eval<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        style<span class="token operator">=</span><span class="token string">'caffe'</span><span class="token punctuation">,</span>
        init_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'Pretrained'</span><span class="token punctuation">,</span>
            checkpoint<span class="token operator">=</span><span class="token string">'open-mmlab://detectron2/resnet50_caffe'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    neck<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'FPN'</span><span class="token punctuation">,</span>
        in_channels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
        num_outs<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rpn_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'RPNHead'</span><span class="token punctuation">,</span>
        in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
        feat_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
        anchor_generator<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'AnchorGenerator'</span><span class="token punctuation">,</span>
            scales<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            ratios<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        bbox_coder<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'DeltaXYWHBBoxCoder'</span><span class="token punctuation">,</span>
            target_means<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            target_stds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        loss_cls<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        loss_bbox<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'L1Loss'</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    roi_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'StandardRoIHead'</span><span class="token punctuation">,</span>
        bbox_roi_extractor<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>
            roi_layer<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span> output_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        bbox_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'Shared2FCBBoxHead'</span><span class="token punctuation">,</span>
            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            fc_out_channels<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>
            roi_feat_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span>
            num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
            bbox_coder<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'DeltaXYWHBBoxCoder'</span><span class="token punctuation">,</span>
                target_means<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                target_stds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            reg_class_agnostic<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
            loss_cls<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            loss_bbox<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'L1Loss'</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mask_roi_extractor<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>
            roi_layer<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span> output_size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mask_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'FCNMaskHead'</span><span class="token punctuation">,</span>
            num_convs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            conv_out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
            loss_mask<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    train_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            allowed_border<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rpn_proposal<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            mask_size<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    test_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            score_thr<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
            mask_thr_binary<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
dataset_type <span class="token operator">=</span> <span class="token string">'COCODataset'</span>
data_root <span class="token operator">=</span> <span class="token string">'data/coco/'</span>
img_norm_cfg <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">103.53</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">123.675</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to_rgb<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
train_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'LoadAnnotations'</span><span class="token punctuation">,</span>
        with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        with_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        poly2mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span>
        img_scale<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">672</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">704</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">736</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">768</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        multiscale_mode<span class="token operator">=</span><span class="token string">'value'</span><span class="token punctuation">,</span>
        keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">,</span> flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>
        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">103.53</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">123.675</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        to_rgb<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'gt_bboxes'</span><span class="token punctuation">,</span> <span class="token string">'gt_labels'</span><span class="token punctuation">,</span> <span class="token string">'gt_masks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
test_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>
        img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
        transforms<span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>
                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">103.53</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">123.675</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                to_rgb<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
data <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    samples_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
    workers_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
    train<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>
        ann_file<span class="token operator">=</span>
        <span class="token string">'/home/lry/projects/mmdetection/data/balloon/train/annotation_coco.json'</span><span class="token punctuation">,</span>
        img_prefix<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/balloon/train/'</span><span class="token punctuation">,</span>
        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'LoadAnnotations'</span><span class="token punctuation">,</span>
                with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                with_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                poly2mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span>
                img_scale<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">672</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">704</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">736</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                           <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">768</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                multiscale_mode<span class="token operator">=</span><span class="token string">'value'</span><span class="token punctuation">,</span>
                keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">,</span> flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>
                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">103.53</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">123.675</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                to_rgb<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span>
                keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'gt_bboxes'</span><span class="token punctuation">,</span> <span class="token string">'gt_labels'</span><span class="token punctuation">,</span> <span class="token string">'gt_masks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'balloon'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    val<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>
        ann_file<span class="token operator">=</span>
        <span class="token string">'/home/lry/projects/mmdetection/data/balloon/val/annotation_coco.json'</span><span class="token punctuation">,</span>
        img_prefix<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/balloon/val/'</span><span class="token punctuation">,</span>
        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>
                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                transforms<span class="token operator">=</span><span class="token punctuation">[</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>
                        type<span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>
                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">103.53</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">123.675</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        to_rgb<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'balloon'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    test<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>
        ann_file<span class="token operator">=</span>
        <span class="token string">'/home/lry/projects/mmdetection/data/balloon/val/annotation_coco.json'</span><span class="token punctuation">,</span>
        img_prefix<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/balloon/val/'</span><span class="token punctuation">,</span>
        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>
                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                transforms<span class="token operator">=</span><span class="token punctuation">[</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>
                        type<span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>
                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">103.53</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">123.675</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        to_rgb<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'balloon'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
evaluation <span class="token operator">=</span> dict<span class="token punctuation">(</span>metric<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">,</span> <span class="token string">'segm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'SGD'</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>
optimizer_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>grad_clip<span class="token operator">=</span>None<span class="token punctuation">)</span>
lr_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    policy<span class="token operator">=</span><span class="token string">'step'</span><span class="token punctuation">,</span>
    warmup<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span>
    warmup_iters<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>
    warmup_ratio<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>
    step<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
runner <span class="token operator">=</span> dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'EpochBasedRunner'</span><span class="token punctuation">,</span> max_epochs<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
checkpoint_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
log_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> hooks<span class="token operator">=</span><span class="token punctuation">[</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'TextLoggerHook'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
custom_hooks <span class="token operator">=</span> <span class="token punctuation">[</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'NumClassCheckHook'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
dist_params <span class="token operator">=</span> dict<span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">'nccl'</span><span class="token punctuation">)</span>
log_level <span class="token operator">=</span> <span class="token string">'INFO'</span>
load_from <span class="token operator">=</span> <span class="token string">'https://download.openmmlab.com/mmdetection/v2.0/mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco_bbox_mAP-0.408__segm_mAP-0.37_20200504_163245-42aa3d00.pth'</span>
resume_from <span class="token operator">=</span> None
workflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
classes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'balloon'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êàë‰ª¨‰∏Ä‰∏™‰∏Ä‰∏™ÊÖ¢ÊÖ¢Áúã,ÂÆûÈôÖ‰∏äÂ∞±ÊòØÊ£ÄÊµãÂàÜÂâ≤ÁöÑÂêÑ‰∏™ÁªìÊûÑÊµÅÁ®ã(backbone, neck, rpn_head, roi_head)‰ª•ÂèäÊàë‰ª¨ËÆ≠ÁªÉÈ™åËØÅÊï∞ÊçÆÁöÑÊ†ºÂºèÈ¢ÑËÆ≠ÁªÉÊñπÊ≥ï(train_cfg, data_type, data_root, train_pipeline, test‚Ä¶)‰ª•ÂèäÂêÑÁ±ªÂÖ≥‰∫éÊùÉÈáç‰ΩçÁΩÆ„ÄÅÂ≠¶‰π†Áéá„ÄÅ‰ºòÂåñÂáΩÊï∞Á≠âÁ≠â‚Ä¶:</p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://gitee.com/moisten-the-rain/image01/raw/master/img/20211109210515.png" alt></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://gitee.com/moisten-the-rain/image01/raw/master/img/20211109210526.png" alt></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://gitee.com/moisten-the-rain/image01/raw/master/img/20211109210532.png" alt></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://gitee.com/moisten-the-rain/image01/raw/master/img/20211109210556.png" alt></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://gitee.com/moisten-the-rain/image01/raw/master/img/20211109210539.png" alt></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://gitee.com/moisten-the-rain/image01/raw/master/img/20211109210544.png" alt></p>
<p>Èô§‰∫Ü‰ª•‰∏äÁªìÊûÑ‰πãÂ§ñ,Ââ©‰∏ãÁöÑÂ∞±ÊòØ‰∏Ä‰∫õÊàë‰ª¨ÁöÑÂÖ∂‰ΩôÈÖçÁΩÆ:</p>
<pre class="line-numbers language-python"><code class="language-python">evaluation <span class="token operator">=</span> dict<span class="token punctuation">(</span>metric<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">,</span> <span class="token string">'segm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'SGD'</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>
optimizer_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>grad_clip<span class="token operator">=</span>None<span class="token punctuation">)</span>
lr_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    policy<span class="token operator">=</span><span class="token string">'step'</span><span class="token punctuation">,</span>
    warmup<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span>
    warmup_iters<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>
    warmup_ratio<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>
    step<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
runner <span class="token operator">=</span> dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'EpochBasedRunner'</span><span class="token punctuation">,</span> max_epochs<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
checkpoint_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
log_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> hooks<span class="token operator">=</span><span class="token punctuation">[</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'TextLoggerHook'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
custom_hooks <span class="token operator">=</span> <span class="token punctuation">[</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'NumClassCheckHook'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
dist_params <span class="token operator">=</span> dict<span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">'nccl'</span><span class="token punctuation">)</span>
log_level <span class="token operator">=</span> <span class="token string">'INFO'</span>
load_from <span class="token operator">=</span> <span class="token string">'https://download.openmmlab.com/mmdetection/v2.0/mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco_bbox_mAP-0.408__segm_mAP-0.37_20200504_163245-42aa3d00.pth'</span>
resume_from <span class="token operator">=</span> None
workflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
classes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'balloon'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="2021-11-10ÊôöÊõ¥Êñ∞"><a href="#2021-11-10ÊôöÊõ¥Êñ∞" class="headerlink" title="2021.11.10ÊôöÊõ¥Êñ∞"></a>2021.11.10ÊôöÊõ¥Êñ∞</h1><h2 id="Preface-1"><a href="#Preface-1" class="headerlink" title="Preface"></a>Preface</h2><p>ÊåâÁÖßÊò®Â§©ÁúãÁöÑËá™Â∑±‰πãÂâçÂçöÂÆ¢ÂíåÊÄªÁªìÁöÑÊÄùË∑ØÔºåÁõÆÂâçÂΩìÂä°‰πãÊÄ•Â∞±ÊòØÊâæÂà∞Êàë‰ª¨ÈúÄË¶ÅÁöÑ‰ª£Á†ÅÊù•ËΩ¨Êç¢labelmeÊ†áÊ≥®ÁöÑÊï∞ÊçÆÈõÜÂèò‰∏∫COCOÊ†ºÂºèÁöÑÔºåÁõÆÂâçÂú®GitHubÊàëÊâæÂà∞‰∫Ü‰∏Ä‰∫õÁõ∏ÂÖ≥ÁöÑÂºÄÊ∫êÂ∞èÈ°πÁõÆÔºåÊâìÁÆóÊ†πÊçÆËøô‰∏™‰ªìÂ∫ì<a href="https://github.com/veraposeidon/labelme2Datasets" target="_blank" rel="noopener">https://github.com/veraposeidon/labelme2Datasets</a> Êù•ËΩ¨Êç¢Êàë‰ª¨ÁöÑÊï∞ÊçÆÔºåÂΩìÁÑ∂ËøôÈáåËÇØÂÆöÈúÄË¶ÅÊõ¥Êîπ‰∏Ä‰∫õ‰ª£Á†Å„ÄÇÂè¶Â§ñËøôÈáåÁî±‰∫éÂàÜÂâ≤Âπ∂Ê≤°ÊúâÂÅöÊï∞ÊçÆÊ†áÊ≥®ÔºåÊâÄ‰ª•ÊàëËá™Â∑±ÂæóÈáçÊñ∞ÂÜô‰∏ÄÈÅçÂàÜÂâ≤ÁöÑÁõ∏ÂÖ≥Ê†áÊ≥®„ÄÇ</p>
<blockquote>
<p>ÁúüÊòØÊáíÂæóÂ§üÂèØ‰ª•Ôºå11.10Êï¥ÂÆåÁöÑÔºåË¶ÅÁ≠âÂà∞11.13Âè∑Êù•ÂÜôÔºåÂêê‰∫Ü„ÄÇ</p>
</blockquote>
<h2 id="COCO-jsonÂíåLabelme-jsonÂå∫Âà´"><a href="#COCO-jsonÂíåLabelme-jsonÂå∫Âà´" class="headerlink" title="COCO.jsonÂíåLabelme.jsonÂå∫Âà´"></a>COCO.jsonÂíåLabelme.jsonÂå∫Âà´</h2><p><del>ÂæÖÊõ¥</del><br>2021.11.13Â∑≤Êõ¥Êñ∞„ÄÇ</p>
<p>‰∏äÈù¢ÊúâÊèêÂà∞Labelme.jsonÊñá‰ª∂‰∏ªË¶ÅÊ†ºÂºèÔºåCOCOÊï∞ÊçÆÈõÜÂ§ßÊ¶ÇÈïøËøô‰∏™Ê†∑Â≠êÔºö</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span>
    <span class="token string">"images"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>image<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"annotations"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>annotation<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"categories"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>category<span class="token punctuation">]</span>
<span class="token punctuation">}</span>


image <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"width"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"height"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"file_name"</span><span class="token punctuation">:</span> str<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

annotation <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"image_id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"category_id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"segmentation"</span><span class="token punctuation">:</span> RLE <span class="token operator">or</span> <span class="token punctuation">[</span>polygon<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"area"</span><span class="token punctuation">:</span> float<span class="token punctuation">,</span>
    <span class="token string">"bbox"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"iscrowd"</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">or</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> str<span class="token punctuation">,</span>
    <span class="token string">"supercategory"</span><span class="token punctuation">:</span> str<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>COCOÁöÑjsonÊñá‰ª∂ÊòØÊâÄÊúâÂõæÁâáÈÉΩÊîæÂà∞‰∏Ä‰∏™jsonÊñá‰ª∂‰∏≠ÔºåÂπ∂‰∏îÁ±ªÂà´„ÄÅÂõæÁâáÊèêÂâçÈÉΩÁî®ÁºñÂè∑idÂÆö‰πâÂ•Ω„ÄÇ</p>
<p>Êàë‰ª¨ÂèØ‰ª•ÁªßÁª≠Áúã‰∏Ä‰∏ãLabelme.jsonÊñá‰ª∂ÂåÖÂê´‰ªÄ‰πàÔºö</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span>
  <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"4.5.13"</span><span class="token punctuation">,</span>
  <span class="token string">"flags"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"shapes"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"780B"</span><span class="token punctuation">,</span>
      <span class="token string">"points"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          <span class="token number">734.0</span><span class="token punctuation">,</span>
          <span class="token number">2425.0</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
          <span class="token number">2779.0</span><span class="token punctuation">,</span>
          <span class="token number">2355.0</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
          <span class="token number">2584.0</span><span class="token punctuation">,</span>
          <span class="token number">3580.0</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
          <span class="token number">819.0</span><span class="token punctuation">,</span>
          <span class="token number">3770.0</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"group_id"</span><span class="token punctuation">:</span> null<span class="token punctuation">,</span>
      <span class="token string">"shape_type"</span><span class="token punctuation">:</span> <span class="token string">"polygon"</span><span class="token punctuation">,</span>
      <span class="token string">"flags"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">{</span>
    <span class="token string">"label"</span><span class="token punctuation">:</span><span class="token string">"780B"</span><span class="token punctuation">,</span>
    <span class="token string">"points"</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"group_id"</span><span class="token punctuation">:</span> null<span class="token punctuation">,</span>
      <span class="token string">"shape_type"</span><span class="token punctuation">:</span> <span class="token string">"polygon"</span><span class="token punctuation">,</span>
      <span class="token string">"flags"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"imagePath"</span><span class="token punctuation">:</span> <span class="token string">"IMG_20211021_154043.jpg"</span><span class="token punctuation">,</span>
  <span class="token string">"imageData"</span><span class="token punctuation">:</span> null<span class="token punctuation">,</span>
  <span class="token string">"imageHeight"</span><span class="token punctuation">:</span> <span class="token number">4608</span><span class="token punctuation">,</span>
  <span class="token string">"imageWidth"</span><span class="token punctuation">:</span> <span class="token number">3456</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>labelmeÊñá‰ª∂ÊòØÊØè‰∏Ä‰∏™ÂõæÁâáÈÉΩÊúâËá™Â∑±ÁöÑjsonÊñá‰ª∂Ë¥üË¥£Â≠òÂÇ®ÂêÑ‰∏™ÂõæÁâá„ÄÇ</p>
<p>Âè¶Â§ñËøôÈáå‰ªãÁªç‰∏Ä‰∏ãCOCOÊï∞ÊçÆÈõÜ‰∏≠ÁöÑsegmentationÁ±ªÂûãÁöÑlabelÊòØ‰ªÄ‰πàÊ†∑Â≠êÁöÑÔºåÂÆûÈôÖ‰∏äÂ∞±ÊòØÁ±ª‰ºº‰∫éÂ§öËæπÂΩ¢ÁöÑÊØè‰∏Ä‰∏™È°∂ÁÇπËøô‰∏™Ê†∑ÂºèÔºåËøôÂØπÊàë‰ª¨ÁõÆÂâçÁöÑÊï∞ÊçÆÈõÜÈùûÂ∏∏Êñπ‰æøÔºåÂõ†‰∏∫Êàë‰ª¨ÁõÆÂâçÊï∞ÊçÆÈõÜÂπ∂Ê≤°ÊúâÊ†áÊ≥®ÊØè‰∏Ä‰∏™Áâ©‰ΩìÁöÑÂàÜÂâ≤Êï∞ÊçÆÈõÜÔºå‰ΩÜÊòØÊàë‰ª¨ÁöÑÁõÆÊ†áÊú¨Ë∫´Â∞±ÊòØÁü©ÂΩ¢Ê°ÜÔºåÊâÄ‰ª•Êàë‰ª¨Áõ¥Êé•Áî®Ê£ÄÊµãÁöÑlabelÂ∞±ÂèØ‰ª•Áõ¥Êé•ËΩ¨Âåñ‰∏∫COCOÊ†ºÂºèÁöÑÂàÜÂâ≤ÁöÑlabel„ÄÇÂõ†‰∏∫ÈÉΩÊòØÂè™Êúâ4‰∏™ÁÇπÂ∞±ÂèØ‰ª•„ÄÇ</p>
<h2 id="ËΩ¨Êç¢Ê∫êÁ†ÅÂàùÂßãÁâà"><a href="#ËΩ¨Êç¢Ê∫êÁ†ÅÂàùÂßãÁâà" class="headerlink" title="ËΩ¨Êç¢Ê∫êÁ†ÅÂàùÂßãÁâà"></a>ËΩ¨Êç¢Ê∫êÁ†ÅÂàùÂßãÁâà</h2><p>ÁõÆÂâçÊâìÁÆóËΩ¨Êç¢ÁöÑÊ∫êÁ†ÅÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""Êú¨Ê®°ÂùóÁî®‰∫éÊâπÈáèËΩ¨Êç¢labelmeÊ†áËÆ∞ÁöÑÊ†ºÂºèÔºå‰Ωø‰πãÂèòÊàêcocoÊï∞ÊçÆÈõÜÊ†ºÂºè"""</span>
<span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span>
<span class="token comment" spellcheck="true"># !/usr/bin/env python</span>


<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> json
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> skimage<span class="token punctuation">.</span>io <span class="token keyword">as</span> io
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> labelme <span class="token keyword">import</span> utils
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> PIL<span class="token punctuation">.</span>Image


<span class="token keyword">class</span> <span class="token class-name">MyEncoder</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>JSONEncoder<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">default</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> np<span class="token punctuation">.</span>integer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> int<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> np<span class="token punctuation">.</span>floating<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> float<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> obj<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> super<span class="token punctuation">(</span>MyEncoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">labelme2coco</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> labelme_json<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> save_json_path<span class="token operator">=</span><span class="token string">'./tran.json'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        labelme_json: ÊâÄÊúâlabelmeÁöÑjsonÊñá‰ª∂Ë∑ØÂæÑÁªÑÊàêÁöÑÂàóË°®
        save_json_path: json‰øùÂ≠ò‰ΩçÁΩÆ
        '''</span>
        self<span class="token punctuation">.</span>labelme_json <span class="token operator">=</span> labelme_json
        self<span class="token punctuation">.</span>save_json_path <span class="token operator">=</span> save_json_path
        self<span class="token punctuation">.</span>images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>annotations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true"># self.data_coco = {}</span>
        self<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>annID <span class="token operator">=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">0</span>

        self<span class="token punctuation">.</span>save_json<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">data_transfer</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">for</span> num<span class="token punctuation">,</span> json_file <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>self<span class="token punctuation">.</span>labelme_json<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"num:"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'    '</span> <span class="token operator">+</span> json_file<span class="token punctuation">)</span>
            <span class="token keyword">with</span> open<span class="token punctuation">(</span>json_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
                data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Âä†ËΩΩjsonÊñá‰ª∂</span>
                self<span class="token punctuation">.</span>images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">(</span>data<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> shapes <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'shapes'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    label <span class="token operator">=</span> shapes<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>
                    <span class="token keyword">if</span> label <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>label<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>categorie<span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>
                    points <span class="token operator">=</span> shapes<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># ËøôÈáåÁöÑpointÊòØÁî®rectangleÊ†áÊ≥®ÂæóÂà∞ÁöÑÔºåÂè™Êúâ‰∏§‰∏™ÁÇπÔºåÈúÄË¶ÅËΩ¨ÊàêÂõõ‰∏™ÁÇπ</span>
                    <span class="token comment" spellcheck="true">#points.append([points[0][0], points[1][1]])</span>
                    <span class="token comment" spellcheck="true">#points.append([points[1][0], points[0][1]])</span>
                    self<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>annotation<span class="token punctuation">(</span>points<span class="token punctuation">,</span> label<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>annID <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">image</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        image <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        img <span class="token operator">=</span> utils<span class="token punctuation">.</span>img_b64_to_arr<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'imageData'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ëß£ÊûêÂéüÂõæÁâáÊï∞ÊçÆ</span>
        <span class="token comment" spellcheck="true"># img=io.imread(data['imagePath']) # ÈÄöËøáÂõæÁâáË∑ØÂæÑÊâìÂºÄÂõæÁâá</span>
        <span class="token comment" spellcheck="true"># img = cv2.imread(data['imagePath'], 0)</span>
        height<span class="token punctuation">,</span> width <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
        img <span class="token operator">=</span> None
        image<span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span> <span class="token operator">=</span> height
        image<span class="token punctuation">[</span><span class="token string">'width'</span><span class="token punctuation">]</span> <span class="token operator">=</span> width
        image<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true">#image['file_name'] = data['imagePath'].split("\\")[-1] #Ê≠§Ë°å‰∏çÈÄÇÂêàÊàëÁöÑÊï∞ÊçÆÈõÜ</span>
        image<span class="token punctuation">[</span><span class="token string">'file_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'imagePath'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

        self<span class="token punctuation">.</span>height <span class="token operator">=</span> height
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> width

        <span class="token keyword">return</span> image

    <span class="token keyword">def</span> <span class="token function">categorie</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        categorie <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        categorie<span class="token punctuation">[</span><span class="token string">'supercategory'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Cancer'</span>
        categorie<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>label<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment" spellcheck="true"># 0 ÈªòËÆ§‰∏∫ËÉåÊôØ</span>
        categorie<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> label
        <span class="token keyword">return</span> categorie

    <span class="token keyword">def</span> <span class="token function">annotation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">,</span> label<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        annotation <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        annotation<span class="token punctuation">[</span><span class="token string">'segmentation'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>list<span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        annotation<span class="token punctuation">[</span><span class="token string">'iscrowd'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        annotation<span class="token punctuation">[</span><span class="token string">'image_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># annotation['bbox'] = str(self.getbbox(points)) # ‰ΩøÁî®list‰øùÂ≠òjsonÊñá‰ª∂Êó∂Êä•ÈîôÔºà‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàÔºâ</span>
        <span class="token comment" spellcheck="true"># list(map(int,a[1:-1].split(','))) a=annotation['bbox'] ‰ΩøÁî®ËØ•ÊñπÂºèËΩ¨Êàêlist</span>
        annotation<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">(</span>map<span class="token punctuation">(</span>float<span class="token punctuation">,</span> self<span class="token punctuation">.</span>getbbox<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        annotation<span class="token punctuation">[</span><span class="token string">'area'</span><span class="token punctuation">]</span> <span class="token operator">=</span> annotation<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> annotation<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true"># annotation['category_id'] = self.getcatid(label)</span>
        annotation<span class="token punctuation">[</span><span class="token string">'category_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>getcatid<span class="token punctuation">(</span>label<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ê≥®ÊÑèÔºåÊ∫ê‰ª£Á†ÅÈªòËÆ§‰∏∫1</span>
        annotation<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>annID
        <span class="token keyword">return</span> annotation

    <span class="token keyword">def</span> <span class="token function">getcatid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> categorie <span class="token keyword">in</span> self<span class="token punctuation">.</span>categories<span class="token punctuation">:</span>
            <span class="token keyword">if</span> label <span class="token operator">==</span> categorie<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> categorie<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">getbbox</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># img = np.zeros([self.height,self.width],np.uint8)</span>
        <span class="token comment" spellcheck="true"># cv2.polylines(img, [np.asarray(points)], True, 1, lineType=cv2.LINE_AA)  # ÁîªËæπÁïåÁ∫ø</span>
        <span class="token comment" spellcheck="true"># cv2.fillPoly(img, [np.asarray(points)], 1)  # ÁîªÂ§öËæπÂΩ¢ ÂÜÖÈÉ®ÂÉèÁ¥†ÂÄº‰∏∫1</span>
        polygons <span class="token operator">=</span> points

        mask <span class="token operator">=</span> self<span class="token punctuation">.</span>polygons_to_mask<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>height<span class="token punctuation">,</span> self<span class="token punctuation">.</span>width<span class="token punctuation">]</span><span class="token punctuation">,</span> polygons<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#print(polygons)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>mask2box<span class="token punctuation">(</span>mask<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">mask2box</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''‰ªémaskÂèçÁÆóÂá∫ÂÖ∂ËæπÊ°Ü
        maskÔºö[h,w]  0„ÄÅ1ÁªÑÊàêÁöÑÂõæÁâá
        1ÂØπÂ∫îÂØπË±°ÔºåÂè™ÈúÄËÆ°ÁÆó1ÂØπÂ∫îÁöÑË°åÂàóÂè∑ÔºàÂ∑¶‰∏äËßíË°åÂàóÂè∑ÔºåÂè≥‰∏ãËßíË°åÂàóÂè∑ÔºåÂ∞±ÂèØ‰ª•ÁÆóÂá∫ÂÖ∂ËæπÊ°ÜÔºâ
        '''</span>
        <span class="token comment" spellcheck="true"># np.where(mask==1)</span>
        index <span class="token operator">=</span> np<span class="token punctuation">.</span>argwhere<span class="token punctuation">(</span>mask <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#print(index)</span>


        rows <span class="token operator">=</span> index<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        clos <span class="token operator">=</span> index<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true"># Ëß£ÊûêÂ∑¶‰∏äËßíË°åÂàóÂè∑</span>
        <span class="token comment" spellcheck="true">#print(rows)</span>
        left_top_r <span class="token operator">=</span> np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>rows<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># y</span>
        left_top_c <span class="token operator">=</span> np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>clos<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># x</span>

        <span class="token comment" spellcheck="true"># Ëß£ÊûêÂè≥‰∏ãËßíË°åÂàóÂè∑</span>
        right_bottom_r <span class="token operator">=</span> np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>rows<span class="token punctuation">)</span>
        right_bottom_c <span class="token operator">=</span> np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>clos<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># return [(left_top_r,left_top_c),(right_bottom_r,right_bottom_c)]</span>
        <span class="token comment" spellcheck="true"># return [(left_top_c, left_top_r), (right_bottom_c, right_bottom_r)]</span>
        <span class="token comment" spellcheck="true"># return [left_top_c, left_top_r, right_bottom_c, right_bottom_r]  # [x1,y1,x2,y2]</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>left_top_c<span class="token punctuation">,</span> left_top_r<span class="token punctuation">,</span> right_bottom_c <span class="token operator">-</span> left_top_c<span class="token punctuation">,</span>
                right_bottom_r <span class="token operator">-</span> left_top_r<span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># [x1,y1,w,h] ÂØπÂ∫îCOCOÁöÑbboxÊ†ºÂºè</span>

    <span class="token keyword">def</span> <span class="token function">polygons_to_mask</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img_shape<span class="token punctuation">,</span> polygons<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mask <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>img_shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
        mask <span class="token operator">=</span> PIL<span class="token punctuation">.</span>Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>mask<span class="token punctuation">)</span>
        xy <span class="token operator">=</span> list<span class="token punctuation">(</span>map<span class="token punctuation">(</span>tuple<span class="token punctuation">,</span> polygons<span class="token punctuation">)</span><span class="token punctuation">)</span>
        PIL<span class="token punctuation">.</span>ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">.</span>polygon<span class="token punctuation">(</span>xy<span class="token operator">=</span>xy<span class="token punctuation">,</span> outline<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        mask <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>mask<span class="token punctuation">,</span> dtype<span class="token operator">=</span>bool<span class="token punctuation">)</span>
        <span class="token keyword">return</span> mask

    <span class="token keyword">def</span> <span class="token function">data2coco</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data_coco <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        data_coco<span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>images
        data_coco<span class="token punctuation">[</span><span class="token string">'categories'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>categories
        data_coco<span class="token punctuation">[</span><span class="token string">'annotations'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>annotations
        <span class="token keyword">return</span> data_coco

    <span class="token keyword">def</span> <span class="token function">save_json</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>data_transfer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>data_coco <span class="token operator">=</span> self<span class="token punctuation">.</span>data2coco<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># ‰øùÂ≠òjsonÊñá‰ª∂</span>
        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data_coco<span class="token punctuation">,</span> open<span class="token punctuation">(</span>self<span class="token punctuation">.</span>save_json_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> cls<span class="token operator">=</span>MyEncoder<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># indent=4 Êõ¥Âä†ÁæéËßÇÊòæÁ§∫</span>


labelme_json <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'H:/camellia/Aug/ËÆ≠ÁªÉ/val_json/*.json'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>labelme_json<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># labelme_json=['./Annotations/*.json']</span>
<span class="token comment" spellcheck="true"># labelme_json=glob.glob('./Annotations/*.json')</span>

saveme_json <span class="token operator">=</span> <span class="token string">'H:/camellia/Aug/ËÆ≠ÁªÉ/annotations/val.json'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Start."</span><span class="token punctuation">)</span>

labelme2coco<span class="token punctuation">(</span>labelme_json<span class="token punctuation">,</span> saveme_json<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Finished."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="‰ª£Á†ÅËØ¶Ëß£"><a href="#‰ª£Á†ÅËØ¶Ëß£" class="headerlink" title="‰ª£Á†ÅËØ¶Ëß£"></a>‰ª£Á†ÅËØ¶Ëß£</h2><p>ÊåâÁÖßËøêË°åÈ°∫Â∫èÊù•Ëß£Èáä‰ª£Á†ÅÔºö</p>
<h3 id="main"><a href="#main" class="headerlink" title="main()"></a>main()</h3><p>ÂÖ≥‰∫é‰ª•‰∏ä‰ª£Á†ÅÔºåÊàë‰ª¨ÂèØ‰ª•Ê†πÊçÆËøêË°åÁöÑÈ°∫Â∫èÊù•ÂÆö‰πâÔºåÈ¶ñÂÖàÊòØglob‰∫ÜÊâÄÊúâ.jsonÂâçÁºÄÁöÑÊñá‰ª∂ÔºåÂõ†‰∏∫Êàë‰ª¨labelmeÁöÑÊñá‰ª∂ÈÉΩÊòØ‰∏Ä‰∏™ÂõæÁâá‰∏ìÈó®ÁîüÊàê‰∏Ä‰∏™.jsonÊñá‰ª∂ÔºåËÄåÊàë‰ª¨ÁöÑCOCOÊï∞ÊçÆÈõÜÊ†ºÂºèÊòØÊâÄÊúâÁöÑÂõæÁâáÁöÑ‰ø°ÊÅØÈÉΩÊîæÂà∞‰∫Ü‰∏Ä‰∏™.jsonÂõæÁâá‰∏≠ÔºåÊé•ÁùÄÊàë‰ª¨ÂÆö‰πâ‰øùÂ≠òÂà∞ÁöÑjsonÊñá‰ª∂ÔºåÁÑ∂ÂêéÁõ¥Êé•Ë∞ÉÁî®Á±ªlabelme2coco,ÁÑ∂ÂêéÁõ¥Êé•ÂæóÂà∞ÁöÑÁªìÊûú„ÄÇ</p>
<h3 id="labelme2coco"><a href="#labelme2coco" class="headerlink" title="labelme2coco"></a>labelme2coco</h3><p>labelme2cocoÊòØÊï¥‰∏™Êñá‰ª∂ÁöÑÂÖ≥ÈîÆ„ÄÇ</p>
<h3 id="init"><a href="#init" class="headerlink" title="__init__"></a><code>__init__</code></h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">labelme2coco</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> labelme_json<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> save_json_path<span class="token operator">=</span><span class="token string">'./tran.json'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># ËøôÈáåÂÆö‰πâ‰∫ÜÈªòËÆ§ÁöÑÂ≠òÂÇ®Ë∑ØÂæÑ</span>
        <span class="token triple-quoted-string string">'''
        labelme_json: ÊâÄÊúâlabelmeÁöÑjsonÊñá‰ª∂Ë∑ØÂæÑÁªÑÊàêÁöÑÂàóË°®
        save_json_path: json‰øùÂ≠ò‰ΩçÁΩÆ
        '''</span>
        self<span class="token punctuation">.</span>labelme_json <span class="token operator">=</span> labelme_json     <span class="token comment" spellcheck="true"># labelme_jsonÁöÑÊñá‰ª∂Ë∑ØÂæÑÔºåÊòØ‰∏Ä‰∏™ÂàóË°®Â≠òÂÇ®ÁùÄÊâÄÊúâÁöÑÂæÖËΩ¨ÂåñjsonÊñá‰ª∂Ë∑ØÂæÑ</span>
        self<span class="token punctuation">.</span>save_json_path <span class="token operator">=</span> save_json_path  <span class="token comment" spellcheck="true"># ‰øùÂ≠òÁöÑË∑ØÂæÑ</span>
        self<span class="token punctuation">.</span>images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># ÂØπÂ∫îÁîüÊàêCOCOÂΩ¢ÂºèjsonÊñá‰ª∂ÁöÑimageÁöÑÁ±ªÂûã„ÄÇ</span>
        self<span class="token punctuation">.</span>categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># Âêå‰∏ä</span>
        self<span class="token punctuation">.</span>annotations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># Âêå‰∏ä</span>
        <span class="token comment" spellcheck="true"># self.data_coco = {}</span>
        self<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>annID <span class="token operator">=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">0</span>

        self<span class="token punctuation">.</span>save_json<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ê≥®ÊÑèËøôÈáå‰∏ÄË∞ÉÁî®ËØ•Á±ªÂ∞±Áõ¥Êé•ËøêË°åÁõ∏ÂÖ≥ÁöÑÊâÄÊúâ‰ª£Á†Å‰∫ÜÔºåËøô‰∏™ÊäÄÂ∑ßÂæàÊúâÁî®„ÄÇ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êàë‰ª¨Êé•‰∏ãÊù•Â∫îËØ•Áúã<code>save_json()</code>Ôºö</p>
<h3 id="save-json"><a href="#save-json" class="headerlink" title="save_json()"></a>save_json()</h3><pre class="line-numbers language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">save_json</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>data_transfer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>data_coco <span class="token operator">=</span> self<span class="token punctuation">.</span>data2coco<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># ‰øùÂ≠òjsonÊñá‰ª∂</span>
        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data_coco<span class="token punctuation">,</span> open<span class="token punctuation">(</span>self<span class="token punctuation">.</span>save_json_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> cls<span class="token operator">=</span>MyEncoder<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># indent=4 Êõ¥Âä†ÁæéËßÇÊòæÁ§∫</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ëøô‰∏™ÂèØ‰ª•ÁúãÂà∞ÂÆûÈôÖ‰∏äÂ∞±ÊòØ‰∏Ä‰∏™Ë∞ÉÁî®ÁöÑÁ±ªÂÜÖÁöÑÂáΩÊï∞Êù•ÊÄª‰ΩìË∞ÉÁî®„ÄÇÊàë‰ª¨ÁªßÁª≠Êù•Áúãdata_transfer()</p>
<h3 id="data-transfer"><a href="#data-transfer" class="headerlink" title="data_transfer()"></a>data_transfer()</h3><pre class="line-numbers language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">data_transfer</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">for</span> num<span class="token punctuation">,</span> json_file <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>self<span class="token punctuation">.</span>labelme_json<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"num:"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'    '</span> <span class="token operator">+</span> json_file<span class="token punctuation">)</span>
            <span class="token keyword">with</span> open<span class="token punctuation">(</span>json_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
                data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Âä†ËΩΩjsonÊñá‰ª∂</span>
                self<span class="token punctuation">.</span>images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">(</span>data<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ê≥®ÊÑèËøô‰∏™imageÊòØ‰∏™ÂáΩÊï∞ÔºÅ Â∞ÜËØ•ÂõæÁâáÁöÑÊâÄÊúâÁõ∏Â∫îÁöÑ‰ø°ÊÅØËΩ¨Âåñ‰∏∫COCOÁöÑimageÊ†ºÂºè</span>
                <span class="token keyword">for</span> shapes <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'shapes'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># shapesÊòØ‰∏ªË¶ÅÁöÑÊ†áÊ≥®‰ø°ÊÅØÔºåÊàë‰ª¨ÈáçÁÇπÂ∞±ÊòØËØªÂèñËøô‰∏™Ôºå‰ΩÜÊòØÊàë‰ª¨Ê≤°ÊúâÂøÖË¶ÅËØªÂèñÊâÄÊúâÔºåÂèØËÉΩÂè™ÈúÄË¶ÅËØªÂèñÁ¨¨‰∏Ä‰∏™780bÂ∞±ÂèØ‰ª•</span>
                    label <span class="token operator">=</span> shapes<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># Ê≥®ÊÑèËøôÈáåÊòØ‰∏Ä‰∏™Âæ™ÁéØÔºåËøô‰∏™Âæ™ÁéØÂ∞ÜÊâÄÊúâÁöÑlabelÊúâÂÖ≥Êñá‰ª∂ÈÉΩÂæ™ÁéØ‰∫Ü‰∏ÄÈÅç</span>
                    <span class="token keyword">if</span> label <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>label<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>categorie<span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ê≥®ÊÑèËøô‰∏™self.categorie‰πüÊòØ‰∏™ÂáΩÊï∞ÔºåËøô‰∏™‰ª£Á†ÅÊÆµÂ∞±ÊòØË¶ÅÁîüÊàêCOCOÁöÑcategoriesÊ†ºÂºè</span>
                        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>
                    points <span class="token operator">=</span> shapes<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># ËøôÈáåÁöÑpointÊòØÁî®rectangleÊ†áÊ≥®ÂæóÂà∞ÁöÑÔºåÂè™Êúâ‰∏§‰∏™ÁÇπÔºåÈúÄË¶ÅËΩ¨ÊàêÂõõ‰∏™ÁÇπ</span>
                    <span class="token comment" spellcheck="true">#points.append([points[0][0], points[1][1]])</span>
                    <span class="token comment" spellcheck="true">#points.append([points[1][0], points[0][1]])</span>
                    self<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>annotation<span class="token punctuation">(</span>points<span class="token punctuation">,</span> label<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ÂêåÊ†∑ÁöÑÔºåself.annotation‰πüÊòØ‰∏Ä‰∏™Áõ∏Â∫îÁöÑÂáΩÊï∞Ë¶ÅÂ∞ÜÊâÄÁªôÁöÑpointsÊñá‰ª∂ËΩ¨Âåñ‰∏∫annotationÂíåsegmentationÊñá‰ª∂</span>
                    self<span class="token punctuation">.</span>annID <span class="token operator">+=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ËøôÈáå‰∏ÄÊ≠•‰∏ÄÊ≠•ËØ¥ÔºåÈ¶ñÂÖàÂ∞±ÊòØË¶ÅÂ∞ÜÊâÄÊúâÁöÑjsonÊñá‰ª∂Âæ™ÁéØÈÅçÂéÜ‰∏ÄÈÅçÔºå‰πãÂêéÊâìÂºÄÊØè‰∏™Êñá‰ª∂ÔºåÈ¶ñÂÖàÂä†ËΩΩÊñá‰ª∂Ôºå‰πãÂêéË∞ÉÁî®Á±ª‰∏≠ÂÆö‰πâÂ•ΩÁöÑself.image()ÂáΩÊï∞,Ëøô‰∏™ÂáΩÊï∞Â∞ÜËØ•ÂõæÁâáÊâÄÊúâÁõ∏Â∫îÁöÑ‰ø°ÊÅØËΩ¨ÂåñÊàêCOCOÁöÑimageÁöÑÊ†ºÂºèÁÑ∂ÂêéËøîÂõûCOCOÊ†ºÂºèÁöÑ‰ø°ÊÅØÔºåÊàë‰ª¨Â∞ÜËøô‰∏™‰ø°ÊÅØÂä†Âà∞self.images‰∏≠Âéª„ÄÇÊàë‰ª¨ÂÖàËß£Êûê‰∏Ä‰∏ãÁõ∏ÂÖ≥ÁöÑself.image()ÂáΩÊï∞„ÄÇ</p>
<h3 id="image"><a href="#image" class="headerlink" title="image()"></a>image()</h3><p>ÂÆûÈôÖ‰∏äimage()ÈúÄË¶ÅÁöÑ‰ø°ÊÅØ‰πüÂ∞±ÊòØ‰∏Ä‰∏™ÂõæÁâáÁöÑÈ´òÂÆΩ„ÄÅÂ∞ÜÂõæÁâáÊï¥ÁêÜÊàêÁºñÂè∑ÔºåÂõæÁâáÂêç„ÄÇ</p>
<pre class="line-numbers language-python"><code class="language-python">image <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"width"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"height"</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    <span class="token string">"file_name"</span><span class="token punctuation">:</span> str<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>imageÂáΩÊï∞ÂÆûÈôÖ‰∏äÂ∞±ÊòØËØªÂèñ‰∫Ü‰ª•‰∏äÁöÑÊèê‰æõÁöÑ‰ø°ÊÅØÁÑ∂ÂêéËΩ¨ÂåñËøáÂéªÔºö</p>
<pre class="line-numbers language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">image</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        image <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        img <span class="token operator">=</span> utils<span class="token punctuation">.</span>img_b64_to_arr<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'imageData'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ëß£ÊûêÂéüÂõæÁâáÊï∞ÊçÆÔºåÊ≥®ÊÑèÊàë‰ª¨Âπ∂‰∏çÊòØÊâÄÊúâÊñá‰ª∂ÈÉΩÊúâ,ÊÄ™‰∏çÂæóÊâÄÊúâÊñá‰ª∂ÈÉΩÊâìÂºÄËøêË°å‰ºöÊä•ÈîôÔºåÁúüÊòØÂ•ΩÂ•áÊÄ™Ôºå‰ΩÜÊòØÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÊñá‰ª∂Ë∑ØÂæÑÊâìÂºÄÔºåÂèÇËßÅ‰∏ã‰∏ÄË°å‰ª£Á†Å</span>
        <span class="token comment" spellcheck="true"># img=io.imread(os.path.join(root, data['imagePath'])) # ÈÄöËøáÂõæÁâáË∑ØÂæÑÊâìÂºÄÂõæÁâáÔºå ‰∏çËøáËøô‰∏™Â∞±ÈúÄË¶ÅËÆæ‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑroot</span>
        <span class="token comment" spellcheck="true"># img = cv2.imread(data['imagePath'], 0)</span>
        height<span class="token punctuation">,</span> width <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
        img <span class="token operator">=</span> None
        image<span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span> <span class="token operator">=</span> height
        image<span class="token punctuation">[</span><span class="token string">'width'</span><span class="token punctuation">]</span> <span class="token operator">=</span> width
        image<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true">#image['file_name'] = data['imagePath'].split("\\")[-1] #Ê≠§Ë°å‰∏çÈÄÇÂêàÊàëÁöÑÊï∞ÊçÆÈõÜ</span>
        image<span class="token punctuation">[</span><span class="token string">'file_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'imagePath'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

        self<span class="token punctuation">.</span>height <span class="token operator">=</span> height
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> width

        <span class="token keyword">return</span> image<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ê≥®ÊÑèÂà∞Êàë‰ª¨ÊúÄÁªàËøîÂõûÁöÑÊòØ‰∏Ä‰∏™Â≠óÂÖ∏„ÄÇ<br>ËøôÈáåÊàë‰ª¨ÂèëÁé∞Áî®Âà∞‰∫Ü‰∏Ä‰∏™ÂáΩÊï∞utils.img_b64_to_arr()ÔºåËøô‰∏™ÂáΩÊï∞ÊòØÁî®Êù•Â∞ÜÊàë‰ª¨ÁöÑÂõæÁâáËØªÂèñÊàêcv2ÁöÑimgÊ†ºÂºèÁü©ÈòµÔºåËøô‰∏™utilsÂÆûÈôÖ‰∏äÊòØlabelmeËøô‰∏™Â∫ì‰∏≠ÁöÑ‰∏Ä‰∏™Ê®°Âùó„ÄÇÁõÆÂâçÊàëÁöÑÁêÜËß£ÊòØÔºålabelmeÁîüÊàêÁöÑ.jsonÊñá‰ª∂ÈáåÈù¢ÁöÑimageDataÊòØ‰∏ÄÂ†ÜÊàëÁúã‰∏çÊáÇÁöÑÁºñÁ†ÅÔºåËøô‰∫õÁºñÁ†ÅÂÆûÈôÖ‰∏äÂ≠òÂÇ®ÁöÑÂ∞±ÊòØÂõæÁâáÁöÑ‰ø°ÊÅØÔºåÁÑ∂ÂêéÊàë‰ª¨ÈÄöËøá<code>img_b64_to_arr()</code>ÂáΩÊï∞Êù•‚ÄúÁøªËØë‚Äù‰∏∫Êàë‰ª¨ËÉΩÁúãÊáÇÁöÑÂõæÁâáRGBÁü©ÈòµÂΩ¢ÂºèÂ≠òÂÇ®„ÄÇ<br>ÂèØ‰ª•ÁúãÂà∞‰∏ãÈù¢ÁöÑÊ≥®Èáä‰πüÁªôÂá∫‰∫Ü‰∏Ä‰∫õÂÖ∂‰ªñÊñπÂºèÁöÑÊâìÂºÄÂõæÁâáÂΩ¢ÂºèÔºåÊúâÁî®cv2ËØªÂèñÔºåÊúâÁî®skimage.ioËØªÂèñÁöÑÔºåÂõ†‰∏∫ÊúâÂèØËÉΩÊàë‰ª¨data[‚ÄòimageData‚Äô]ÁöÑÂÄº‰∏∫null(<del>ÊàëÁõÆÂâçÈ°πÁõÆÁöÑÊï∞ÊçÆÈõÜÂ∞±ÊòØËøôÊ†∑</del>)„ÄÇÂÖ∂‰ªñÁöÑÊ†ºÂºèÈÉΩÊòØÂæàÁÆÄÂçïÁöÑÂ§çÂà∂‰∫ÜÔºåÁõ∏ÂØπËÄåË®Ä‰∏çÁî®Â§öËØ¥„ÄÇ</p>
<h3 id="data-transfer-1"><a href="#data-transfer-1" class="headerlink" title="data_transfer()"></a>data_transfer()</h3><p>Â•Ω‰∫ÜÊàë‰ª¨Êé•‰∏ãÊù•ÁªßÁª≠ËØ¥Êàë‰ª¨ÁöÑdata_transfer()ÂáΩÊï∞„ÄÇÊé•‰∏ãÊù•ÊòØÂØπdata[‚Äòshapes‚Äô]ÊâÄÊúâÊñá‰ª∂ËøõË°å‰∏Ä‰∏™ÈÅçÂéÜÔºåshapesÊòØ‰∏ªË¶ÅÁöÑÊ†áÊ≥®‰ø°ÊÅØÔºåÊàë‰ª¨ÈáçÁÇπÂ∞±ÊòØËØªÂèñËøô‰∏™ÔºåshapesÈáåÈù¢ÂåÖÂê´ÁùÄÊâÄÊúâÁöÑÊ†áÊ≥®Ê°Üground truth‰ø°ÊÅØÔºåÂΩìÁÑ∂Êàë‰ª¨ËøôÈáåÂõ†‰∏∫‰ªÖ‰ªÖÂØπ‰∏Ä‰∏™Â§ßÊ°ÜÂÅöÂàÜÂâ≤ÊâÄ‰ª•Âè™ÈúÄË¶Å‰∏Ä‰∏™780BÁöÑlabelÂ∞±ÂèØ‰ª•ÔºåËøôÈáåÂÆÉÂ∞ÜÊâÄÊúâÈÉΩÈÅçÂéÜ‰∫Ü‰∏ÄÈÅçÔºåÁÑ∂ÂêéË∞ÉÁî®‰∫Üself.categorieÂáΩÊï∞Êù•ËÆ©Êàë‰ª¨ÁöÑlabelÈáåÈù¢ÁöÑ‰ø°ÊÅØËΩ¨Âåñ‰∏∫COCOÊ†ºÂºèÁöÑ„ÄÇÂÆûÈôÖ‰∏äÂ∞±ÊòØÂèò‰∏∫COCOÊ†ºÂºèjsonÊñá‰ª∂‰∏≠ÈÇ£‰∏™categoriesÁ±ªÂûãÔºåÊàë‰ª¨ÁªßÁª≠Êù•Áúãself.categorie()</p>
<h3 id="categorie"><a href="#categorie" class="headerlink" title="categorie()"></a>categorie()</h3><pre class="line-numbers language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">categorie</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        categorie <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        categorie<span class="token punctuation">[</span><span class="token string">'supercategory'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Cancer'</span>
        categorie<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>label<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment" spellcheck="true"># 0 ÈªòËÆ§‰∏∫ËÉåÊôØ</span>
        categorie<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> label
        <span class="token keyword">return</span> categorie<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂÆûÈôÖ‰∏äÈùûÂ∏∏ÁÆÄÂçïÔºåÂõ†‰∏∫COCOÈáåÈù¢ÁöÑcategoriesÂè™ÈúÄË¶ÅÁü•ÈÅìÊï¥‰∏™Êï∞ÊçÆÈõÜÊúâÂì™‰∫õÁ±ªÔºåÊØè‰∏™Á±ªÈÉΩÊúâ‰∏Ä‰∏™ÂØπÂ∫îÁöÑidÂ∞±OK‰∫Ü„ÄÇ</p>
<h3 id="data-transfer-2"><a href="#data-transfer-2" class="headerlink" title="data_transfer()"></a>data_transfer()</h3><p>ÂÆûÈôÖ‰∏äÂêéÈù¢ÈÉΩÊòØÁ±ª‰ººÁöÑÔºåÂØπÂ∫îÁöÑÂäüËÉΩË∞ÉÁî®Áõ∏Â∫îÁöÑÂáΩÊï∞Â∞±OK„ÄÇËøôÈáå‰∏çËØ¶ÁªÜË∞à‰∫ÜÔºåÊ≤°ÊúâÂøÖË¶ÅËØ¶ÁªÜËß£Èáä„ÄÇ</p>
<h3 id="data2coco"><a href="#data2coco" class="headerlink" title="data2coco()"></a>data2coco()</h3><p>ÈöèÂêéÊàë‰ª¨ÁúãÂà∞ËøôÈáåË∞ÉÁî®‰∫ÜÁõ∏ÂÖ≥ÁöÑÂáΩÊï∞ËΩ¨Âåñ‰∏∫jsonÊñá‰ª∂ÈúÄË¶ÅÁöÑÂ≠óÂÖ∏Ê†ºÂºèÔºö</p>
<pre class="line-numbers language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">data2coco</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data_coco <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        data_coco<span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>images
        data_coco<span class="token punctuation">[</span><span class="token string">'categories'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>categories
        data_coco<span class="token punctuation">[</span><span class="token string">'annotations'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>annotations
        <span class="token keyword">return</span> data_coco<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊúÄÂêéËøõË°å‰∏Ä‰∏ãjson.dumpÂ∞±ÊàêÂäü‰øùÂ≠òÂ•ΩjsonÊñá‰ª∂‰∫Ü„ÄÇ</p>
<h2 id="ËΩ¨Âåñ‰ª£Á†ÅÊúÄÁªàÊîπËâØÁâà"><a href="#ËΩ¨Âåñ‰ª£Á†ÅÊúÄÁªàÊîπËâØÁâà" class="headerlink" title="ËΩ¨Âåñ‰ª£Á†ÅÊúÄÁªàÊîπËâØÁâà"></a>ËΩ¨Âåñ‰ª£Á†ÅÊúÄÁªàÊîπËâØÁâà</h2><p>ÁªèËøá‰∏äËø∞ÊèèËø∞ÔºåÊúÄÁªàÂÅö‰∏Ä‰∏™ÊîπËâØÔºåÂæóÂà∞Áõ∏Â∫îÁöÑÁªìÊûúÔºö</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""Êú¨Ê®°ÂùóÁî®‰∫éÊâπÈáèËΩ¨Êç¢labelmeÊ†áËÆ∞ÁöÑÊ†ºÂºèÔºå‰Ωø‰πãÂèòÊàêcocoÊï∞ÊçÆÈõÜÊ†ºÂºè"""</span>
<span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span>
<span class="token comment" spellcheck="true"># !/usr/bin/env python</span>


<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> json
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> skimage<span class="token punctuation">.</span>io <span class="token keyword">as</span> io
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> labelme <span class="token keyword">import</span> utils
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> PIL<span class="token punctuation">.</span>Image
<span class="token keyword">import</span> os


<span class="token keyword">class</span> <span class="token class-name">MyEncoder</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>JSONEncoder<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">default</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> np<span class="token punctuation">.</span>integer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> int<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> np<span class="token punctuation">.</span>floating<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> float<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> obj<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> super<span class="token punctuation">(</span>MyEncoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">labelme2coco</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> labelme_json<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> save_json_path<span class="token operator">=</span><span class="token string">'./tran.json'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># ËøôÈáåÂÆö‰πâ‰∫ÜÈªòËÆ§ÁöÑÂ≠òÂÇ®Ë∑ØÂæÑ</span>
        <span class="token triple-quoted-string string">'''
        labelme_json: ÊâÄÊúâlabelmeÁöÑjsonÊñá‰ª∂Ë∑ØÂæÑÁªÑÊàêÁöÑÂàóË°®
        save_json_path: json‰øùÂ≠ò‰ΩçÁΩÆ
        '''</span>
        self<span class="token punctuation">.</span>labelme_json <span class="token operator">=</span> labelme_json     <span class="token comment" spellcheck="true"># labelme_jsonÁöÑÊñá‰ª∂Ë∑ØÂæÑÔºåÊòØ‰∏Ä‰∏™ÂàóË°®Â≠òÂÇ®ÁùÄÊâÄÊúâÁöÑÂæÖËΩ¨ÂåñjsonÊñá‰ª∂Ë∑ØÂæÑ</span>
        self<span class="token punctuation">.</span>save_json_path <span class="token operator">=</span> save_json_path  <span class="token comment" spellcheck="true"># ‰øùÂ≠òÁöÑË∑ØÂæÑ</span>
        self<span class="token punctuation">.</span>images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># ÂØπÂ∫îÁîüÊàêCOCOÂΩ¢ÂºèjsonÊñá‰ª∂ÁöÑimageÁöÑÁ±ªÂûã„ÄÇ</span>
        self<span class="token punctuation">.</span>categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># Âêå‰∏ä</span>
        self<span class="token punctuation">.</span>annotations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># Âêå‰∏ä</span>
        <span class="token comment" spellcheck="true"># self.data_coco = {}</span>
        self<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>annID <span class="token operator">=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token string">'/home/lry/projects/mmdetection/data/780b/'</span>

        self<span class="token punctuation">.</span>save_json<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ê≥®ÊÑèËøôÈáå‰∏ÄË∞ÉÁî®ËØ•Á±ªÂ∞±Áõ¥Êé•ËøêË°åÁõ∏ÂÖ≥ÁöÑÊâÄÊúâ‰ª£Á†Å‰∫ÜÔºåËøô‰∏™ÊäÄÂ∑ßÂæàÊúâÁî®„ÄÇ</span>

    <span class="token keyword">def</span> <span class="token function">data_transfer</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">for</span> num<span class="token punctuation">,</span> json_file <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>self<span class="token punctuation">.</span>labelme_json<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"num:"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'    '</span> <span class="token operator">+</span> json_file<span class="token punctuation">)</span>
            <span class="token keyword">with</span> open<span class="token punctuation">(</span>json_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
                data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Âä†ËΩΩjsonÊñá‰ª∂</span>
                <span class="token comment" spellcheck="true"># Ê≥®ÊÑèËøô‰∏™imageÊòØ‰∏™ÂáΩÊï∞ÔºÅ Â∞ÜËØ•ÂõæÁâáÁöÑÊâÄÊúâÁõ∏Â∫îÁöÑ‰ø°ÊÅØËΩ¨Âåñ‰∏∫COCOÁöÑimageÊ†ºÂºè</span>
                self<span class="token punctuation">.</span>images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">(</span>data<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span>

                <span class="token comment" spellcheck="true"># shapesÊòØ‰∏ªË¶ÅÁöÑÊ†áÊ≥®‰ø°ÊÅØÔºåÊàë‰ª¨ÈáçÁÇπÂ∞±ÊòØËØªÂèñËøô‰∏™Ôºå‰ΩÜÊòØÊàë‰ª¨Ê≤°ÊúâÂøÖË¶ÅËØªÂèñÊâÄÊúâÔºåÂèØËÉΩÂè™ÈúÄË¶ÅËØªÂèñÁ¨¨‰∏Ä‰∏™780bÂ∞±ÂèØ‰ª•</span>
                <span class="token keyword">for</span> shapes <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'shapes'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>

                    <span class="token comment" spellcheck="true"># È¶ñÂÖàÊàë‰ª¨‰ºöÂà§Êñ≠ÊòØÂê¶Ëøô‰∏™labelÊòØÂê¶ÊòØ"780B"</span>
                    <span class="token keyword">if</span> shapes<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"780B"</span><span class="token punctuation">:</span>
                        <span class="token keyword">continue</span>

                    <span class="token comment" spellcheck="true"># Ê≥®ÊÑèËøôÈáåÊòØ‰∏Ä‰∏™Âæ™ÁéØÔºåËøô‰∏™Âæ™ÁéØÂ∞ÜÊâÄÊúâÁöÑlabelÊúâÂÖ≥Êñá‰ª∂ÈÉΩÂæ™ÁéØ‰∫Ü‰∏ÄÈÅç</span>
                    label <span class="token operator">=</span> shapes<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>
                    <span class="token keyword">if</span> label <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>label<span class="token punctuation">:</span>
                        <span class="token comment" spellcheck="true"># Ê≥®ÊÑèËøô‰∏™self.categorie‰πüÊòØ‰∏™ÂáΩÊï∞ÔºåËøô‰∏™‰ª£Á†ÅÊÆµÂ∞±ÊòØË¶ÅÁîüÊàêCOCOÁöÑcategoriesÊ†ºÂºè</span>
                        self<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>categorie<span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>
                    <span class="token comment" spellcheck="true"># ËøôÈáåÁöÑpointÊòØÁî®rectangleÊ†áÊ≥®ÂæóÂà∞ÁöÑÔºåÂè™Êúâ‰∏§‰∏™ÁÇπÔºåÈúÄË¶ÅËΩ¨ÊàêÂõõ‰∏™ÁÇπ</span>
                    points <span class="token operator">=</span> shapes<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span>
                    <span class="token comment" spellcheck="true">#points.append([points[0][0], points[1][1]])</span>
                    <span class="token comment" spellcheck="true">#points.append([points[1][0], points[0][1]])</span>
                    <span class="token comment" spellcheck="true"># ÂêåÊ†∑ÁöÑÔºåself.annotation‰πüÊòØ‰∏Ä‰∏™Áõ∏Â∫îÁöÑÂáΩÊï∞Ë¶ÅÂ∞ÜÊâÄÁªôÁöÑpointsÊñá‰ª∂ËΩ¨Âåñ‰∏∫annotationÂíåsegmentationÊñá‰ª∂</span>
                    self<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                        self<span class="token punctuation">.</span>annotation<span class="token punctuation">(</span>points<span class="token punctuation">,</span> label<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>annID <span class="token operator">+=</span> <span class="token number">1</span>


    <span class="token keyword">def</span> <span class="token function">image</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        image <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true"># Ëß£ÊûêÂéüÂõæÁâáÊï∞ÊçÆÔºåÊ≥®ÊÑèÊàë‰ª¨Âπ∂‰∏çÊòØÊâÄÊúâÊñá‰ª∂ÈÉΩÊúâ,ÊÄ™‰∏çÂæóÊâÄÊúâÊñá‰ª∂ÈÉΩÊâìÂºÄËøêË°å‰ºöÊä•ÈîôÔºåÁúüÊòØÂ•ΩÂ•áÊÄ™Ôºå‰ΩÜÊòØÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÊñá‰ª∂Ë∑ØÂæÑÊâìÂºÄÔºåÂèÇËßÅ‰∏ã‰∏ÄË°å‰ª£Á†Å</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            img <span class="token operator">=</span> utils<span class="token punctuation">.</span>img_b64_to_arr<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'imageData'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            img<span class="token operator">=</span>io<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">'imagePath'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ÈÄöËøáÂõæÁâáË∑ØÂæÑÊâìÂºÄÂõæÁâáÔºå ‰∏çËøáËøô‰∏™Â∞±ÈúÄË¶ÅËÆæ‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑroot</span>
        <span class="token comment" spellcheck="true"># img = cv2.imread(data['imagePath'], 0)</span>
        height<span class="token punctuation">,</span> width <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
        img <span class="token operator">=</span> None
        image<span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span> <span class="token operator">=</span> height
        image<span class="token punctuation">[</span><span class="token string">'width'</span><span class="token punctuation">]</span> <span class="token operator">=</span> width
        image<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># image['file_name'] = data['imagePath'].split("\\")[-1] #Ê≠§Ë°å‰∏çÈÄÇÂêàÊàëÁöÑÊï∞ÊçÆÈõÜ</span>
        image<span class="token punctuation">[</span><span class="token string">'file_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'imagePath'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

        self<span class="token punctuation">.</span>height <span class="token operator">=</span> height
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> width

        <span class="token keyword">return</span> image

    <span class="token keyword">def</span> <span class="token function">categorie</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        categorie <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true"># categorie['supercategory'] = 'Cancer'  # Ëøô‰∏™Êó†Áî®</span>
        categorie<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>label<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment" spellcheck="true"># 0 ÈªòËÆ§‰∏∫ËÉåÊôØ</span>
        categorie<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> label
        <span class="token keyword">return</span> categorie

    <span class="token keyword">def</span> <span class="token function">annotation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">,</span> label<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        annotation <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        annotation<span class="token punctuation">[</span><span class="token string">'segmentation'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>list<span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        annotation<span class="token punctuation">[</span><span class="token string">'iscrowd'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        annotation<span class="token punctuation">[</span><span class="token string">'image_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># annotation['bbox'] = str(self.getbbox(points)) # ‰ΩøÁî®list‰øùÂ≠òjsonÊñá‰ª∂Êó∂Êä•ÈîôÔºà‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàÔºâ</span>
        <span class="token comment" spellcheck="true"># list(map(int,a[1:-1].split(','))) a=annotation['bbox'] ‰ΩøÁî®ËØ•ÊñπÂºèËΩ¨Êàêlist</span>
        annotation<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">(</span>map<span class="token punctuation">(</span>float<span class="token punctuation">,</span> self<span class="token punctuation">.</span>getbbox<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        annotation<span class="token punctuation">[</span><span class="token string">'area'</span><span class="token punctuation">]</span> <span class="token operator">=</span> annotation<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> annotation<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true"># annotation['category_id'] = self.getcatid(label)</span>
        annotation<span class="token punctuation">[</span><span class="token string">'category_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>getcatid<span class="token punctuation">(</span>label<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ê≥®ÊÑèÔºåÊ∫ê‰ª£Á†ÅÈªòËÆ§‰∏∫1</span>
        annotation<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>annID
        <span class="token keyword">return</span> annotation

    <span class="token keyword">def</span> <span class="token function">getcatid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> categorie <span class="token keyword">in</span> self<span class="token punctuation">.</span>categories<span class="token punctuation">:</span>
            <span class="token keyword">if</span> label <span class="token operator">==</span> categorie<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> categorie<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">getbbox</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># img = np.zeros([self.height,self.width],np.uint8)</span>
        <span class="token comment" spellcheck="true"># cv2.polylines(img, [np.asarray(points)], True, 1, lineType=cv2.LINE_AA)  # ÁîªËæπÁïåÁ∫ø</span>
        <span class="token comment" spellcheck="true"># cv2.fillPoly(img, [np.asarray(points)], 1)  # ÁîªÂ§öËæπÂΩ¢ ÂÜÖÈÉ®ÂÉèÁ¥†ÂÄº‰∏∫1</span>
        polygons <span class="token operator">=</span> points

        mask <span class="token operator">=</span> self<span class="token punctuation">.</span>polygons_to_mask<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>height<span class="token punctuation">,</span> self<span class="token punctuation">.</span>width<span class="token punctuation">]</span><span class="token punctuation">,</span> polygons<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># print(polygons)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>mask2box<span class="token punctuation">(</span>mask<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">mask2box</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''‰ªémaskÂèçÁÆóÂá∫ÂÖ∂ËæπÊ°Ü
        maskÔºö[h,w]  0„ÄÅ1ÁªÑÊàêÁöÑÂõæÁâá
        1ÂØπÂ∫îÂØπË±°ÔºåÂè™ÈúÄËÆ°ÁÆó1ÂØπÂ∫îÁöÑË°åÂàóÂè∑ÔºàÂ∑¶‰∏äËßíË°åÂàóÂè∑ÔºåÂè≥‰∏ãËßíË°åÂàóÂè∑ÔºåÂ∞±ÂèØ‰ª•ÁÆóÂá∫ÂÖ∂ËæπÊ°ÜÔºâ
        '''</span>
        <span class="token comment" spellcheck="true"># np.where(mask==1)</span>
        index <span class="token operator">=</span> np<span class="token punctuation">.</span>argwhere<span class="token punctuation">(</span>mask <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># print(index)</span>

        rows <span class="token operator">=</span> index<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        clos <span class="token operator">=</span> index<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true"># Ëß£ÊûêÂ∑¶‰∏äËßíË°åÂàóÂè∑</span>
        <span class="token comment" spellcheck="true"># print(rows)</span>
        left_top_r <span class="token operator">=</span> np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>rows<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># y</span>
        left_top_c <span class="token operator">=</span> np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>clos<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># x</span>

        <span class="token comment" spellcheck="true"># Ëß£ÊûêÂè≥‰∏ãËßíË°åÂàóÂè∑</span>
        right_bottom_r <span class="token operator">=</span> np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>rows<span class="token punctuation">)</span>
        right_bottom_c <span class="token operator">=</span> np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>clos<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># return [(left_top_r,left_top_c),(right_bottom_r,right_bottom_c)]</span>
        <span class="token comment" spellcheck="true"># return [(left_top_c, left_top_r), (right_bottom_c, right_bottom_r)]</span>
        <span class="token comment" spellcheck="true"># return [left_top_c, left_top_r, right_bottom_c, right_bottom_r]  # [x1,y1,x2,y2]</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>left_top_c<span class="token punctuation">,</span> left_top_r<span class="token punctuation">,</span> right_bottom_c <span class="token operator">-</span> left_top_c<span class="token punctuation">,</span>
                right_bottom_r <span class="token operator">-</span> left_top_r<span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># [x1,y1,w,h] ÂØπÂ∫îCOCOÁöÑbboxÊ†ºÂºè</span>

    <span class="token keyword">def</span> <span class="token function">polygons_to_mask</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img_shape<span class="token punctuation">,</span> polygons<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mask <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>img_shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
        mask <span class="token operator">=</span> PIL<span class="token punctuation">.</span>Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>mask<span class="token punctuation">)</span>
        xy <span class="token operator">=</span> list<span class="token punctuation">(</span>map<span class="token punctuation">(</span>tuple<span class="token punctuation">,</span> polygons<span class="token punctuation">)</span><span class="token punctuation">)</span>
        PIL<span class="token punctuation">.</span>ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">.</span>polygon<span class="token punctuation">(</span>xy<span class="token operator">=</span>xy<span class="token punctuation">,</span> outline<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        mask <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>mask<span class="token punctuation">,</span> dtype<span class="token operator">=</span>bool<span class="token punctuation">)</span>
        <span class="token keyword">return</span> mask

    <span class="token keyword">def</span> <span class="token function">data2coco</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data_coco <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        data_coco<span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>images
        data_coco<span class="token punctuation">[</span><span class="token string">'categories'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>categories
        data_coco<span class="token punctuation">[</span><span class="token string">'annotations'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>annotations
        <span class="token keyword">return</span> data_coco

    <span class="token keyword">def</span> <span class="token function">save_json</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>data_transfer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>data_coco <span class="token operator">=</span> self<span class="token punctuation">.</span>data2coco<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># ‰øùÂ≠òjsonÊñá‰ª∂</span>
        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data_coco<span class="token punctuation">,</span> open<span class="token punctuation">(</span>self<span class="token punctuation">.</span>save_json_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> cls<span class="token operator">=</span>MyEncoder<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># indent=4 Êõ¥Âä†ÁæéËßÇÊòæÁ§∫</span>


<span class="token comment" spellcheck="true"># labelme_json = glob.glob(</span>
<span class="token comment" spellcheck="true">#     '/home/lry/projects/mmdetection/data/780b/*.json')</span>
<span class="token comment" spellcheck="true"># print(labelme_json)</span>


<span class="token comment" spellcheck="true"># # labelme_json=['./Annotations/*.json']</span>
<span class="token comment" spellcheck="true"># # labelme_json=glob.glob('./Annotations/*.json')</span>

<span class="token comment" spellcheck="true"># saveme_json = '/home/lry/projects/mmdetection/lry/draft.json'</span>
<span class="token comment" spellcheck="true"># print("Start.")</span>

<span class="token comment" spellcheck="true"># labelme2coco(labelme_json, saveme_json)</span>
<span class="token comment" spellcheck="true"># print("Finished.")</span>


val_json <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'/home/lry/data/780b_std/val/*.json'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>val_json<span class="token punctuation">)</span>
saveme_json <span class="token operator">=</span> <span class="token string">'/home/lry/data/780b_std/val/annotation_coco.json'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Start."</span><span class="token punctuation">)</span>

labelme2coco<span class="token punctuation">(</span>val_json<span class="token punctuation">,</span> saveme_json<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Finished."</span><span class="token punctuation">)</span>

train_json <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'/home/lry/data/780b_std/train/*.json'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>train_json<span class="token punctuation">)</span>
saveme_json <span class="token operator">=</span> <span class="token string">'/home/lry/data/780b_std/train/annotation_coco.json'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Start."</span><span class="token punctuation">)</span>

labelme2coco<span class="token punctuation">(</span>train_json<span class="token punctuation">,</span> saveme_json<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Finished."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ÂàíÂàÜËÆ≠ÁªÉÈõÜÂíåÈ™åËØÅÈõÜ"><a href="#ÂàíÂàÜËÆ≠ÁªÉÈõÜÂíåÈ™åËØÅÈõÜ" class="headerlink" title="ÂàíÂàÜËÆ≠ÁªÉÈõÜÂíåÈ™åËØÅÈõÜ"></a>ÂàíÂàÜËÆ≠ÁªÉÈõÜÂíåÈ™åËØÅÈõÜ</h2><p>ËøôÈáåÊåâÁÖß7Ôºö3Êù•ÂàíÂàÜËÆ≠ÁªÉÈõÜÂíåÈ™åËØÅÈõÜ:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""Êú¨Ê®°ÂùóÁî®‰∫éÂàíÂàÜÈ™åËØÅÈõÜÂíåÊµãËØïÈõÜÔºåÂ§ßÊ¶ÇÊØî‰æã‰∏∫7Ôºö3"""</span>

<span class="token keyword">import</span> shutil
<span class="token keyword">import</span> os
<span class="token keyword">import</span> random
<span class="token keyword">import</span> glob

<span class="token keyword">def</span> <span class="token function">move_file</span><span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> imgs<span class="token punctuation">,</span>  new_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''Ëøô‰∏™ÂáΩÊï∞ÊòØÁî®Êù•ÁßªÂä®ÂõæÁâáÂíåÁõ∏Â∫îÁöÑjsonÊñá‰ª∂'''</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>old_path<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>new_path<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># filelist = os.listdir(old_path) #ÂàóÂá∫ËØ•ÁõÆÂΩï‰∏ãÁöÑÊâÄÊúâÊñá‰ª∂,listdirËøîÂõûÁöÑÊñá‰ª∂ÂàóË°®ÊòØ‰∏çÂåÖÂê´Ë∑ØÂæÑÁöÑ„ÄÇ</span>
    filelist <span class="token operator">=</span> imgs
    <span class="token keyword">print</span><span class="token punctuation">(</span>filelist<span class="token punctuation">)</span>
    <span class="token keyword">for</span> file <span class="token keyword">in</span> filelist<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># file = file - "/home/lry/data/780b_std/"</span>
        src <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> file<span class="token punctuation">[</span>len<span class="token punctuation">(</span><span class="token string">"/home/lry/data/780b_std/"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        dst <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>new_path<span class="token punctuation">,</span> file<span class="token punctuation">[</span>len<span class="token punctuation">(</span><span class="token string">"/home/lry/data/780b_std/"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        src_json <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> file<span class="token punctuation">[</span>len<span class="token punctuation">(</span><span class="token string">"/home/lry/data/780b_std/"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">)</span>
        dst_json <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>new_path<span class="token punctuation">,</span> file<span class="token punctuation">[</span>len<span class="token punctuation">(</span><span class="token string">"/home/lry/data/780b_std/"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'src:'</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'dst:'</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
        shutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
        shutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span>src_json<span class="token punctuation">,</span> dst_json<span class="token punctuation">)</span>


old_path <span class="token operator">=</span> <span class="token string">"/home/lry/data/780b_std"</span>

new_val <span class="token operator">=</span> <span class="token string">"/home/lry/data/780b_std/val"</span>
new_train <span class="token operator">=</span> <span class="token string">"/home/lry/data/780b_std/train"</span>

pics <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">"/home/lry/data/780b_std/*.json"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(len(pics))</span>
<span class="token comment" spellcheck="true"># print(pics[0][len("/home/lry/data/780b_std/"):-5] + ".jpg")</span>
<span class="token comment" spellcheck="true"># print(pics[0][:-4])</span>
<span class="token comment" spellcheck="true"># print(pics)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"moving...."</span><span class="token punctuation">)</span>
move_file<span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> pics<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">140</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train end!"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"moving..."</span><span class="token punctuation">)</span>
move_file<span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> pics<span class="token punctuation">[</span><span class="token number">140</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_val<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"val end!"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ËÆæÂÆöconfigÊñá‰ª∂"><a href="#ËÆæÂÆöconfigÊñá‰ª∂" class="headerlink" title="ËÆæÂÆöconfigÊñá‰ª∂"></a>ËÆæÂÆöconfigÊñá‰ª∂</h2><p>Êàë‰ª¨ÂÜ≥ÂÆöÁî®mask_rcnnÔºåËøôÈáåÁõ¥Êé•Âú®<code>configs</code>ÁõÆÂΩï‰∏ãÂàõÂª∫‰∏Ä‰∏™Êñá‰ª∂Â§πÂè´ÂÅöfenghuoÔºåÁÑ∂ÂêéÂä†ÂÖ•‰∏Ä‰∏™<code>mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo.py</code>Êñá‰ª∂Â∞±OK„ÄÇÊñá‰ª∂ÂÜÖÂÆπ‰∏∫Ôºö</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""Êú¨Ê®°ÂùóÁî®‰∫éÊîæÁΩÆconfigsÔºåÂÆö‰πâÊ®°ÂûãÁªìÊûÑ,
ËØ•ÈÖçÁΩÆÊñá‰ª∂Â∞ÜÊîæÂà∞`/home/lry/projects/mmdetection/configs/fenghuo/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_balloon.py`"""</span>

<span class="token comment" spellcheck="true"># The new config inherits a base config to highlight the necessary modification</span>
_base_ <span class="token operator">=</span> <span class="token string">'../mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py'</span>

<span class="token comment" spellcheck="true"># We also need to change the num_classes in head to match the dataset's annotation</span>
model <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    roi_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        bbox_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mask_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Modify dataset related settings</span>
dataset_type <span class="token operator">=</span> <span class="token string">'COCODataset'</span>
classes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'780B'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    train<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        img_prefix<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/780b_std/train/'</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>
        ann_file<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/780b_std/train/annotation_coco.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    val<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        img_prefix<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/780b_std/val/'</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>
        ann_file<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/780b_std/val/annotation_coco.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    test<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        img_prefix<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/780b_std/val/'</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>
        ann_file<span class="token operator">=</span><span class="token string">'/home/lry/projects/mmdetection/data/780b_std/val/annotation_coco.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># We can use the pre-trained Mask RCNN model to obtain higher performance</span>
load_from <span class="token operator">=</span> <span class="token string">'checkpoints/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco_bbox_mAP-0.408__segm_mAP-0.37_20200504_163245-42aa3d00.pth'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ËÆ≠ÁªÉÊ®°Âûã"><a href="#ËÆ≠ÁªÉÊ®°Âûã" class="headerlink" title="ËÆ≠ÁªÉÊ®°Âûã"></a>ËÆ≠ÁªÉÊ®°Âûã</h2><pre class="line-numbers language-python"><code class="language-python">python tools<span class="token operator">/</span>train<span class="token punctuation">.</span>py configs<span class="token operator">/</span>fenghuo<span class="token operator">/</span>mask_rcnn_r50_caffe_fpn_mstrain<span class="token operator">-</span>poly_1x_fenghuo<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="ÊµãËØïÊ®°Âûã"><a href="#ÊµãËØïÊ®°Âûã" class="headerlink" title="ÊµãËØïÊ®°Âûã"></a>ÊµãËØïÊ®°Âûã</h2><pre class="line-numbers language-python"><code class="language-python">CUDA_VISIBLE<span class="token operator">=</span><span class="token number">1</span> python tools<span class="token operator">/</span>test<span class="token punctuation">.</span>py configs<span class="token operator">/</span>fenghuo<span class="token operator">/</span>mask_rcnn_r50_caffe_fpn_mstrain<span class="token operator">-</span>poly_1x_fenghuo<span class="token punctuation">.</span>py work_dirs<span class="token operator">/</span>mask_rcnn_r50_caffe_fpn_mstrain<span class="token operator">-</span>poly_1x_fenghuo<span class="token operator">/</span>latest<span class="token punctuation">.</span>pth  <span class="token operator">-</span><span class="token operator">-</span>eval bbox segm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="2021-11-14Êó•Êó©Êõ¥Êñ∞"><a href="#2021-11-14Êó•Êó©Êõ¥Êñ∞" class="headerlink" title="2021.11.14Êó•Êó©Êõ¥Êñ∞"></a>2021.11.14Êó•Êó©Êõ¥Êñ∞</h1><ul>
<li>ËøúÁ®ã‰ªìÂ∫ìÔºö<a href="https://www.jianshu.com/p/e4bb2ac7e770" target="_blank" rel="noopener">https://www.jianshu.com/p/e4bb2ac7e770</a></li>
</ul>
<p>ÁõÆÂâçÈúÄË¶ÅÊñ∞Âª∫ËøúÁ®ãGitHub‰ªìÂ∫ìÊñπ‰æøÊàë‰∏éÂà´‰∫∫Âçè‰Ωú</p>
<p>ÁõÆÂâçÊï¥‰∏™Â§ßÊ°ÜÁöÑÊ£ÄÊµãËøòÊØîËæÉÊàêÂäüÔºåÊé•ÁùÄÂ∞±ÊòØÊ£ÄÊµãÊØè‰∏™Â∞èÊ°ÜÁöÑÂàÜÁ±ª‰ªªÂä°„ÄÇ</p>
<h1 id="2021-11-29Êó•ÊôöÊõ¥Êñ∞"><a href="#2021-11-29Êó•ÊôöÊõ¥Êñ∞" class="headerlink" title="2021.11.29Êó•ÊôöÊõ¥Êñ∞"></a>2021.11.29Êó•ÊôöÊõ¥Êñ∞</h1><p>ËøúÁ®ã‰ªìÂ∫ìÂàõÂª∫ÊàêÂäüÔºå‰ªìÂ∫ìÂú∞ÂùÄÔºö<a href="https://github.com/LRY89757/mmdet-for-fenghuo" target="_blank" rel="noopener">ÁÉΩÁÅ´Ê£ÄÊµã</a></p>
<p>ÁõÆÂâçÈúÄË¶ÅÂÅöÁöÑ‰∫ãÊÉÖÔºö</p>
<ul>
<li>ÂÜô‰∏Ä‰∏™ÂÖ≥‰∫éËøôÁ±ªLabelmeÊñáÊ°£ÈúÄË¶ÅÁöÑdataloaderÔºåÂÜô‰∏Ä‰∏™Â∞ΩÈáèÊØîËæÉÂÖ®Èù¢ÈÄÇÈÖçÊÄßÊØîËæÉÂº∫„ÄÅÂèØËøÅÁßªÊÄßÊØîËæÉÂ•ΩÁöÑdataloader</li>
<li>ÂØπ‰∫éËøêË°åÂá∫Êù•ÁöÑÁªìÊûúÁöÑÂõæÂÉèÂÅö‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂàáÂàÜÔºåÂπ≥ÂùáÂàÜ‰∏∫19‰ªΩÁÑ∂ÂêéÂ∞ÜÊØè‰∏Ä‰∏™ÂçïÁã¨ÁöÑÁõòÈÉΩcropÂá∫Êù•ÁÑ∂ÂêéÂ∞ÜÈùûÁõòÂå∫ÂüüÊ†áÈªëÊîæÂà∞resnet101Á≠âÂêÑÁ±ªÂàÜÁ±ªÁΩëÁªú‰∏≠ËøõË°åÁõ∏ÂÖ≥ÁöÑÂàÜÁ±ª‰ªªÂä°„ÄÇ</li>
<li>ÂàíÂàÜÊµãËØïÈõÜÂíåËÆ≠ÁªÉÈõÜÁöÑÊó∂ÂÄôÈÄâÊã©‰ΩøÁî®ÁîüÊàêval.txtËøòÊúâtrain.txtÊñá‰ª∂ÁöÑÊ†ºÂºèÔºåÊØè‰∏™.txtÊñá‰ª∂ÂÜÖÈò≤Ê≠¢Áõ∏ÂÖ≥Êï∞ÊçÆÁöÑË∑ØÂæÑ„ÄÇËÄå‰∏çÊòØÂ∞ÜÂÖ∂Â§çÂà∂Âà∞‰∏Ä‰∏™Êñ∞ÁöÑÊñá‰ª∂Â§π‰∏≠ËøõË°åÂàÜÁ±ªÔºå‰∏á‰∏ÄÁ°¨ÁõòÊ≤°ÊúâÈÇ£‰πàÂ§ßÁöÑÁ©∫Èó¥ÊÄé‰πàÂäûÔºå‰∏çË¶ÅÊª•Áî®Á°¨ÁõòËµÑÊ∫ê„ÄÇ</li>
</ul>
<h1 id="2021-11-30Êó•ÊôöÊõ¥Êñ∞"><a href="#2021-11-30Êó•ÊôöÊõ¥Êñ∞" class="headerlink" title="2021.11.30Êó•ÊôöÊõ¥Êñ∞"></a>2021.11.30Êó•ÊôöÊõ¥Êñ∞</h1><p>ÁõÆÂâçÂ∑≤ÁªèÁ°ÆÂÆöÊú¨Âë®Áé∞ÂÅöÁ¨¨‰∫åÈ°πÔºåÂ∞±ÊòØÂÅö‰∏Ä‰∏ãÁõÆÂâçÁõòÁ¨¶ÁöÑÂàÜÁ±ªÊìç‰Ωú„ÄÇ</p>
<p>ÁõÆÂâçÁ¨¨‰∏ÄÊ≠•ÈÅáÂà∞ÁöÑÂõ∞ÈöæÂ∞±ÊòØÊöÇÊó∂‰∏çÁü•ÈÅìÊàë‰ª¨<code>inference_detector()</code>Ëøô‰∏™ÂáΩÊï∞ÂæóÂà∞ÁöÑÁªìÊûúÁöÑÂ§ßËá¥ÂΩ¢Âºè„ÄÇÂõ†‰∏∫‰πãÂâçÂÅöÂàÜÂâ≤ÁöÑÊó∂ÂÄôÁõ¥Êé•Â∞ÜÁªìÊûúÊîæÂà∞ÂáΩÊï∞ÁöÑÂèÇÊï∞‰∏≠<code>model.show_result(img, result, out_file=f&#39;/home/lry/projects/mmdetection/lry/demo{i}.jpg&#39;)</code>Êù•ÊòæÁ§∫ÁªìÊûú‰∫ÜÔºåÂÜçÂä†‰∏äÊàëÊú¨Êù•ÂØπËøô‰∏™‰πü‰∏çÂ§™ÁÜüÊÇâÔºåÊâÄ‰ª•ÁõÆÂâçÊâìÁÆóÊ∑±ÂÖ•ÁêÜËß£‰∏ãÂÖ≥‰∫éÂáΩÊï∞<code>inference_detector()</code>ÔºåÈ°∫‰æøÂ∞ÜËøô‰∏ÄÁ≥ªÂàóÊúâÂÖ≥ÁöÑÈÉΩ‰∫ÜËß£‰∏Ä‰∏ãÔºö<code>init_detector,inference_detector, show_result_pyplot</code>,Ëøô‰∫õÈÉΩÊòØÊ∫ê‰∫éÂ∫ì<code>mmdet.apis</code>,ÊâÄ‰ª•Êàë‰ª¨Êù•Êâæ‰∏Ä‰∏ã<a href="https://mmdetection.readthedocs.io/en/latest/api.html" target="_blank" rel="noopener">ÂÆòÊñπÊñáÊ°£</a>ÂÖ≥‰∫émmdet.apisÁöÑÊúâÂÖ≥Ëß£ÈáäÔºö<br>ÂÆûÈôÖ‰∏äÊúâÂÖ≥<code>inference_detector</code>ÁöÑ<a href="https://mmdetection.readthedocs.io/en/latest/api.html#mmdet.apis.inference_detector" target="_blank" rel="noopener">ÂÜÖÂÆπ</a>ÂçÅÂàÜÊúâÈôêÔºö</p>
<blockquote>
<p>mmdet.apis.inference_detector(<em>model</em>, <em>imgs</em>)<a href="https://mmdetection.readthedocs.io/en/latest/_modules/mmdet/apis/inference.html#inference_detector" target="_blank" rel="noopener">[SOURCE]</a></p>
<p>Inference image(s) with the detector.</p>
<ul>
<li><p>Parameters</p>
<p><strong>model</strong> (<em>nn.Module</em>) ‚Äì The loaded detector.<strong>imgs</strong> (<em>str/ndarray</em> <em>or</em> <em>list<strong>[</strong>str/ndarray**] or</em> <em>tuple<strong>[</strong>str/ndarray**]</em>) ‚Äì Either image files or loaded images.</p>
</li>
<li><p>Returns</p>
<p>If imgs is a list or tuple, the same length list type results will be returned, otherwise return the detection results directly.</p>
</li>
</ul>
</blockquote>
<p>ÂΩìÁÑ∂ÊÑüÂÖ¥Ë∂£ÂèØ‰ª•ÂéªÈÄâÊã©Áúã‰∏Ä‰∏ãÊúâÂÖ≥Ê∫êÁ†Å.ËøôÈáåÊàëÈÄâÊã©Áî®‰ª£Á†ÅÊù•Êé¢Á¥¢‰∏ãÊúâÂÖ≥ÁöÑÁªìÊûú:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> mmdet<span class="token punctuation">.</span>apis <span class="token keyword">import</span> init_detector<span class="token punctuation">,</span>inference_detector<span class="token punctuation">,</span> show_result_pyplot
<span class="token keyword">import</span> mmcv
<span class="token keyword">import</span> os
<span class="token keyword">import</span> glob
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor

config_file <span class="token operator">=</span> <span class="token string">"/home/lry/projects/mmdetection/configs/fenghuo/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo.py"</span>
checkpoint_file <span class="token operator">=</span> <span class="token string">"/home/lry/projects/mmdetection/work_dirs/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo/latest.pth"</span>
model <span class="token operator">=</span> init_detector<span class="token punctuation">(</span>config_file<span class="token punctuation">,</span> checkpoint_file<span class="token punctuation">,</span>device<span class="token operator">=</span><span class="token string">"cuda:3"</span><span class="token punctuation">)</span>

img <span class="token operator">=</span> <span class="token string">'/home/lry/projects/mmdetection/data/780b_std/IMG_20211021_153945.jpg'</span>
result <span class="token operator">=</span> inference_detector<span class="token punctuation">(</span>model<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'\n\n'</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'\n\n'</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
img <span class="token operator">=</span> Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊúâÂÖ≥ËøôÈÉ®ÂàÜ‰∏ªË¶ÅÂ∞±ÁúãresultÁöÑËæìÂá∫Âà∞Â∫ïÊòØ‰ªÄ‰πà‰∏úË•ø,Â¶ÇÊûúÊàë‰ª¨ÊÉ≥Ë¶Å‰øùÂ≠òÁªìÊûúÂà∞ÊüêÂú∞ÊàñÊòØÂ±ïÁ§∫ÁªìÊûúÂèØ‰ª•Áî®<code>model.show_result(img, result, out_file=f&#39;/home/lry/projects/mmdetection/lry/demo{i}.jpg&#39;)</code>Êù•ÊòæÁ§∫.</p>
<p>ÁÆÄÂçïÊù•Áúã‰∏ã‰ª£Á†ÅËøêË°åÁªìÊûú:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">[</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3.6979218e+02</span><span class="token punctuation">,</span> <span class="token number">2.3255410e+03</span><span class="token punctuation">,</span> <span class="token number">2.7979324e+03</span><span class="token punctuation">,</span> <span class="token number">4.2280156e+03</span><span class="token punctuation">,</span>
        <span class="token number">9.9831665e-01</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float32<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 

 <span class="token punctuation">[</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3.6979218e+02</span><span class="token punctuation">,</span> <span class="token number">2.3255410e+03</span><span class="token punctuation">,</span> <span class="token number">2.7979324e+03</span><span class="token punctuation">,</span> <span class="token number">4.2280156e+03</span><span class="token punctuation">,</span>
        <span class="token number">9.9831665e-01</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float32<span class="token punctuation">)</span><span class="token punctuation">]</span> 

 <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3.6979218e+02</span> <span class="token number">2.3255410e+03</span> <span class="token number">2.7979324e+03</span> <span class="token number">4.2280156e+03</span> <span class="token number">9.9831665e-01</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token number">4608</span><span class="token punctuation">,</span> <span class="token number">3456</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4608</span><span class="token punctuation">,</span> <span class="token number">3456</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂèØ‰ª•ÁúãÂà∞,resultÊòØ‰∏Ä‰∏™ÂÖÉÁªÑ,ÂÖÉÁªÑÁöÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÊòØ‰∏Ä‰∏™np.array,Âê´Êúâ5‰∏™ÂÖÉÁ¥†,5‰∏™ÂÖÉÁ¥†‰∏≠Á¨¨‰∏Ä‰∏™‰ª£Ë°®ÁöÑÊòØÊ£ÄÊµãÊ°ÜÁöÑÂáÜÁ°ÆÂ∫¶,ÁÑ∂ÂêéÂõõ‰∏™ÂèÇÊï∞‰ª£Ë°®ÁöÑÊòØÂõæÁâáÁöÑÊ£ÄÊµãÊ°ÜÁöÑÂ∑¶‰∏äÂè≥‰∏ãÁõ∏ÂÖ≥ÂèÇÊï∞,ÁÑ∂ÂêéÁ¨¨‰∫å‰∏™ÂÖÉÁ¥†Â∞±ÊòØÂõæÁâáÂàÜÂâ≤Êï∞ÊçÆÈõÜÁöÑÂàÜÂâ≤ÁªìÊûú‰∫Ü.Ëøô‰∏™ÁªìÊûúÊòØÁî±TrueÂíåFalseÁªÑÊàêÁöÑÂíåÂõæÂÉèÊú¨Ë∫´TensorÂ§ßÂ∞èÁõ∏ÂêåÁöÑ‰∏Ä‰∏™Áü©Èòµ.(True‰ª£Ë°®ËØ•ÂÉèÁ¥†ÊòØÂê´ÊúâÁâ©‰ΩìÁöÑ)</p>
<h2 id="Code-Trace-of-mmdet-apis-inference-detector"><a href="#Code-Trace-of-mmdet-apis-inference-detector" class="headerlink" title="Code Trace of mmdet.apis.inference_detector()"></a>Code Trace of <code>mmdet.apis.inference_detector()</code></h2><p>ÁöÑÁ°ÆÂàöÊâçÊàë‰ª¨Â∞ÜËøô‰∏™Êé•Âè£ÂΩì‰ΩúÈªëÁõíÊù•Êé¢Á¥¢Âà∞‰∫Ü‰ªñÁöÑ‰∏Ä‰∫õÂÖ∑‰ΩìÂäüËÉΩ„ÄÇËøôÊ†∑ÂØπ‰∫éÂÅöÈ°πÁõÆÊù•ËØ¥ÈùûÂ∏∏Ë∂≥Â§ü‰∫ÜÔºå‰ΩÜÊòØÊàë‰ª¨ËøôÈáåÊ∑±ÂÖ•‰∏Ä‰∏ãÊù•Êé¢Á¥¢‰∏Ä‰∏ã‰ªñÁöÑÊ∫êÁ†ÅÊòØÊÄé‰πàÊ†∑ÁöÑÔºà<del>ÊÑüË∞¢ËíãÂì•Â∏¶ÊàëÈ£û</del>Ôºâ„ÄÇ</p>
<p>È¶ñÂÖàÊù•ÁúãÊàë‰ª¨ÁöÑinference_detector()Ê∫êÁ†Å<code>mmdet/apis/inference.py</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">inference_detector</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> imgs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Inference image(s) with the detector.

    Args:
        model (nn.Module): The loaded detector.
        imgs (str/ndarray or list[str/ndarray] or tuple[str/ndarray]):
           Either image files or loaded images.

    Returns:
        If imgs is a list or tuple, the same length list type results
        will be returned, otherwise return the detection results directly.
    """</span>

    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>imgs<span class="token punctuation">,</span> <span class="token punctuation">(</span>list<span class="token punctuation">,</span> tuple<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        is_batch <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        imgs <span class="token operator">=</span> <span class="token punctuation">[</span>imgs<span class="token punctuation">]</span>
        is_batch <span class="token operator">=</span> <span class="token boolean">False</span>

    cfg <span class="token operator">=</span> model<span class="token punctuation">.</span>cfg
    device <span class="token operator">=</span> next<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>device  <span class="token comment" spellcheck="true"># model device</span>

    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>imgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cfg <span class="token operator">=</span> cfg<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># set loading pipeline type</span>
        cfg<span class="token punctuation">.</span>data<span class="token punctuation">.</span>test<span class="token punctuation">.</span>pipeline<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'LoadImageFromWebcam'</span>

    cfg<span class="token punctuation">.</span>data<span class="token punctuation">.</span>test<span class="token punctuation">.</span>pipeline <span class="token operator">=</span> replace_ImageToTensor<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>data<span class="token punctuation">.</span>test<span class="token punctuation">.</span>pipeline<span class="token punctuation">)</span>
    test_pipeline <span class="token operator">=</span> Compose<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>data<span class="token punctuation">.</span>test<span class="token punctuation">.</span>pipeline<span class="token punctuation">)</span>

    datas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> img <span class="token keyword">in</span> imgs<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># prepare data</span>
        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>img<span class="token punctuation">,</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># directly add img</span>
            data <span class="token operator">=</span> dict<span class="token punctuation">(</span>img<span class="token operator">=</span>img<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># add information into dict</span>
            data <span class="token operator">=</span> dict<span class="token punctuation">(</span>img_info<span class="token operator">=</span>dict<span class="token punctuation">(</span>filename<span class="token operator">=</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> img_prefix<span class="token operator">=</span>None<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># build the data pipeline</span>
        data <span class="token operator">=</span> test_pipeline<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        datas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    data <span class="token operator">=</span> collate<span class="token punctuation">(</span>datas<span class="token punctuation">,</span> samples_per_gpu<span class="token operator">=</span>len<span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># just get the actual data from DataContainer</span>
    data<span class="token punctuation">[</span><span class="token string">'img_metas'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>img_metas<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> img_metas <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'img_metas'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    data<span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>img<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> img <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> next<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>is_cuda<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># scatter to specified GPU</span>
        data <span class="token operator">=</span> scatter<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">[</span>device<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> m <span class="token keyword">in</span> model<span class="token punctuation">.</span>modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">assert</span> <span class="token operator">not</span> isinstance<span class="token punctuation">(</span>
                m<span class="token punctuation">,</span> RoIPool
            <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'CPU inference with RoIPool is not supported currently.'</span>

    <span class="token comment" spellcheck="true"># forward the model</span>
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        results <span class="token operator">=</span> model<span class="token punctuation">(</span>return_loss<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> rescale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>data<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token operator">not</span> is_batch<span class="token punctuation">:</span>
        <span class="token keyword">return</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> results<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂÆûÈôÖ‰∏äËøô‰πàÈïøÁöÑÊ∫êÁ†ÅÔºåÁúüÊ≠£ÂÖ≥ÈîÆÁöÑÂ∞±ÂÄíÊï∞Á¨¨ÂÖ≠Ë°åÁöÑ‰ª£Á†Å<code>results = model(return_loss=False, rescale=True, **data)</code>ËøôË°å‰ª£Á†ÅË∞ÉÁî®‰∫ÜmodelÊù•ËøõË°åÊé®ÁêÜÁÑ∂ÂêéËøîÂõû‰∫ÜÁªìÊûúresults„ÄÇÊàë‰ª¨Ë¶ÅÁúãmodelÁöÑËÄåmodelÊòØÊàë‰ª¨‰º†ËøõÊù•ÁöÑÂèÇÊï∞ÔºåÊòØÊàë‰ª¨‰ΩøÁî®<code>init_detector</code>Ëøô‰∏™Êé•Âè£Êù•Ë∞ÉÁî®ÁöÑÔºåËøô‰∏™Êé•Âè£‰ΩøÁî®‰∫ÜÊàë‰ª¨ÁöÑconfigÊñá‰ª∂‰ª•ÂèäÁõ∏ÂÖ≥ÁöÑcheckpointÊñá‰ª∂„ÄÇËøôÈáåconfigÊñá‰ª∂Â∑≤ÁªèÈùûÂ∏∏ÁÜüÊÇâ‰∫ÜÔºåÂ∞±ÊòØÂà©Áî®Ëøô‰∏™Êê≠Âª∫ÁöÑÊ®°Âûã„ÄÇÊàë‰ª¨ÈúÄË¶ÅÁúãÁöÑÊòØÂÖ≥‰∫éconfigÊñá‰ª∂ÈáåÈù¢ÊâÄÁî®ÁöÑÊ®°Âûã„ÄÇËÄåË¶ÅÊúÄÂêéÁöÑËæìÂá∫ÊòØÁî±<code>roi_heads</code>Ôºå‰πüÂ∞±ÊòØmaskrcnnÊúÄÂêé‰∏Ä‰∏™Ê®°ÂùóÊù•ËæìÂá∫ÁöÑ„ÄÇÊàë‰ª¨ÂÖàËøΩË∏™‰∏Ä‰∏ãÊúâÂÖ≥ÁöÑconfigÊñá‰ª∂Ôºö<br>È¶ñÂÖàÊòØÊàë‰ª¨Ëá™Â∑±ÂÆö‰πâÁöÑ‰∏äÂ±ÇÁöÑconfigÊñá‰ª∂<code>configs/fenghuo/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo.py</code>, ‰ªéËøôÈáåÊâæÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨ÁªßÊâøÁöÑÊòØ<code>_base_ = &#39;../mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py&#39;</code>ÈÇ£‰πàÊàë‰ª¨ÁªßÁª≠ÊâæÂà∞Ëøô‰∏™Ê®°ÂùóÂ∞±<code>configs/mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py</code>,ÂèØ‰ª•ÁúãÂà∞‰ªñÁªßÊâøÁöÑÊòØ<code>_base_ = &#39;./mask_rcnn_r50_fpn_1x_coco.py&#39;</code>,Êàë‰ª¨ÁªßÁª≠ÊâæËøô‰∏™Êñá‰ª∂<code>configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py</code>,Ëøô‰∏™Êñá‰ª∂ÊúâÁÇπÂÉèÊòØ‰∏Ä‰∏™packageÁöÑ<code>__init__.py</code>ÔºåÂ∞±ÊòØ‰ª£Á†ÅÂè™ÊúâÊâÄÊúâÈúÄË¶ÅÁªßÊâøÁöÑÂü∫Êú¨Á±ªÂûãÔºö</p>
<pre class="line-numbers language-python"><code class="language-python">_base_ <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'../_base_/models/mask_rcnn_r50_fpn.py'</span><span class="token punctuation">,</span>
    <span class="token string">'../_base_/datasets/coco_instance.py'</span><span class="token punctuation">,</span>
    <span class="token string">'../_base_/schedules/schedule_1x.py'</span><span class="token punctuation">,</span> <span class="token string">'../_base_/default_runtime.py'</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ËøôÈáåÂ∞±ÊòØ‰∏Ä‰∫õÊ®°ÂûãÂÖ∑‰ΩìÈÖçÁΩÆÁöÑÁªßÊâøÂü∫Á±ªÊñá‰ª∂ÔºåÊàë‰ª¨ÊÉ≥Ë¶ÅÁúãÊ®°ÂûãÁöÑ<code>roi_heads</code>ÈÉ®ÂàÜÔºåÈÇ£‰πàÊàë‰ª¨Â∞±ÂéªÊâæ<code>&#39;../_base_/models/mask_rcnn_r50_fpn.py&#39;</code>Êñá‰ª∂„ÄÇÊàë‰ª¨ÂèØ‰ª•Âú®<code>configs/_base_/models/mask_rcnn_r50_fpn.py</code>ÈáåÊâæÂà∞<code>roi_heads</code>ÁöÑÂÆö‰πâ:</p>
<pre class="line-numbers language-python"><code class="language-python">    roi_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        type<span class="token operator">=</span><span class="token string">'StandardRoIHead'</span><span class="token punctuation">,</span>
        bbox_roi_extractor<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>
            roi_layer<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span> output_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        bbox_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'Shared2FCBBoxHead'</span><span class="token punctuation">,</span>
            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            fc_out_channels<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>
            roi_feat_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span>
            num_classes<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>
            bbox_coder<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'DeltaXYWHBBoxCoder'</span><span class="token punctuation">,</span>
                target_means<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                target_stds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            reg_class_agnostic<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
            loss_cls<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            loss_bbox<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'L1Loss'</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mask_roi_extractor<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>
            roi_layer<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span> output_size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mask_head<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            type<span class="token operator">=</span><span class="token string">'FCNMaskHead'</span><span class="token punctuation">,</span>
            num_convs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            conv_out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
            num_classes<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>
            loss_mask<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ËøôÈáåÈù¢ÂèØ‰ª•ÁúãÂà∞Êï¥‰∏™<code>roi_head</code>ÈÉΩÊòØÂ±û‰∫é<code>type=&#39;StandardRoIHead&#39;</code>, Áî±‰∫éMMDetectionÁöÑÊ≥®ÂÜåÂô®RegistryÊú∫Âà∂ÔºåÊàë‰ª¨Áü•ÈÅìÊàë‰ª¨ÈúÄË¶ÅÂéªÂà∞<code>mmdet</code>Êñá‰ª∂Â§π‰∏≠ÂéªÊâæËøô‰∫õ‰∏úË•øÔºåÂú®<code>mmdet/models/roi_heads</code>‰∏≠Êàë‰ª¨ÂèØ‰ª•ÊâæÂà∞<code>mmdet/models/roi_heads/standard_roi_head.py</code>Ëøô‰∏™Êñá‰ª∂„ÄÇ<br>ÁÑ∂ÂêéÊàë‰ª¨ÈúÄË¶Å‰ªéÁ±ª‰∏≠ÂØªÊâæÂÖ≥‰∫éforwardÁöÑÊúâÂÖ≥ÂáΩÊï∞ÔºåÂàöÂºÄÂßãÊâæÁöÑÊòØ<code>forward_dummy()</code>Ëøô‰∏™ÂáΩÊï∞Ôºå‰ΩÜÊòØ‰ªéËøô‰∏™ÂáΩÊï∞‰∏≠Áúã‰∏çÂà∞ÂÖ≥‰∫écls_scoreÂíåbbox_pred‰ª•Âèämask_predÁöÑÂêàÂπ∂ÊúâÂÖ≥Ê≠•È™§ÔºåÊàñËÄÖËØ¥‰∏çÂ§™ËÉΩÂØπÂ∫î‰∏äÔºåÂêéÊù•Êâì‰∫Ü‰∏Ä‰∫õÊñ≠ÁÇπÂèëÁé∞‰ºº‰πéÁ®ãÂ∫èÊ†πÊú¨‰∏ç‰ºöÁªèËøáËøô‰∏™ÂáΩÊï∞„ÄÇÊâÄ‰ª•Â∫îËØ•‰∏çÊòØÁªèËøáËøô‰∏™forwardÂáΩÊï∞ÔºåËÄåÂè¶Â§ñÁöÑforwardÂáΩÊï∞ÔºåÈ¶ñÂÖàÂèØ‰ª•ÊéíÈô§<code>forward_train</code>Ëøô‰∏™ÂáΩÊï∞ÔºåÊàñËÄÖÊòØÊéíÈô§ÊâÄÊúâÂíåtrainÊúâÂÖ≥ÁöÑÂáΩÊï∞ÔºåÂõ†‰∏∫Êàë‰ª¨ÊØïÁ´üËøô‰∏™ÊòØÂÅöÁöÑÊé®Êñ≠ÔºåÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅÁöÑ‰∏çÊòØÂéªtrainÔºåËá≥Â∞ë‰πüÂú®testÈáåÈù¢„ÄÇ</p>
<p>ÂêéÊù•ÁªèËøáÊâìÊñ≠ÁÇπÂèëÁé∞Á®ãÂ∫èËøêË°åÂú®<code>simple_test()</code>Ëøô‰∏™ÂáΩÊï∞ÈáåÈù¢Ôºö</p>
<pre class="line-numbers language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">simple_test</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>
                    x<span class="token punctuation">,</span>
                    proposal_list<span class="token punctuation">,</span>
                    img_metas<span class="token punctuation">,</span>
                    proposals<span class="token operator">=</span>None<span class="token punctuation">,</span>
                    rescale<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Test without augmentation.

        Args:
            x (tuple[Tensor]): Features from upstream network. Each
                has shape (batch_size, c, h, w).
            proposal_list (list(Tensor)): Proposals from rpn head.
                Each has shape (num_proposals, 5), last dimension
                5 represent (x1, y1, x2, y2, score).
            img_metas (list[dict]): Meta information of images.
            rescale (bool): Whether to rescale the results to
                the original image. Default: True.

        Returns:
            list[list[np.ndarray]] or list[tuple]: When no mask branch,
            it is bbox results of each image and classes with type
            `list[list[np.ndarray]]`. The outer list
            corresponds to each image. The inner list
            corresponds to each class. When the model has mask branch,
            it contains bbox results and mask results.
            The outer list corresponds to each image, and first element
            of tuple is bbox results, second element is mask results.
        """</span>
        <span class="token keyword">assert</span> self<span class="token punctuation">.</span>with_bbox<span class="token punctuation">,</span> <span class="token string">'Bbox head must be implemented.'</span>

        det_bboxes<span class="token punctuation">,</span> det_labels <span class="token operator">=</span> self<span class="token punctuation">.</span>simple_test_bboxes<span class="token punctuation">(</span>
            x<span class="token punctuation">,</span> img_metas<span class="token punctuation">,</span> proposal_list<span class="token punctuation">,</span> self<span class="token punctuation">.</span>test_cfg<span class="token punctuation">,</span> rescale<span class="token operator">=</span>rescale<span class="token punctuation">)</span>

        bbox_results <span class="token operator">=</span> <span class="token punctuation">[</span>
            bbox2result<span class="token punctuation">(</span>det_bboxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> det_labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        self<span class="token punctuation">.</span>bbox_head<span class="token punctuation">.</span>num_classes<span class="token punctuation">)</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>det_bboxes<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>with_mask<span class="token punctuation">:</span>
            <span class="token keyword">return</span> bbox_results
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            segm_results <span class="token operator">=</span> self<span class="token punctuation">.</span>simple_test_mask<span class="token punctuation">(</span>
                x<span class="token punctuation">,</span> img_metas<span class="token punctuation">,</span> det_bboxes<span class="token punctuation">,</span> det_labels<span class="token punctuation">,</span> rescale<span class="token operator">=</span>rescale<span class="token punctuation">)</span>
            <span class="token keyword">return</span> list<span class="token punctuation">(</span>zip<span class="token punctuation">(</span>bbox_results<span class="token punctuation">,</span> segm_results<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êé•ÁùÄË∞ÉËØïÂèëÁé∞ËøôÈáåË∞ÉÁî®‰∫ÜÂáΩÊï∞bbox2result()Êù•ÂÆûÁé∞‰∫ÜÂÖ≥‰∫éËΩ¨ÂåñÁöÑ‰∏Ä‰∫õÈóÆÈ¢ò„ÄÇ</p>
<p>ÂÆûÈôÖ‰∏äÂà∞Ê≠§Â∞±ÁªìÊùü‰∫ÜÔºåÂΩìÁÑ∂<code>forward_dummy()</code>Ëøô‰∏™ÂáΩÊï∞ÊòØÈùûÂ∏∏ÊúâÁ†îÁ©∂ÊÑè‰πâÁöÑÔºåÂú®<code>mmdet/models/detectors/two_stage.py</code>ÈáåÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™ÊòØ‰∏∫‰∫ÜÔºåÁâπÂà´ÊòØËøôÈáåË∞ÉÁî®‰∫Ü<code>_bbox_forward()</code>Ëøô‰∏™ÂáΩÊï∞,ÂÄºÂæóÊ≥®ÊÑè‰∏Ä‰∏ã„ÄÇ</p>
<p>Âè¶Â§ñÊàë‰ª¨‰ª•‰∏ä‰ªÖ‰ªÖÊòØËÆ≤‰∫Ü‰∏Ä‰∏™mask_rcnnÁöÑ‰∏Ä‰∏™ÂæàÂ∞èÁöÑ<code>roi_head</code>ÈÉ®ÂàÜÔºåÂ¶ÇÊûúË¶ÅÊÄª‰ΩìÁúãÂÖ®‰ΩìÁöÑ‰∏Ä‰∏™Ê¶ÇÂÜµÁöÑËØùÔºåÂèØ‰ª•ÈÄâÊã©ÂéªÁúã‰∏Ä‰∏ã<code>mmdet/models/detectors/two_stage.py</code>ËôΩÁÑ∂‰πü‰∏çÁÆóÊòØÊÄª‰ΩìÔºå‰ΩÜÊòØ‰πüÈ´ò‰∫Ü‰∏ÄÁ∫ßÔºåÂèØ‰ª•Áúã‰∏Ä‰∏ãÂÖ∑‰ΩìÁöÑËøô‰∏™<code>TwoStageDetector</code>ÊòØÊÄé‰πàË∞ÉÂ∫¶ÁöÑÔºåÊòØÂ¶Ç‰ΩïËøêË°åËµ∑Êù•ÁöÑ„ÄÇ</p>
<h2 id="dataloader-in-mmdetection"><a href="#dataloader-in-mmdetection" class="headerlink" title="dataloader in mmdetection"></a><strong>dataloader in mmdetection</strong></h2><p>ÂÖ∂Ê¨°ÊòØÂÖ≥‰∫éËøôÂë®Ë¶ÅÂÅöÁöÑÁ¨¨‰∏Ä‰∏™‰ªªÂä°ÔºåËøô‰∏™‰ªªÂä°ÂÆûÈôÖ‰∏äÂ∞±ÊòØÊù•ÂÅö‰∏Ä‰∏™LabelmeÊï∞ÊçÆÁöÑdataloader,ÂΩìÁÑ∂ËØ¥Ëµ∑Êù•ÂÆπÊòìÔºåËøô‰∏™Ë¶ÅÊäädataloaderËûçÂà∞MMDetectionÈáåÈù¢ËøòÊòØÈúÄË¶ÅÊ∑±ÂÖ•ÁêÜËß£‰ªñÁöÑRigistryÊú∫Âà∂ÁöÑÔºåËÄå‰∏îÂÖâÂÜô‰ª£Á†ÅËøô‰∏ÄÊ≠•Â¶ÇÊûúÂÆåÂÖ®‰∏çÁúã‰ªñÁöÑÂÖ≥‰∫éCOCODatasetÁöÑ‰ª£Á†ÅÈù†Ëá™Â∑±ÂÜôÊÅêÊÄïÊòØÈùûÂ∏∏ÈöæÂäûÁöÑ„ÄÇÊâÄ‰ª•Êàë‰ª¨ËøôÈáå‰∏ÄÊ≠•‰∏ÄÊ≠•ÁöÑÊù•Êé¢Á¥¢„ÄÇ</p>
<p>È¶ñÂÖàÊàë‰ª¨Êù•ÊâæÂà∞COCOÁöÑdataloaderÂà∞Â∫ïÂú®Âì™Èáå„ÄÇ</p>
<p>ËøòÊòØ‰ªéconfigÊñá‰ª∂ÂºÄÂßãÊâæÔºåÁî±‰∫é‰∏äÊñáÂ∑≤ÁªèÊâæËøá‰∫ÜÔºåËøôÈáåÁõ¥Êé•ÂºïÁî®‰∏äÊñáÁöÑÂØªÊâæËøáÁ®ãÔºö</p>
<p>‚Äú‚Äù‚Äù‚Äù</p>
<p>È¶ñÂÖàÊòØÊàë‰ª¨Ëá™Â∑±ÂÆö‰πâÁöÑ‰∏äÂ±ÇÁöÑconfigÊñá‰ª∂<code>configs/fenghuo/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo.py</code>, ‰ªéËøôÈáåÊâæÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨ÁªßÊâøÁöÑÊòØ<code>_base_ = &#39;../mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py&#39;</code>ÈÇ£‰πàÊàë‰ª¨ÁªßÁª≠ÊâæÂà∞Ëøô‰∏™Ê®°ÂùóÂ∞±<code>configs/mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py</code>,ÂèØ‰ª•ÁúãÂà∞‰ªñÁªßÊâøÁöÑÊòØ<code>_base_ = &#39;./mask_rcnn_r50_fpn_1x_coco.py&#39;</code>,Êàë‰ª¨ÁªßÁª≠ÊâæËøô‰∏™Êñá‰ª∂<code>configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py</code>,Ëøô‰∏™Êñá‰ª∂ÊúâÁÇπÂÉèÊòØ‰∏Ä‰∏™packageÁöÑ<code>__init__.py</code>ÔºåÂ∞±ÊòØ‰ª£Á†ÅÂè™ÊúâÊâÄÊúâÈúÄË¶ÅÁªßÊâøÁöÑÂü∫Êú¨Á±ªÂûãÔºö</p>
<p>```python</p>
<p><em>base</em> = [</p>
<p>  ‚Äò../<em>base</em>/models/mask_rcnn_r50_fpn.py‚Äô,</p>
<p>  ‚Äò../<em>base</em>/datasets/coco_instance.py‚Äô,</p>
<p>  ‚Äò../<em>base</em>/schedules/schedule_1x.py‚Äô, ‚Äò../<em>base</em>/default_runtime.py‚Äô</p>
<p>]</p>
<p>```</p>
<p>‚Äú‚Äù‚Äù</p>
<p>ÁÑ∂ÂêéÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Âú®<code>&#39;../_base_/datasets/coco_instance.py&#39;</code>ÈáåÈù¢ÔºåÂâçÂá†Ë°å‰ª£Á†ÅÂ∞±Êúâ<code>dataset_type = &#39;CocoDataset&#39;</code>Âíå‰∏äÊñáÁõ∏ÂêåÁöÑRegistryÊú∫Âà∂ÔºåÊàë‰ª¨Âà∞<code>mmdet</code>Êñá‰ª∂Â§π‰∏≠ÂéªÂØªÊâæÔºåÂèØ‰ª•ÂèëÁé∞Âú®<code>mmdet/datasets/coco.py</code>ÈáåÈù¢Êúâ<code>CocoDataset</code>Ëøô‰∏™Á±ª„ÄÇËøô‰∏™Â∞±ÊòØÂÖ≥‰∫éCocoDatasetÁöÑdataloader.Áªà‰∫éÊâæÂà∞‰∫ÜÔºÅ</p>
<p>‰ΩÜÊòØÊúâ574Ë°å‰ª£Á†Å‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶ËöåÂü†‰Ωè‰∫Üüò•„ÄÇ</p>
<h1 id="2021-12-1Êó•‰∏äÂçàÊõ¥Êñ∞"><a href="#2021-12-1Êó•‰∏äÂçàÊõ¥Êñ∞" class="headerlink" title="2021.12.1Êó•‰∏äÂçàÊõ¥Êñ∞"></a>2021.12.1Êó•‰∏äÂçàÊõ¥Êñ∞</h1><h2 id="dataloader-in-mmdet"><a href="#dataloader-in-mmdet" class="headerlink" title="dataloader in mmdet"></a>dataloader in mmdet</h2><p>ÂÜçÁ®çÂæÆËØ¥‰∏Ä‰∏ãÂÖ≥‰∫éRigistryËøòÊúâÁªßÊâøÁ±ªÈúÄË¶ÅÂÅöÁöÑ‰∏Ä‰∫õ‰∏úË•ø„ÄÇ</p>
<p>Êàë‰ª¨ÁªßÁª≠‰ªé‰∏äÊñá‰∏≠ÂæóÂà∞ÁöÑÂú®<code>mmdet/datasets/coco.py</code>‰∏≠ÁúãÂà∞ÁöÑCocoDatasetÁ±ªÁöÑÂÜÖÂÆπÔºà‰ªÖ‰ªÖÈÄâÊã©‰∫Ü‰∏ÄÈÉ®ÂàÜÔºåÂÆåÊï¥ÁâàÁúã<a href="https://github.com/open-mmlab/mmdetection/blob/master/mmdet/datasets/coco.py" target="_blank" rel="noopener">ËøôÈáå</a>ÔºâÔºö</p>
<p>```python</p>
<p># Copyright (c) OpenMMLab. All rights reserved.</p>
<p>@DATASETS.register_module()</p>
<p>class CocoDataset(CustomDataset):</p>
<p>  CLASSES = (‚Äòperson‚Äô, ‚Äòbicycle‚Äô, ‚Äòcar‚Äô, ‚Äòmotorcycle‚Äô, ‚Äòairplane‚Äô, ‚Äòbus‚Äô,</p>
<p>‚Äã        ‚Äòtrain‚Äô, ‚Äòtruck‚Äô, ‚Äòboat‚Äô, ‚Äòtraffic light‚Äô, ‚Äòfire hydrant‚Äô,</p>
<p>‚Äã        ‚Äòstop sign‚Äô, ‚Äòparking meter‚Äô, ‚Äòbench‚Äô, ‚Äòbird‚Äô, ‚Äòcat‚Äô, ‚Äòdog‚Äô,</p>
<p>‚Äã        ‚Äòhorse‚Äô, ‚Äòsheep‚Äô, ‚Äòcow‚Äô, ‚Äòelephant‚Äô, ‚Äòbear‚Äô, ‚Äòzebra‚Äô, ‚Äògiraffe‚Äô,</p>
<p>‚Äã        ‚Äòbackpack‚Äô, ‚Äòumbrella‚Äô, ‚Äòhandbag‚Äô, ‚Äòtie‚Äô, ‚Äòsuitcase‚Äô, ‚Äòfrisbee‚Äô,</p>
<p>‚Äã        ‚Äòskis‚Äô, ‚Äòsnowboard‚Äô, ‚Äòsports ball‚Äô, ‚Äòkite‚Äô, ‚Äòbaseball bat‚Äô,</p>
<p>‚Äã        ‚Äòbaseball glove‚Äô, ‚Äòskateboard‚Äô, ‚Äòsurfboard‚Äô, ‚Äòtennis racket‚Äô,</p>
<p>‚Äã        ‚Äòbottle‚Äô, ‚Äòwine glass‚Äô, ‚Äòcup‚Äô, ‚Äòfork‚Äô, ‚Äòknife‚Äô, ‚Äòspoon‚Äô, ‚Äòbowl‚Äô,</p>
<p>‚Äã        ‚Äòbanana‚Äô, ‚Äòapple‚Äô, ‚Äòsandwich‚Äô, ‚Äòorange‚Äô, ‚Äòbroccoli‚Äô, ‚Äòcarrot‚Äô,</p>
<p>‚Äã        ‚Äòhot dog‚Äô, ‚Äòpizza‚Äô, ‚Äòdonut‚Äô, ‚Äòcake‚Äô, ‚Äòchair‚Äô, ‚Äòcouch‚Äô,</p>
<p>‚Äã        ‚Äòpotted plant‚Äô, ‚Äòbed‚Äô, ‚Äòdining table‚Äô, ‚Äòtoilet‚Äô, ‚Äòtv‚Äô, ‚Äòlaptop‚Äô,</p>
<p>‚Äã        ‚Äòmouse‚Äô, ‚Äòremote‚Äô, ‚Äòkeyboard‚Äô, ‚Äòcell phone‚Äô, ‚Äòmicrowave‚Äô,</p>
<p>‚Äã        ‚Äòoven‚Äô, ‚Äòtoaster‚Äô, ‚Äòsink‚Äô, ‚Äòrefrigerator‚Äô, ‚Äòbook‚Äô, ‚Äòclock‚Äô,</p>
<p>‚Äã        ‚Äòvase‚Äô, ‚Äòscissors‚Äô, ‚Äòteddy bear‚Äô, ‚Äòhair drier‚Äô, ‚Äòtoothbrush‚Äô)</p>
<p>  def load_annotations(self, ann_file):</p>
<p>‚Äã    ‚Äú‚Äù‚ÄùLoad annotation from COCO style annotation file.</p>
<p>‚Äã    Args:</p>
<p>‚Äã      ann_file (str): Path of annotation file.</p>
<p>‚Äã    Returns:</p>
<p>```</p>
<p>‰∏ªË¶ÅÊòØÁúã‰∏Ä‰∏ã<code>@DATASETS.register_module()</code>Ëøô‰∏™Ë£ÖÈ•∞Âô®ÔºåÂÖ≥‰∫éË£ÖÈ•∞Âô®ÁöÑËØ≠Ê≥ïÊ∑±ÂÖ•ÁöÑÈÉ®ÂàÜ‰∏çÂÜçËØ¥ÔºåÊàë‰ª¨ËøôÈáåÂè™ÈúÄË¶ÅÁü•ÈÅìËøô‰∏™Â∞±Áõ∏ÂΩì‰∫éÊàë‰ª¨Ê≥®ÂÜå‰∫ÜÊúâÂÖ≥ÁöÑ<code>Rigistry</code>,‰ªéËøô‰∏™ÂÆö‰πâ‰πãÂêéÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÂ∞±ÂÉèÂâçÈù¢‰∏ÄÊ†∑<code>dataset_type = &#39;CocoDataset&#39;</code>Â∞±ÂèØ‰ª•Â∞ÜËøô‰∏™dataloaderÊîæÂà∞MMdet‰∏≠„ÄÇ</p>
<p>Âè¶Â§ñÂ¶ÇÊûúËá™Â∑±Ë¶ÅÂÜôdataloaderÁöÑËØùÔºåÁ±ªÈúÄË¶ÅÁªßÊâøÁöÑÂ∞±ÊòØ<code>from .custom import CustomDataset</code>‰∏≠ÁöÑ<code>CustomDataset</code>.</p>
<p>Âè¶Â§ñÊàë‰ª¨ËøòË¶ÅÊ≥®ÊÑèÁöÑÊòØ</p>
<h2 id="ÂõæÂÉèÂàÜÂâ≤ÁõòÁ¨¶ÂàáÁâáÊï∞ÊçÆÈ¢ÑÂ§ÑÁêÜÊìç‰Ωú"><a href="#ÂõæÂÉèÂàÜÂâ≤ÁõòÁ¨¶ÂàáÁâáÊï∞ÊçÆÈ¢ÑÂ§ÑÁêÜÊìç‰Ωú" class="headerlink" title="ÂõæÂÉèÂàÜÂâ≤ÁõòÁ¨¶ÂàáÁâáÊï∞ÊçÆÈ¢ÑÂ§ÑÁêÜÊìç‰Ωú"></a>ÂõæÂÉèÂàÜÂâ≤ÁõòÁ¨¶ÂàáÁâáÊï∞ÊçÆÈ¢ÑÂ§ÑÁêÜÊìç‰Ωú</h2><h3 id="Preface-2"><a href="#Preface-2" class="headerlink" title="Preface"></a>Preface</h3><p>Êò®Â§©Êú¨Êù•ÊâìÁÆóËÆ§ÁúüÂÅö‰∏Ä‰∏ãÂÖ≥‰∫éÁõòÁ¨¶ÂàÜÁ±ªÁöÑ‰ªªÂä°ÁöÑÔºåÊ≤°ÊÉ≥Âà∞ËøòÊòØÊúÄÁªàÊ≤°ÊúâÂºÑÔºåÂÖâÈ°æÁùÄÊêûMMdetectionÁöÑÊ∫êÁ†ÅËøô‰∫õ‰∏úË•ø‰∫ÜÊ≤°ÊúâÊù•ÂæóÂèäÊêûÔºåÁõÆÂâçÂ∑≤Áü•Êé•Âè£<code>inference_detector</code>ËøîÂõûÁöÑresultÁöÑÁªìÊûú‰∫ÜÔºåÂ∞±ÊòØ‰∏Ä‰∏™ÂÖÉÁªÑtupleÔºåÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÊòØÊ£ÄÊµãÊ°ÜÁöÑ‰ΩçÁΩÆÂíåÁΩÆ‰ø°Â∫¶ÔºåÁÑ∂ÂêéÁ¨¨‰∫å‰∏™ÂÖÉÁ¥†Â∞±ÊòØÂàÜÂâ≤ÁöÑÁªìÊûúÔºåÊòØ‰∏Ä‰∏™‰∏éÂõæÁâáÂ§ßÂ∞èÁõ∏ÂêåÁöÑ‰∏Ä‰∏™‰∫åÁª¥Áü©ÈòµÔºåÁî±TrueÂíåFalseÁªÑÊàê„ÄÇ</p>
<p>Êàë‰ª¨Êé•‰∏ãÊù•ÂºÄÂßãÂ∞ùËØïÂÅöÂõæÂÉèÁöÑÂ§ÑÁêÜ„ÄÇ</p>
<p>È¶ñÂÖàÊûÑÂª∫detectorÂæóÂà∞‰∏Ä‰∫õÂÖ∑‰ΩìÁªìÊûúÔºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/12/01/LqL6m6.png" alt></p>
<h3 id="ÂõæÂÉèÂ§ÑÁêÜÁÆóÊ≥ïÂàÜÊûê‰∏éÁÆóÊ≥ïÊ≠•È™§ÂÆûÁé∞"><a href="#ÂõæÂÉèÂ§ÑÁêÜÁÆóÊ≥ïÂàÜÊûê‰∏éÁÆóÊ≥ïÊ≠•È™§ÂÆûÁé∞" class="headerlink" title="ÂõæÂÉèÂ§ÑÁêÜÁÆóÊ≥ïÂàÜÊûê‰∏éÁÆóÊ≥ïÊ≠•È™§ÂÆûÁé∞"></a>ÂõæÂÉèÂ§ÑÁêÜÁÆóÊ≥ïÂàÜÊûê‰∏éÁÆóÊ≥ïÊ≠•È™§ÂÆûÁé∞</h3><h4 id="ÂØπ‰∫éÂàÜÂâ≤ÁöÑÁªìÊûúÈ¢ÑÂ§ÑÁêÜ"><a href="#ÂØπ‰∫éÂàÜÂâ≤ÁöÑÁªìÊûúÈ¢ÑÂ§ÑÁêÜ" class="headerlink" title="ÂØπ‰∫éÂàÜÂâ≤ÁöÑÁªìÊûúÈ¢ÑÂ§ÑÁêÜ"></a>ÂØπ‰∫éÂàÜÂâ≤ÁöÑÁªìÊûúÈ¢ÑÂ§ÑÁêÜ</h4><p>È¶ñÂÖàÔºåËøô‰∏™Ê£ÄÊµãÊ°ÜÁöÑÁªìÊûúÂπ∂‰∏çÊòØÈùûÂ∏∏Èù†Ë∞±,ÂæàÊòéÊòæÂ¶ÇÊûúÊàë‰ª¨ÈÄâÊã©ÂØπÂæóÂà∞ÁöÑbboxÊù•ËøõË°åÂùáÁ≠âÂàÜÂâ≤ÊòØÂÆåÂÖ®‰∏çË°åÁöÑÔºåÂàÜÂâ≤ÁöÑÁªìÊûúËøòË¶ÅÂ•Ω‰∏Ä‰∫õÁõ∏ÂØπËÄåË®ÄÔºåÊâÄ‰ª•Êàë‰ª¨ËøôÈáåÂèØ‰ª•ÈÄâÊã©ËÄÉËôë‰∏Ä‰∏ã‰ΩøÁî®ÂàÜÂâ≤Êï∞ÊçÆ‰ΩÜÊòØË¶ÅÂØπÂàÜÂâ≤Êï∞ÊçÆËøõË°å‰∏Ä‰∫õËΩ¨Êç¢ÊàñËÄÖÊòØËØ¥‰øÆË°•„ÄÇ</p>
<p>ÁõÆÂâç‰∏Ä‰∏™ÊÉ≥Ê≥ïÊòØÂØπ‰∫éÂàÜÂâ≤ÁªìÊûúÁöÑËæπÁïåÂèñÂπ≥ÂùáÂÄºÊù•ÂæóÂà∞4Êù°ÂèØ‰ª•Áî®ÁöÑËæπÁªÑÊàê‰∏Ä‰∏™Êñ∞ÁöÑbbox„ÄÇÁÑ∂ÂêéÊàë‰ª¨ÂÜçÂØπÂæóÂà∞ÁöÑÊñ∞ÁöÑbboxËøõË°åÂπ≥ÂùáÂàáÂàÜÊàê19Á≠â‰ªΩÔºåÂΩìÁÑ∂ËøôÈáåÊ≤°ÊúâËÄÉËôëÊòØÂê¶ÊòØÂÄæÊñúÁöÑÔºåÂõ†‰∏∫Êàë‰ª¨Ë¶ÅÂàáÂá∫ÁöÑÂõæÁâáË¶ÅÈÉΩÊòØÊ∞¥Âπ≥Áü©ÂΩ¢ÔºåÁÑ∂ÂêéÊ†πÊçÆÂùêÊ†áÂÖ≥Á≥ªÂ∞ÜÊàë‰ª¨ÂàáÈô§Áü©ÂΩ¢ÈÉ®ÂàÜ‰∏çÂåÖÂê´ÁõòÁ¨¶ÁöÑÈÉ®ÂàÜÊ∂ÇÈªëÔºàÊâÄ‰ª•ÂÜô‰ª£Á†ÅÊó∂‰∏çÂ¶®ÂÖàÂ∞ÜÈùûÁõòÁ¨¶ÈÉ®ÂàÜÊ∂ÇÈªë„ÄÇÔºâ</p>
<p>ÁõÆÂâçËÄÉËôëÁöÑÁÆóÊ≥ïÊ≠•È™§ÊòØÔºö</p>
<ul>
<li><p>Ê†πÊçÆÊûÑÂª∫detectorÂæóÂà∞ÁöÑÂàÜÂâ≤ÁªìÊûúÁü©ÈòµÔºåÊ†πÊçÆËæπÁïåÂπ≥ÂùáÊÄùÊÉ≥ÂæóÂà∞‰∏Ä‰∏™ bbox</p>
</li>
<li><p>ÂæóÂà∞bboxÁöÑÂõõ‰∏™È°∂ÁÇπÔºà‰∏ÄÂÆöÊòØbboxÁü©ÈòµÊúÄÈù†Â∑¶ÔºåÊúÄÈù†Âè≥ÔºåÊúÄÈù†‰∏äÔºåÊúÄÈù†‰∏ãÁöÑÂõõ‰∏™È°∂ÁÇπÔºâ„ÄÇ</p>
</li>
<li><p>Ê†πÊçÆÂõõ‰∏™È°∂ÁÇπÁöÑÂÖ≥Á≥ªÂæóÂà∞Â∑¶Âè≥ÁöÑ‰∏§ÁªÑËæπÁöÑÁÇπÔºåÁÑ∂ÂêéÊ†πÊçÆÂ∑¶Âè≥Á≠âÊØî‰æãÂÖ≥Á≥ªÊ†áÊ≥®Â•Ω‰∏≠Èó¥Ë¶ÅÂàáÂàÜÁöÑ18‰∏™ÁÇπÔºåËøûÂêåÁùÄÂ∑¶Âè≥‰∏§Á´ØÁÇπÈÉΩÊîæÂà∞‰∏Ä‰∏™ÂàóË°®ÈáåÔºå‰∏ä‰∏ãÈÉΩË¶ÅÊúâÔºåÔºàÂÖ∂ÂÆû‰πüÂ∞±ÈÄöËøáÁªôbboxÁöÑÁü©Èòµ‰∏ä‰∏ã‰∏§Êù°ËæπÁ≠âÂàÜÊàê19‰ªΩÔºå‰ª•Âà©‰∫éÂêéÁª≠ÁîªÂõæÂàáÂâ≤„ÄÇÔºâ</p>
</li>
<li><p>ÂºÄÂßãÂàáÂâ≤ÔºåÂπ∂ÈÄâÊã©Â∞ÜÂõæÁâá‰∏≠ÈùûÁõòÁ¨¶ÁöÑÈÉ®ÂàÜÊ∂ÇÈªëÔºàËøô‰∏™ÂèØ‰ª•Âú®ÂàáÂâ≤‰πãÂâçÂ∞±Ê∂ÇÈªë‰∫ÜÔºâ</p>
</li>
<li><p>ÂØπ‰∏ÄÂº†ÂõæÁâáÂæóÂà∞ÁöÑ19‰∏™ÁõòÁ¨¶Ê†á‰∏äÁßçÁ±ªÔºåËá≥‰∫éÁßçÁ±ªÂèØ‰ª•ÈÄâÊã©Âà©Áî®ÂΩìÊó∂ÁöÑjsonÊñá‰ª∂Êù•Ê†áÁßçÁ±ª„ÄÇ</p>
</li>
</ul>
<p>ÁªÜËäÇË°•ÂÖÖÔºö</p>
<ul>
<li><p>È¶ñÂÖàÈÄöËøáÂõõ‰∏™È°∂ÁÇπÂæóÂà∞‰∏Ä‰∏™Ê∞¥Âπ≥bboxÂèØ‰ª•ÂÜô‰∏Ä‰∏™ÂáΩÊï∞Â§çÁî®</p>
</li>
<li><p>ÁªôÂÆö‰∏§‰∏™È°∂ÁÇπÂ∞ÜÂÖ∂ËøûÁ∫øÁ≠âÂàÜÂâ≤Êàê19‰ªΩÂπ∂ËøîÂõûËØ•Áõ¥Á∫øÊâÄÂàÜÂùêÊ†áÂàóË°®ÔºåÊàñËÄÖËØ¥ÁªôÂÆöÂõõ‰∏™È°∂ÁÇπËøîÂõûÂàáÂàÜÂ•ΩÁöÑÂêÑ‰∏™Â∞èÁõòÁ¨¶È°∂ÁÇπÂùêÊ†áÂàóË°®ÔºàÊÑèÊÄùÂ∞±ÊòØÂàóË°®‰∏≠ÊØè‰∏™ÂÖÉÁ¥†ÈÉΩÊòØ‰∏Ä‰∏™ÂàÜÂ•ΩÁöÑÂ∞èÊ°ÜÁöÑÂõõ‰∏™È°∂ÁÇπÂùêÊ†áÔºâ„ÄÇ</p>
</li>
<li><p>Ê∂ÇÈªëÊìç‰ΩúÂÆö‰πâ‰∏Ä‰∏™ÂáΩÊï∞ÔºåËæìÂÖ•‰∏∫</p>
</li>
<li><p><strong>‰ª•‰∏äÊâÄÊúâÁöÑÊìç‰ΩúÈÉΩÊîæÂà∞‰∏Ä‰∏™Á±ªÈáåÁªü‰∏ÄÂ§ÑÁêÜÔºåÁÑ∂ÂêéÂà∞Êó∂ÂÄôË∞ÉÁî®Áõ¥Êé•ÊûÑÂª∫Á±ªÁöÑÊó∂ÂÄôÂ∞±Ë∞ÉÁî®‰∫ÜËøõË°åÂÆåÈ¢ÑÂ§ÑÁêÜÊìç‰Ωú„ÄÇ</strong></p>
</li>
</ul>
<h3 id="ÂØπ‰∫éÊôÆÈÄöÊ†áÊ≥®labelmeÊñá‰ª∂ÁöÑÁªìÊûúÈ¢ÑÂ§ÑÁêÜ"><a href="#ÂØπ‰∫éÊôÆÈÄöÊ†áÊ≥®labelmeÊñá‰ª∂ÁöÑÁªìÊûúÈ¢ÑÂ§ÑÁêÜ" class="headerlink" title="ÂØπ‰∫éÊôÆÈÄöÊ†áÊ≥®labelmeÊñá‰ª∂ÁöÑÁªìÊûúÈ¢ÑÂ§ÑÁêÜ"></a><strong>ÂØπ‰∫éÊôÆÈÄöÊ†áÊ≥®labelmeÊñá‰ª∂ÁöÑÁªìÊûúÈ¢ÑÂ§ÑÁêÜ</strong></h3><p>Âõ†‰∏∫LabelmeÊñá‰ª∂ÊòØÂØπ‰∫éÊØè‰∏Ä‰∏™ÂõæÁâáÈÉΩÊúâ‰∏Ä‰∏™ÂçïÁã¨ÁöÑjsonÊñá‰ª∂ÔºåÁÑ∂ÂêéÊØè‰∏Ä‰∏™jsonÊñá‰ª∂ÈÉΩ‰ºöÊúâÂêÑ‰∏™ÁõòÁ¨¶ÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØËøòÊúâÂÖ∑‰ΩìÁöÑÂùêÊ†áÁßçÁ±ªÔºåÊâÄ‰ª•ËøôÊ†∑‰∏ÄÊù•Áõ∏ÊØî‰∫éÂàÜÂâ≤ÁöÑÁªìÊûúË¶ÅÂ•ΩÂæàÂ§öÔºåÊâÄ‰ª•Êàë‰ª¨ËøôÈáåÊÄùË∑ØÁÆÄÂçïÂæàÂ§öÔºö</p>
<ul>
<li><p>ËØªÂèñ<code>.json</code>Êñá‰ª∂</p>
</li>
<li><p>ÂØπ‰∫éÂ∞ÜÊØè‰∏™Â∞èÁõòÁ¨¶Âõõ‰∏™È°∂ÁÇπËΩ¨Âåñ‰∏∫‰∏Ä‰∏™ËæÉÂ§ßÁöÑbbox</p>
</li>
<li><p>Â§ßÊ°ÜbboxÂÜÖÈùûÁõòÁ¨¶ÈÉ®ÂàÜÊ∂ÇÈªë</p>
</li>
<li><p>‰øùÂ≠òÔºåÊ≥®ÊÑèÂõæÁâáÊ†áÁ≠æÁöÑ‰øùÂ≠ò</p>
</li>
</ul>
<h3 id="ÊôÆÈÄölabelmeÊñá‰ª∂ËØªÂèñÂàÜÊûê"><a href="#ÊôÆÈÄölabelmeÊñá‰ª∂ËØªÂèñÂàÜÊûê" class="headerlink" title="ÊôÆÈÄölabelmeÊñá‰ª∂ËØªÂèñÂàÜÊûê"></a>ÊôÆÈÄölabelmeÊñá‰ª∂ËØªÂèñÂàÜÊûê</h3><h1 id="2021-12-2Êó•‰∏ãÂçàÊõ¥Êñ∞"><a href="#2021-12-2Êó•‰∏ãÂçàÊõ¥Êñ∞" class="headerlink" title="2021.12.2Êó•‰∏ãÂçàÊõ¥Êñ∞"></a>2021.12.2Êó•‰∏ãÂçàÊõ¥Êñ∞</h1><p>Êò®Â§©ÂÅö‰∫ÜÂÖ≥‰∫éÊï∞ÊçÆÈõÜÁöÑÊï¥ÁêÜÊìç‰Ωú‰ª•ÂèäÂÖ≥‰∫éÊï∞ÊçÆÁöÑËΩ¨ÂåñÊìç‰ΩúÔºåÁõÆÂâç‰∏Ä‰∏™ÊàêÁÜüÁöÑÊï∞ÊçÆÈõÜÂ∑≤ÁªèËΩ¨ÂåñÂÆåÊàêÔºå‰∏çËøá<strong>Áõ∏ÂÖ≥ËÆ∞ÂΩïÊñáÊ°£Ê≤°ÊúâÂÆåÊàê</strong>ÔºåÁ°ÆÂÆûÊ≤°ÊúâÊó∂Èó¥ËÆ∞ÂΩï‰∫ÜÔºåÁ≠âËøô‰∏§Â§©ËÆ∞ÂΩï‰∏Ä‰∏ã„ÄÇ<br>ÂêåÊó∂Êò®Â§©‰πüÂÜô‰∫ÜÂÖ≥‰∫éÊñá‰ª∂ÁöÑdataloaderÁöÑËØªÂèñÔºåËøôÊñπÈù¢ËøòÊòØËä±‰∫Ü‰∏Ä‰∫õÂøÉÊÄùÁöÑÔºåÁõÆÂâçÊé•‰∏ãÊù•ÁöÑ‰ªªÂä°Â∞±ÊòØÊûÑÂª∫Áõ∏ÂÖ≥Ê®°ÂûãÁÑ∂ÂêéËøõË°åÊúâÂÖ≥ÁöÑËÆ≠ÁªÉÔºåÂΩìÁÑ∂ËøôÈáåËÄÉËôë‰ΩøÁî®‰∏çÂêåÁöÑÊúâÂÖ≥Ê®°ÂûãÊØîÂ¶ÇËØ¥resnet101, regnetËøôÁ±ªÈÉΩÂ∞ùËØï‰∏Ä‰∏ãÔºåÂΩìÁÑ∂ÂèØ‰ª•Áõ¥Êé•‰ªétorchvision.modelsÁõ¥Êé•ÂØºÂÖ•ÊúâÂÖ≥ÁöÑÊ®°Âûã„ÄÇ</p>
<p>ËøôÈáåÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÊ≠£Â•ΩÊàë‰ª¨ÂèØ‰ª•Â∞ÜÊï¥‰∏™ÁöÑÊ®°ÂûãÁöÑËÆ≠ÁªÉÔºåÊï∞ÊçÆÂèØËßÜÂåñÔºåË∞ÉÊï¥ÂèØËßÜÂåñÁ≠âÁ≠âËøô‰∏ÄÁ≥ªÂàóÁöÑÊìç‰ΩúÈÉΩÂ∞ùËØïÂ≠¶‰π†Êìç‰Ωú‰∏ÄÈÅçÔºåËôΩÁÑ∂‰πãÂâç‰πüÊï¥ËøáÂ•ΩÂ§öÈÅçÔºå‰ΩÜÊòØËá™‰ªéÂ≠¶‰∫Ümmdetection‰πãÂêéÂ∞±ÂæàÂ∞ëÂºÑ‰∫ÜÔºåÂèØ‰ª•ÂÜçÊ∑±ÂÖ•Êé¢Á¥¢‰∏Ä‰∏ã„ÄÇ</p>
<p>Âè¶Â§ñ</p>
<p>‰∏Ä‰∫õÂèÇËÄÉÊñáÊ°£Ôºö</p>
<ul>
<li><a href="https://blog.csdn.net/weixin_36670529/article/details/105910572" target="_blank" rel="noopener">https://blog.csdn.net/weixin_36670529/article/details/105910572</a></li>
<li></li>
</ul>
<h1 id="2021-12-3Êó•-amp-amp-4Êó•-amp-amp-5Êó•Êõ¥Êñ∞"><a href="#2021-12-3Êó•-amp-amp-4Êó•-amp-amp-5Êó•Êõ¥Êñ∞" class="headerlink" title="2021.12.3Êó•&amp;&amp;4Êó•&amp;&amp;5Êó•Êõ¥Êñ∞"></a>2021.12.3Êó•&amp;&amp;4Êó•&amp;&amp;5Êó•Êõ¥Êñ∞</h1><h2 id="Preface-3"><a href="#Preface-3" class="headerlink" title="Preface"></a>Preface</h2><p>Êï∞ÊçÆÂ§ÑÁêÜÊúâÂÖ≥ÁöÑËÆ∞ÂΩïÊñáÊ°£Êò®Â§©Â∑≤ÁªèÊï¥ÁêÜÂÆåÊØï„ÄÇ‰∏∫‰∫ÜÂê∏ÂèñÊïôËÆ≠Ôºå‰ª•ÂêéËøòÊòØËæπÂÜôËæπÊï¥ÁêÜÊñáÊ°£ÊØîËæÉÂ•ΩÔºåÈô§ÈùûÊòØÊó∂Èó¥Ëøá‰∫éÁ¥ßÊÄ•„ÄÇ</p>
<p>‰ªäÂ§©Â∞±ÂÜô‰∏Ä‰∏ãÊúâÂÖ≥Ê®°ÂûãÔºåÊ†πÊçÆÁõÆÂâçÁöÑËøõÂ±ïÔºå‰ªªÂä°‰∏ªË¶ÅÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>ÂÖ≥‰∫éÈ™åËØÅÈõÜ„ÄÅËÆ≠ÁªÉÈõÜÁöÑÂàíÂàÜ</li>
<li>train_one_epochÂáΩÊï∞</li>
<li>ËÆ°ÁÆóÈ™åËØÅÈõÜÂáÜÁ°ÆÁéáÁöÑÂáΩÊï∞</li>
<li>‰ΩøÁî®Ëá™Â∑±ÁöÑÊï∞ÊçÆÈõÜ</li>
<li>‰ΩøÁî®tqdm</li>
</ul>
<h2 id="È™åËØÅÈõÜ„ÄÅËÆ≠ÁªÉÈõÜÁöÑÂàíÂàÜ"><a href="#È™åËØÅÈõÜ„ÄÅËÆ≠ÁªÉÈõÜÁöÑÂàíÂàÜ" class="headerlink" title="È™åËØÅÈõÜ„ÄÅËÆ≠ÁªÉÈõÜÁöÑÂàíÂàÜ"></a>È™åËØÅÈõÜ„ÄÅËÆ≠ÁªÉÈõÜÁöÑÂàíÂàÜ</h2><p>Â§ßÊ¶Ç8Ôºö2ÂàíÂàÜÔºåÂÖ∑‰ΩìÈöæÂ∫¶Âπ∂‰∏çÈ´ò„ÄÇ‰ªÖ‰ªÖÊòØËÆ∞Âæó‰ΩøÁî®ÂáΩÊï∞shutilÂ∞±OK‰∫Ü„ÄÇ</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""Êú¨Ê®°ÂùóÁî®‰∫éÂàíÂàÜÈ™åËØÅÈõÜÂíåÊµãËØïÈõÜÔºåÂ§ßÊ¶ÇÊØî‰æã‰∏∫8Ôºö2"""</span>

<span class="token keyword">import</span> shutil
<span class="token keyword">import</span> os
<span class="token keyword">import</span> random
<span class="token keyword">import</span> glob

<span class="token keyword">def</span> <span class="token function">move_file</span><span class="token punctuation">(</span>imgs<span class="token punctuation">,</span>  new_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''Ëøô‰∏™ÂáΩÊï∞ÊòØÁî®Êù•ÁßªÂä®ÂõæÁâá‰ªéÊóßË∑ØÂæÑÁßªÂà∞Êñ∞Ë∑ØÂæÑ'''</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>new_path<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># filelist = os.listdir(old_path) # ÂàóÂá∫ËØ•ÁõÆÂΩï‰∏ãÁöÑÊâÄÊúâÊñá‰ª∂,listdirËøîÂõûÁöÑÊñá‰ª∂ÂàóË°®ÊòØ‰∏çÂåÖÂê´Ë∑ØÂæÑÁöÑ„ÄÇ</span>
    filelist <span class="token operator">=</span> imgs
    <span class="token keyword">print</span><span class="token punctuation">(</span>filelist<span class="token punctuation">)</span>
    <span class="token keyword">for</span> file <span class="token keyword">in</span> filelist<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># file = file - "/home/lry/data/780b_std/"</span>
        src <span class="token operator">=</span> file
        dst <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>new_path<span class="token punctuation">,</span> file<span class="token punctuation">[</span>len<span class="token punctuation">(</span><span class="token string">'/home/lry/data/780b_singe_padded/'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'src:'</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'dst:'</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
        shutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># old_path = "/home/lry/data/780b_std"</span>

new_val <span class="token operator">=</span> <span class="token string">"/home/lry/data/780b_singe_padded_std/val"</span>
new_train <span class="token operator">=</span> <span class="token string">"/home/lry/data/780b_singe_padded_std/train"</span>

pics <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">"/home/lry/data/780b_singe_padded/*.jpg"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(pics)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>pics<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(pics[0][-30:])</span>
<span class="token comment" spellcheck="true"># print(len(pics))</span>
<span class="token comment" spellcheck="true"># print(pics[0][len("/home/lry/data/780b_std/"):-5] + ".jpg")</span>
<span class="token comment" spellcheck="true"># print(pics[0][:-4])</span>
<span class="token comment" spellcheck="true"># print(pics)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"moving...."</span><span class="token punctuation">)</span>
move_file<span class="token punctuation">(</span>pics<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">702</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train end!"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"moving..."</span><span class="token punctuation">)</span>
move_file<span class="token punctuation">(</span>pics<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">702</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_val<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"val end!"</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># if __name__ == '__main__':</span>
<span class="token comment" spellcheck="true">#     pics = glob.glob("/home/lry/data/780b_singe_padded_std/train/*.jpg")</span>
<span class="token comment" spellcheck="true">#     print(len(pics))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="train-one-epochÂáΩÊï∞"><a href="#train-one-epochÂáΩÊï∞" class="headerlink" title="train_one_epochÂáΩÊï∞"></a>train_one_epochÂáΩÊï∞</h2><p>Ëøô‰∏™ÂÖ∑‰ΩìÁöÑ‰∏çÂ§öËØ¥ÔºåËøôÈáåÂ∞±ÂÜô‰∏Ä‰∏ãÂ§ßËá¥ÁöÑÊµÅÁ®ãÔºö</p>
<ol>
<li>Âà©Áî®dataloaderÂä†ËΩΩÊï∞ÊçÆ</li>
<li>Êï∞ÊçÆ„ÄÅÊ®°ÂûãÈÉ®ÁΩ≤Âà∞cudaGPU‰∏≠</li>
<li>ÂâçÂêë‰º†Êí≠</li>
<li>ËÆ°ÁÆóloss</li>
<li>ÂèçÂêë‰º†Êí≠ËÆ°ÁÆóÊ¢ØÂ∫¶</li>
<li>Ë∞ÉÁî®‰ºòÂåñÂô®‰ºòÂåñÊõ¥Êñ∞ÊùÉÈáç</li>
<li>Âú®torch.no_gradÊù°‰ª∂‰∏ãËÆ°ÁÆóvalÂáÜÁ°ÆÁéá„ÄÇ</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">train_one_epoch</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> trainloader<span class="token punctuation">,</span> valloader<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> criterion<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    ËÆ≠ÁªÉ‰∏Ä‰∏™epochÔºåËøîÂõûËØ•epochÁöÑtrain_loss, train_acc, val_accÂáÜÁ°ÆÁéá
    '''</span>
    device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># train</span>
    correct <span class="token operator">=</span> <span class="token number">0</span>
    total <span class="token operator">=</span> <span class="token number">0</span>
    train_loss <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> data <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>trainloader<span class="token punctuation">)</span><span class="token punctuation">:</span>

        labels<span class="token punctuation">,</span> inputs <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>

        output <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>

        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>output<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>
        train_loss <span class="token operator">+=</span> loss
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>

    train_loss <span class="token operator">=</span> train_loss <span class="token operator">/</span> <span class="token number">2808</span>
    train_acc <span class="token operator">=</span> correct <span class="token operator">/</span> total

    <span class="token comment" spellcheck="true"># valÂáÜÁ°ÆÁéá</span>
    correct <span class="token operator">=</span> <span class="token number">0</span>
    total <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> data <span class="token keyword">in</span> valloader<span class="token punctuation">:</span>
            labels<span class="token punctuation">,</span> images <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
            outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
            _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
    val_acc <span class="token operator">=</span> correct <span class="token operator">/</span> total

    <span class="token keyword">return</span> train_loss<span class="token punctuation">,</span> train_acc<span class="token punctuation">,</span> val_acc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ÂÖ≥‰∫éÂØºÂÖ•Ê®°Âûã"><a href="#ÂÖ≥‰∫éÂØºÂÖ•Ê®°Âûã" class="headerlink" title="ÂÖ≥‰∫éÂØºÂÖ•Ê®°Âûã"></a>ÂÖ≥‰∫éÂØºÂÖ•Ê®°Âûã</h2><blockquote>
<p>2021.12.4Êõ¥Êñ∞„ÄÇ<br>ÊâÄÊúâÊ®°ÂûãÈÉΩÂú®torchvisionÂ∫ìÈáåÈù¢ÔºåÂÖ∂‰∏≠torchvision.models‰øùÂ≠òÂÆö‰πâ‰∫ÜËÆ∏ËÆ∏Â§öÂ§öÊàë‰ª¨ÈúÄË¶ÅÁöÑÊ®°Âûã„ÄÇÂÖ∑‰ΩìÂØºÂÖ•ÊñπÂºè‰πüÈùûÂ∏∏ÁÆÄÂçïÔºöÁõ¥Êé•<code>torchivision.models.resnet50(pretrained=True)</code>ÂÉèËøôÁ±ªÂ∞±Ë°å,ÂΩìÁÑ∂Â¶ÇÊûúÊàë‰ª¨ÊÉ≥Ë¶ÅÊîπ‰∏Ä‰∫õ‰∏úË•øÔºåÊØîÂ¶Çresnet50ÊúÄÂêéÊúâ‰∏Ä‰∏™‰∏ÄÂ±ÇÁöÑÂÖ®ËøûÊé•Â±ÇÔºåÊàë‰ª¨ÊÉ≥Ë¶ÅÊîπ‰∏Ä‰∏ãËøô‰∏™ÊúÄÂêéÂÖ®ËøûÊé•Â±ÇÁöÑËæìÂá∫,ÊØîÊñπËØ¥ÁõÆÂâçÊàëÊúâ14Á±ªËæìÂá∫‰ΩÜÊòØtorchvisionÂÆòÊñπÁöÑresnet50ÁöÑmodelÈªòËÆ§ÊúÄÂêéÁöÑÂÖ®ËøûÊé•Â±ÇÊòØ<code>nn.Linear(2048, 1000)</code>,Âõ†‰∏∫Ëøô‰∏™ÊòØÂü∫‰∫é<code>Imagenet</code>Êï∞ÊçÆÈõÜÁöÑ„ÄÇÈÇ£‰πàÂ¶ÇÊûúÊàë‰ª¨Ë¶ÅÊõ¥ÊîπÔºå‰∏Ä‰∏™ÊñπÊ≥ïÊòØÂèØ‰ª•Êü•ÁúãËØ•Ê®°ÂûãpytorchÂÆö‰πâÁöÑÊ∫ê‰ª£Á†ÅÔºåÂõ†‰∏∫<br><code>torchivision.models.resnet50(pretrained=True)</code>Ëøô‰∏™ÊàñËÄÖËØ¥ËøôÁ±ªÂáΩÊï∞ÊòØÊúâÁõ∏ÂÖ≥ÁöÑÂèÇÊï∞Áî®Êù•ÊîπÊúÄÂêéÂÖ®ËøûÊé•Â±ÇÁöÑoutputÁöÑÔºåÊàñËÄÖÂèØ‰ª•ÈÄâÊã© Áõ¥Êé•Êõ¥ÊîπÔºåÂ∞±ÂÉèÊàëËøôÈáå‰∏ÄÊ†∑Ôºö</p>
</blockquote>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ÂØºÂÖ•Ê®°Âûã</span>
model <span class="token operator">=</span> models<span class="token punctuation">.</span>resnet50<span class="token punctuation">(</span>pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(model)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>fc<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Êü•ÁúãÈªòËÆ§ÊúÄÂêé‰∏ÄÂ±ÇÂÖ®ËøûÊé•Â±ÇÁöÑÁªìÊûÑ</span>
<span class="token comment" spellcheck="true"># print(type(model.fc))</span>
<span class="token comment" spellcheck="true"># print(dict(model.fc.named_parameters()).keys())</span>
model<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>fc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Â∞±ÊòØÂà©Áî®<code>model.fc = nn.Linear(2048, num_classes)</code>Êù•ÂÆö‰πâÊúÄÂêé‰∏ÄÂ±ÇÁöÑÂèÇÊï∞ÔºåËøô‰∏™ÂæàÂ∑ßÂ¶ôÂÆûÈôÖ‰∏äÔºåÂ∞±Áõ∏ÂΩì‰∫éÈáçÊñ∞ÂÆö‰πâ‰∫Ü‰∏ÄÈÅçÔºåÊîπ‰∫ÜÁõ∏ÂÖ≥ÁöÑÁªìÊûÑ„ÄÇ</p>
<h2 id="ÂÖ≥‰∫éÈÉ®ÁΩ≤Âà∞cuda‰∏ä"><a href="#ÂÖ≥‰∫éÈÉ®ÁΩ≤Âà∞cuda‰∏ä" class="headerlink" title="ÂÖ≥‰∫éÈÉ®ÁΩ≤Âà∞cuda‰∏ä"></a>ÂÖ≥‰∫éÈÉ®ÁΩ≤Âà∞cuda‰∏ä</h2><blockquote>
<p>2021.12.4Êõ¥Êñ∞„ÄÇ</p>
</blockquote>
<p>Ëøô‰∏™Êàë‰πãÂâç‰∏ÄÁõ¥‰ΩøÁî®ÁöÑÊòØÂÖ≥‰∫é<code>device = torch.device(&quot;cuda:0&quot; if torch.cuda.is_available() else &quot;cpu&quot;)</code>Êù•ÊåáÂÆögpuËÆ≠ÁªÉÔºå‰ΩÜÊòØÁªìÊûúÂç¥Âπ∂‰∏çÊòØÊàëÊÉ≥ÁöÑÈÇ£Ê†∑Âú®ÁâπÂÆöÁöÑgpu‰∏äËÆ≠ÁªÉ. ËøôÈáåÁî®Âà∞‰∫Ü‰πãÂâçÁªÑÈïøÂª∫ËÆÆÁöÑ‰∏ÄÁßçÁî®Ê≥ïÔºå‰πüÊòØ‰ªñ‰ª¨Â∏∏Áî®ÁöÑÂÅöÊ≥ï,ÁîöËá≥ÂΩìÊó∂ÊàëËøòÂú®ÂàÜÂâ≤‰ªªÂä°‰∏≠ÂÅö‰∫ÜÁöÑÔºåËøôÊòØÊàëÂΩìÊó∂ÂàÜÂâ≤‰ªªÂä°ÁöÑËøêË°å‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-python"><code class="language-python">CUDA_VISIBLE_DEVICES<span class="token operator">=</span><span class="token number">1</span> python tools<span class="token operator">/</span>test<span class="token punctuation">.</span>py configs<span class="token operator">/</span>fenghuo<span class="token operator">/</span>mask_rcnn_r50_caffe_fpn_mstrain<span class="token operator">-</span>poly_1x_fenghuo<span class="token punctuation">.</span>py work_dirs<span class="token operator">/</span>mask_rcnn_r50_caffe_fpn_mstrain<span class="token operator">-</span>poly_1x_fenghuo<span class="token operator">/</span>latest<span class="token punctuation">.</span>pth  <span class="token operator">-</span><span class="token operator">-</span>eval bbox segm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ÂÆûÈôÖ‰∏ä‰πüÂ∞±ÊòØÂú®Áõ∏ÂÖ≥ËøêË°åpythonÂëΩ‰ª§ÂâçÂä†‰∫Ü<code>CUDA_VISIBLE_DEVICES=1</code>,CUDAÔºö1ÔºåÊúâÊó∂ÂÄôË¶Å‰ΩøÁî®Â§öÂº†Âç°Âπ∂Ë°åÂèØ‰ª•ÈÄâÊã©‰ΩøÁî®ÈÄóÂè∑ÂàÜÂºÄ‰∏§Âº†Âç°Ôºå‰æãÂ¶ÇÔºöCUDA_VISIBLE_DEVICES=1, 2„ÄÇ<br>ËøôÊ†∑ÂÅö‰πãÂêéÊ®°Âûã‰ºöËøõË°åÂçïÂç°ËÆ≠ÁªÉÔºåÂè¶Â§ñÂΩìÊàë‰ª¨Ë¶ÅËøõË°åÂÆûÊó∂ÁõëÊéßÊòæÂ≠òÂíåËøõÁ®ãÁõ∏ÂÖ≥‰ΩøÁî®ÁöÑÊó∂ÂÄôÊàë‰ª¨ÂèØ‰ª•ËÄÉËôë‰ΩøÁî®<code>watch</code>ÂëΩ‰ª§ÔºåÊØîÂ¶ÇËØ¥‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§Ôºö</p>
<pre class="line-numbers language-python"><code class="language-python">watch <span class="token operator">-</span>n <span class="token number">1</span> nvidia<span class="token operator">-</span>smi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Ëøô‰∏™‰ª£Ë°®ÊØè‰∏ÄÁßíÂà∑Êñ∞‰∏ÄÊ¨°ÊòæÂç°‰ΩøÁî®ÊÉÖÂÜµ„ÄÇ<br>ÂÖ≥‰∫éÂ§öÂç°ËøôÊñπÈù¢ÔºåÊòØ‰∏ÄÈó®Â§ßÂ≠¶ÈóÆÔºåÊöÇÊó∂ÂÖà‰∏çÂú®ËøôÈáåÂ±ïÂºÄËØ¥„ÄÇ</p>
<h2 id="ÂÖ≥‰∫ébatch-size"><a href="#ÂÖ≥‰∫ébatch-size" class="headerlink" title="ÂÖ≥‰∫ébatch_size"></a>ÂÖ≥‰∫ébatch_size</h2><blockquote>
<p>2021.12.4Êõ¥Êñ∞„ÄÇ<br>ÊúÄ‰∏ÄÂºÄÂßãÁöÑÊó∂ÂÄôË∞ÉÁöÑbatch_size=128Ôºå‰ΩÜÊòØÁªìÊûú‰∏Ä‰∏ãÂ≠êÊòæÂ≠ò‰∏çË∂≥ÂØºËá¥Á®ãÂ∫èÁªàÊ≠¢‰∫Ü„ÄÇÊú¨Êù•Êàë‰ª•‰∏∫Ëøô‰πàÂ•ΩÁöÑÊòæÂç°ÔºåÂÆ≥„ÄÇËøòÊòØÊàëÂ§™ËÇ§ÊµÖ‰∫ÜÔºåÊú¨Ë∫´ÂõæÁâáÂ§ßÂ∞èÂ∞±‰∏çÂ∞èÔºå‰∏ÄÂº†ÂõæÁâá<code>1800√ó180</code>Ëøô‰πàÂ§ßÁöÑÂõæÁâáÁ°ÆÂÆû(‰∏ÄËà¨ÁßëÁ†îÊàñÊòØ‰∏Ä‰∫õÁªèÂÖ∏Êï∞ÊçÆÈõÜËÆ≠ÁªÉÈÉΩÊòØ<code>224√ó224</code>ËøôÁ±ªÂ§ßÂ∞è),ÂÜçÂä†‰∏äËøô‰∫õÊòæÂ≠ò‰ªÄ‰πàÁöÑÂíåÂç°Êú¨Ë∫´ÊòØ2080tiËøòÊòØ3090Ê≤°ÊúâÂÖ≥Á≥ªÔºåËøô‰∏™ÂíåÊòæÂ≠òÊúâÂÖ≥Á≥ª„ÄÇËÄåËøô‰∏™ÊúçÂä°Âô®ÁöÑÊòæÂ≠òÊòØ12GÔºå‰πü‰∏çÊòØÂæàÂ§ßÔºåÊâÄ‰ª•ËØ¥ÊúÄÂ•ΩËøòÊòØ‰∏çË¶ÅÁî®Âà∞Ëøô‰πàÂ§ßÁöÑbatch_size‰∫ÜÔºåÂêéÊù•ÊîπÊàê<code>batch_size=4</code>,ÁªìÊûúÂèëÁé∞‰ªÖ‰ªÖ4‰∏™batch_sizeÂ∞±Ê∂àËÄó‰∫ÜÂá†‰πé4‰∏™GÁöÑÊòæÂ≠òÔºåÂêéÊù•ËØï‰∫ÜËØïÂ∞Übatch_sizeË∞ÉËá≥10ÔºåÁªìÊûúÂ∑Æ‰∏çÂ§öÂç†‰∫Ü8‰∏™GÁöÑÊòæÂ≠òÔºåÈ¢ÑËÆ°batch_size=16ËÉΩÂÆåÂÖ®Âç†Êª°Ôºå‰∏çËøáËøôÈáåÊ≤°ÊúâÁªßÁª≠ÂÆûÈ™å„ÄÇ</p>
</blockquote>
<h2 id="ÂÖ≥‰∫éÂπ∂Ë°åGPUËÆ°ÁÆó"><a href="#ÂÖ≥‰∫éÂπ∂Ë°åGPUËÆ°ÁÆó" class="headerlink" title="ÂÖ≥‰∫éÂπ∂Ë°åGPUËÆ°ÁÆó"></a>ÂÖ≥‰∫éÂπ∂Ë°åGPUËÆ°ÁÆó</h2><blockquote>
<p>2021.12.4Êõ¥Êñ∞„ÄÇ</p>
</blockquote>
<h2 id="ËøõÂ∫¶Êù°tqdm"><a href="#ËøõÂ∫¶Êù°tqdm" class="headerlink" title="ËøõÂ∫¶Êù°tqdm"></a>ËøõÂ∫¶Êù°tqdm</h2><blockquote>
<p>2021.12.4Êõ¥Êñ∞„ÄÇ<br>ËøõÂ∫¶Êù°ÊÄé‰πàÁî®ÔºåÁõÆÂâçÊàëÂè™‰ºöÁî®ÈùûÂ∏∏Âü∫Êú¨ÁöÑÔºåÂ∞±ÊòØÁî®‰∏Ä‰∏™<code>tqdm.tqdm()</code>ÂÜÖÂê´‰∏Ä‰∏™iterableÁöÑÂèÇÊï∞ÊØîÂ¶ÇÂàóË°®ËøôÁ±ª„ÄÇÁÑ∂ÂêéÊîæÂà∞forÈáåÈù¢ËøõË°åÂæ™ÁéØ„ÄÇÂΩìÁÑ∂Ëøô‰ºº‰πéÂØπÊàëÁõÆÂâçÊù•ËØ¥ÁÆóÊòØÂ§ü‰∫ÜÔºå‰ΩÜÊòØÂ¶ÇÊûúÊÉ≥Ë¶ÅÊõ¥Ëøõ‰∏ÄÊ≠•ÁöÑËØùÂèØ‰ª•ÁúãÁúã<a href="https://github.com/tqdm/tqdm" target="_blank" rel="noopener">GitHubÊ∫êÁ†ÅÂú∞ÂùÄ</a>Ôºå‰πüÊúâ‰∏Ä‰∏™ËæÉ‰∏∫ËØ¶ÁªÜÁöÑintroduction.</p>
</blockquote>
<h2 id="‰ªªÂä°ÂÆåÊàêÂêØÁ§∫‰∏é‰∏çË∂≥"><a href="#‰ªªÂä°ÂÆåÊàêÂêØÁ§∫‰∏é‰∏çË∂≥" class="headerlink" title="‰ªªÂä°ÂÆåÊàêÂêØÁ§∫‰∏é‰∏çË∂≥"></a>‰ªªÂä°ÂÆåÊàêÂêØÁ§∫‰∏é‰∏çË∂≥</h2><p>‰ª•‰∏äÁöÑ‰ªªÂä°ÊàêÂäüÂÜôÂÆåÔºåÊ®°Âûã‰πüÊàêÂäüË∑ëÂÆåÔºåÁªìÊûúÂ¶Ç‰∏ã(‰∏Ä‰∏™ÁÆÄÂçïÁöÑÁªìÊûú)Ôºö<br><a href="https://imagelol.com/image/LnBiyC" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/12/03/LnBiyC.png" alt></a><br>ÁõÆÂâçÂè™ÊòØÂÆåÊàê‰∫Ü‰∏Ä‰∏™Â∞èÁöÑdemoËÄåÂ∑≤ÔºåÊï¥‰∏™È°πÁõÆÊúâÁùÄÈùûÂ∏∏Â§öÁöÑ‰ªªÂä°ÈúÄË¶ÅÁªßÁª≠ÂÅöÔºåËøòÊúâÂ•ΩÂ§ö‰ª£Á†ÅÁªßÁª≠ÂÜô„ÄÇ<br>Êé•‰∏ãÊù•Ë¶ÅÂÆåÊàêÁöÑ‰ª•ÂèäÁõÆÂâçÂ∑•‰ΩúÁöÑ‰∏çË∂≥Âú®‰∫éÔºö</p>
<ul>
<li>Ê†áÁ≠æÊ≤°ÊúâÂêàÂπ∂Êù•ËÆ≠ÁªÉÔºåÁõÆÂâçÂêÑ‰∏™Â∞èÁ±ªÊ≤°ÊúâÂêàÂπ∂Ôºå‰ªÖ‰ªÖÊòØÊääÊØè‰∏Ä‰∏™Â∞èÁ±ªÈÉΩÂàÜÂºÄËÆ≠ÁªÉ‰∫Ü„ÄÇ</li>
<li>batch_sizeÂèØ‰ª•ÁªßÁª≠Ë∞ÉÈ´òÔºåÂõ†‰∏∫ÁõÆÂâçÁöÑ‰ªªÂä°Â∞ùËØïbatch_size=4ÂèØ‰ª•ÂèëÁé∞ÊòæÂ≠òÂç†Áî®‰∫Ü4000Â§öÂÖÜÔºåÁÑ∂ËÄåÊúçÂä°Âô®ÂçïÂç°2080tiÂèØ‰ª•‰ΩøÁî®Ë∂ÖËøá11000ÂÖÜÁöÑÊòæÂ≠òÔºåÊâÄ‰ª•ÂèØ‰ª•Â∞ùËØïË∑ëÊª°„ÄÇÂΩìÁÑ∂ÁõÆÂâç4Âº†Âç°Êúâ2Âº†ÊòØÁ©∫Èó≤ÁöÑÔºåÂ¶ÇÊûúË¶ÅËøõ‰∏ÄÊ≠•‰ΩøÁî®2Âº†Âç°Âπ∂Ë°åÁöÑËØùÔºåÂèØ‰ª•ËØïËØï<a href="https://pytorch.org/tutorials/intermediate/ddp_tutorial.html" target="_blank" rel="noopener">DISTRIBUTED DATA PARALLEL</a>,ÂΩìÁÑ∂Ëøô‰∏™ÂèØËÉΩÁõÆÂâçÊØîËæÉÈöæÔºå‰∏çËøáÂèØ‰ª•ÈÄÇÂΩìÁúã‰∏ÄÁúãÔºåËøôÊ†∑ÁöÑËØùbatch_sizeÁîöËá≥ÂèØ‰ª•Ë∞ÉÂà∞20„ÄÇ</li>
<li>ÁõÆÂâç‰ªÖ‰ªÖÂØºÂÖ•‰ΩøÁî®‰∫ÜÂÆòÊñπÁöÑresnet101ÔºåËøòÂèØ‰ª•ËØïËØïÂÖ∂‰ªñÊ®°Âûã</li>
<li>epochÂèØ‰ª•ÂæÄ‰∏äË∞ÉË∞ÉËØïËØï</li>
<li><strong>Ê®°Âûã„ÄÅËÆ≠ÁªÉlogËÆ∞Âæó‰øùÂ≠ò</strong>ÔºåÂåÖÊã¨‰∏Ä‰∫õÂÖ≥ÈîÆÁöÑÊï∞ÊçÆÂèØ‰ª•ÊîæÂà∞‰∏Ä‰∏™txtÊñáÊ°£ÈáåÈù¢ÔºåÂÜô‰ª£Á†ÅÂÆûÁé∞logÁöÑËÆ∞ÂΩïÔºåÂèØ‰ª•ÂèÇËÄÉmmdetectionÔºåÂÆÉÁöÑËÆ∞ÂΩïÂ∞±ÈùûÂ∏∏ËØ¶ÁªÜ„ÄÇ</li>
</ul>
<h2 id="‰øùÂ≠òËÆ≠ÁªÉÊùÉÈáçÔºåÊ®°ÂûãÊñπÊ≥ï"><a href="#‰øùÂ≠òËÆ≠ÁªÉÊùÉÈáçÔºåÊ®°ÂûãÊñπÊ≥ï" class="headerlink" title="‰øùÂ≠òËÆ≠ÁªÉÊùÉÈáçÔºåÊ®°ÂûãÊñπÊ≥ï"></a>‰øùÂ≠òËÆ≠ÁªÉÊùÉÈáçÔºåÊ®°ÂûãÊñπÊ≥ï</h2><blockquote>
<p>2021.12.4Êõ¥Êñ∞„ÄÇ</p>
</blockquote>
<p>‰∏ªË¶ÅÂèÇËÄÉÁöÑÂ∞±ÊòØ‰ª•‰∏ãÊñáÊ°£‰ª¨Ôºö</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/38056115" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/38056115</a></li>
<li><a href="https://blog.csdn.net/weixin_40522801/article/details/106563354" target="_blank" rel="noopener">https://blog.csdn.net/weixin_40522801/article/details/106563354</a></li>
<li><a href="https://pytorch.org/tutorials/beginner/saving_loading_models.html" target="_blank" rel="noopener">https://pytorch.org/tutorials/beginner/saving_loading_models.html</a></li>
</ul>
<p>ÂΩìÁÑ∂‰ª£Á†ÅÂÜôÂæóÂèÇËÄÉÁöÑÊúÄÂºÄÂßãÈÇ£ÁØáÁü•‰πéÊñáÊ°£ÔºåÊ®°Âûã‰øùÂ≠ò‰ª£Á†Å‰∏∫Ôºö</p>
<pre class="line-numbers language-python"><code class="language-python">launchTimestamp <span class="token operator">=</span> str<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'epoch'</span><span class="token punctuation">:</span> epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'state_dict'</span><span class="token punctuation">:</span> model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'best_loss'</span><span class="token punctuation">:</span> best_loss<span class="token punctuation">,</span>
                            <span class="token string">'optimizer'</span><span class="token punctuation">:</span> optimizer<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                           <span class="token string">'/home/lry/projects/mmdetection/lry/model_classification/checkpoints'</span> <span class="token operator">+</span> <span class="token string">'/resnet50-m-'</span> <span class="token operator">+</span> launchTimestamp <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> str<span class="token punctuation">(</span><span class="token string">"%.4f"</span> <span class="token operator">%</span> best_loss<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.pth.tar'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'model {launchTimestamp} saved!'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÁõÆÂâçËøòÊ≤°Â∞ùËØïËøáÂä†ËΩΩÊ®°ÂûãÔºåÂÖà‰∏çËÄÉËôë‰∫ÜÔºå‰ª•ÂêéÂÜçËØ¥Âêß„ÄÇ</p>
<h2 id="Ê®°ÂûãÁöÑÁ±ªÂà´ÂêàÂπ∂"><a href="#Ê®°ÂûãÁöÑÁ±ªÂà´ÂêàÂπ∂" class="headerlink" title="Ê®°ÂûãÁöÑÁ±ªÂà´ÂêàÂπ∂"></a>Ê®°ÂûãÁöÑÁ±ªÂà´ÂêàÂπ∂</h2><blockquote>
<p>2021.12.4Êõ¥Êñ∞„ÄÇ<br>ËøôÊñπÈù¢ÂÆûÈôÖ‰∏äÂ§ßÂ§öÈÉΩÊòØËÑèÊ¥ªÁ¥ØÊ¥ªÔºåÈúÄË¶Å‰ªãÁªçÁöÑÊÅ∞ÊÅ∞‰∏çÂ§™Â§ö.<br>‰∏çËøáÁ°ÆÂÆûÊØîËæÉËÄÉÈ™å‰ª£Á†ÅËÉΩÂäõ„ÄÇ</p>
</blockquote>
<h2 id="ÂÖ≥‰∫élr-scheduler"><a href="#ÂÖ≥‰∫élr-scheduler" class="headerlink" title="ÂÖ≥‰∫élr_scheduler"></a>ÂÖ≥‰∫élr_scheduler</h2><blockquote>
<p>2021.12.4Êõ¥Êñ∞„ÄÇ<br>ÂèÇËÄÉÊñáÊ°£Ôºö<a href="https://www.kaggle.com/isbhargav/guide-to-pytorch-learning-rate-scheduling" target="_blank" rel="noopener">https://www.kaggle.com/isbhargav/guide-to-pytorch-learning-rate-scheduling</a></p>
</blockquote>
<h2 id="ÂàÜÁ±ª‰ªªÂä°ÂÆåÊàêÂêØÁ§∫‰∏é‰∏çË∂≥"><a href="#ÂàÜÁ±ª‰ªªÂä°ÂÆåÊàêÂêØÁ§∫‰∏é‰∏çË∂≥" class="headerlink" title="ÂàÜÁ±ª‰ªªÂä°ÂÆåÊàêÂêØÁ§∫‰∏é‰∏çË∂≥"></a>ÂàÜÁ±ª‰ªªÂä°ÂÆåÊàêÂêØÁ§∫‰∏é‰∏çË∂≥</h2><p>Êú¨‰∫∫‰ªªÂä°Êé•ËøëÊî∂Â∞æÔºåÁõÆÂâçËøòÊòØÈùûÂ∏∏Êª°ÊÑèÁöÑÔºåËá≥Â∞ëÂØπ‰∫éÁªìÊûúÊù•ËØ¥Ôºö<br><a href="https://imagelol.com/image/LnTsAT" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/12/03/LnTsAT.png" alt></a></p>
<p>Êú¨Êù•ÊàëËøòÊÉ≥Ëøõ‰∏ÄÊ≠•Â∞ùËØï‰∏Ä‰∏ã‰∏çÂêåÁöÑÂ≠¶‰π†ÁéáÂíå‰∏Ä‰∫õÂÖ∂‰ªñÁöÑÊ®°ÂûãÔºå‰ΩÜÊòØÁî±‰∫éÊú¨Ê¨°ÂÆûÈ™åÂÆûÈôÖ‰∏äÂØπ‰∫é‰ªªÂä°Êú¨Ë∫´Â∑≤ÁªèÂÆåÊàê‰∫ÜÔºåÂ¶ÇÊûúÊÉ≥Ë¶ÅÊ∑±ÂÖ•Á†îÁ©∂ÂèØ‰ª•‰πãÂêéÂÅöÁ†îÁ©∂Êó∂ÊàñÊòØÊÉ≥Ë¶ÅÊé¢Á¥¢ÂÜçËØ¥‰∫Ü„ÄÇ<br>ËÄåÂØπ‰∫éÊú¨Ê¨°Êù•ÁúãÔºåÂÆûÈôÖ‰∏äÂÆåÂÖ®Â§ü‰∫Ü„ÄÇÊé•‰∏ãÊù•Â∞±Êàë‰∏™‰∫∫ËÄåË®ÄÔºåÊàëÊÉ≥ÂÅöÁöÑ‰∏Ä‰∫õ‰∏úË•øÂ∞±ÊòØÔºö</p>
<ul>
<li><a href="https://pytorch.org/tutorials/intermediate/ddp_tutorial.html" target="_blank" rel="noopener">DISTRIBUTED DATA PARALLEL</a>Â§öÂç°ËÆ≠ÁªÉÔºåÂèØ‰ª•ÈóÆ‰∏Ä‰∏ãÂº†Áª¥Â§©Â≠¶ÂßêÂ•πÁöÑÂ§öÂç°ËÆ≠ÁªÉÊòØÊÄé‰πàÂºÑÁöÑ„ÄÇ</li>
<li>Â§öÁúãÁúãÂà´‰∫∫ÂÜôÁöÑpytorch‰ª£Á†ÅÔºå‰∏çÁÆ°ÊòØÂì™‰∏ÄÁ±ªÁöÑ‰ª£Á†ÅÈÉΩË°å</li>
<li>ÂÖ≥‰∫éÂàÜÂâ≤‰ªªÂä°ÁöÑiouË∞ÉËäÇÊé¢Á¥¢</li>
<li>transformerËÆ∫ÊñáÁöÑÈòÖËØª‰∏éÂ≠¶‰π†ÔºåÂ∞§ÂÖ∂ÊòØÂÖ≥‰∫é</li>
<li>ÂÜôÂÆå‰∏äÈù¢ÁöÑÊñáÊ°£(<del>ÂîâÂ•ΩÂ§öÊñáÊ°£Ë¶ÅÂÜôÔºåÂèØ‰ª•ÂÖàÂÜôÂ§öÂç°ËÆ≠ÁªÉÈÉ®ÂàÜÔºöËæπÂ≠¶Â§öÂç°ËÆ≠ÁªÉËæπÂÜô</del>)</li>
<li>ÂØºÂÖ•Ê®°ÂûãÊñπÂºè‰πüÂèØ‰ª•ÁúãÁúã<code>hello-dian-ai</code>‰∏≠ÁöÑlab2ÂØºÂÖ•È¢ÑËÆ≠ÁªÉbackboneÁöÑÊñπÂºè„ÄÇ</li>
</ul>
<p>ËøôÊòØÊà™Ê≠¢Âà∞Êú¨Âë®‰∫îÊàëÁöÑËøô‰∫îÂ§©Áõ∏ÂÖ≥‰ªªÂä°‰ª£Á†ÅÂíåÊó∂Èó¥ÁöÑÁªüËÆ°Ôºåpython‰ª£Á†ÅÊï≤‰∫Ü16‰∏™Â∞èÊó∂ÔºåmarkdownÁ¨îËÆ∞ËÆ∞‰∫Ü5‰∏™Â∞èÊó∂„ÄÇÊÄª‰ΩìÊù•ÁúãÊú¨Âë®‰∏âÔºà12.1Êó•ÔºâÊï≤ÂæóÊúÄÂ§öÔºåÊï≤‰∫Ü7‰∏™Â§öÂ∞èÊó∂python‰ª£Á†Å„ÄÇÂØπ‰∫éÂ∑•‰ΩúËøòÊòØÈùûÂ∏∏Êª°ÊÑèÁöÑÔºÅ<br><a href="https://imagelol.com/image/LnT0pO" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://s6.jpg.cm/2021/12/03/LnT0pO.png" alt></a></p>
<h2 id="DISTRIBUTED-DATA-PARALLEL"><a href="#DISTRIBUTED-DATA-PARALLEL" class="headerlink" title="DISTRIBUTED DATA PARALLEL"></a>DISTRIBUTED DATA PARALLEL</h2><p>Reference:</p>
<ul>
<li><a href="https://pytorch.org/tutorials/intermediate/ddp_tutorial.html" target="_blank" rel="noopener">https://pytorch.org/tutorials/intermediate/ddp_tutorial.html</a></li>
<li><a href="https://github.com/tczhangzhi/pytorch-distributed" target="_blank" rel="noopener">https://github.com/tczhangzhi/pytorch-distributed</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/31558973" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/31558973</a></li>
<li><a href="https://www.cnblogs.com/jiangkejie/p/14603479.html" target="_blank" rel="noopener">https://www.cnblogs.com/jiangkejie/p/14603479.html</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/86441879" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/86441879</a></li>
</ul>
<h2 id="‰øÆÊîπÂàÜÂâ≤‰ªªÂä°ÁöÑIOU"><a href="#‰øÆÊîπÂàÜÂâ≤‰ªªÂä°ÁöÑIOU" class="headerlink" title="‰øÆÊîπÂàÜÂâ≤‰ªªÂä°ÁöÑIOU"></a>‰øÆÊîπÂàÜÂâ≤‰ªªÂä°ÁöÑIOU</h2><p>mmlabÊúÄÂàùÈªòËÆ§ÁöÑÈÖçÁΩÆ‰∏∫Ôºö</p>
<pre class="line-numbers language-python"><code class="language-python">    <span class="token comment" spellcheck="true"># model training and testing settings</span>
    train_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            allowed_border<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rpn_proposal<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            mask_size<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    test_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            score_thr<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
            mask_thr_binary<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êàë‰ª¨ËøôÈáåË∞ÉÊï¥‰∫ÜÁõ∏ÂÖ≥ÁöÑ<code>pos_iou_thread=0.9 or 0.8</code>,ÂΩìÁÑ∂rpnÂíårcnn‰ª•ÂèänmsÈÉ®ÂàÜÈÉΩË∞É‰∫Ü„ÄÇË∞ÉÊï¥Âêé‰∏∫Ôºö</p>
<pre class="line-numbers language-python"><code class="language-python">    <span class="token comment" spellcheck="true"># model training and testing settings</span>
    train_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            allowed_border<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rpn_proposal<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            assigner<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>
                pos_iou_thr<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>
                neg_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                min_pos_iou<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>dict<span class="token punctuation">(</span>
                type<span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>
                num<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>
                pos_fraction<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>
                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            mask_size<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">,</span>
            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    test_cfg<span class="token operator">=</span>dict<span class="token punctuation">(</span>
        rpn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            nms_pre<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rcnn<span class="token operator">=</span>dict<span class="token punctuation">(</span>
            score_thr<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>
            nms<span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            max_per_img<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
            mask_thr_binary<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ëøô‰∏™ÊñáÊ°£ÊòØÊàëÊâæconfigÊù•ÂõûÊâæÊúÄÂêéÂõûÊ∫ØÂà∞ÁöÑÔºåÁî±‰∫éÂõûÊ∫ØËøáÁ®ãÊØîËæÉÈ∫ªÁÉ¶ÔºåÊñá‰ª∂Âêç‰ªÄ‰πàÁöÑÂëΩÂêçÔºåÊúÄÂêé‰πüÊòØÊâæ‰∫ÜÊå∫ÈïøÊó∂Èó¥Êâæ<strong>ÂáÜ</strong>‰∫Ü„ÄÇÁ≤æÁ°Æ‰ΩçÁΩÆÂú®<code>/home/lry/projects/mmdetection/configs/_base_/models/mask_rcnn_r50_fpn.py</code>ËøôÈáå„ÄÇ</p>
<p>Âà´ÁöÑÊ≤°ÊúâÂ§™Â§öÊîπÂèòÔºåÂ∞±ËÆ≠ÁªÉÂÆå‰∫Ü‰πãÂêéÊúâ‰∫õ‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑinferenceÁöÑpython‰ª£Á†ÅÔºåÂú®<code>/home/lry/projects/mmdetection/lry/compare_sege.py</code>,‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""Êú¨Ê®°ÂùóÊòØ‰∏Ä‰∏™Â∞èdemoÔºåÁî®Êù•ÂØπÊØîÂçïÂº†ÂõæÁâáÁªìÊûúÊÄé‰πàÊ†∑"""</span>

<span class="token keyword">from</span> mmdet<span class="token punctuation">.</span>apis <span class="token keyword">import</span> init_detector<span class="token punctuation">,</span>inference_detector<span class="token punctuation">,</span> show_result_pyplot
<span class="token keyword">import</span> mmcv
<span class="token keyword">import</span> os
<span class="token keyword">import</span> glob
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor
<span class="token keyword">import</span> torch <span class="token keyword">as</span> t

<span class="token comment" spellcheck="true"># ÂÆö‰πâmodel</span>
config_file <span class="token operator">=</span> <span class="token string">"/home/lry/projects/mmdetection/configs/fenghuo/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo.py"</span>
checkpoint_file_before <span class="token operator">=</span> <span class="token string">"/home/lry/projects/mmdetection/work_dirs/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_fenghuo/latest.pth"</span>
checkpoint_file_after <span class="token operator">=</span> <span class="token string">"/home/lry/checkpoints/fenghuo/model_segementation_maskrcnn_10/latest.pth"</span>
model_before <span class="token operator">=</span> init_detector<span class="token punctuation">(</span>config_file<span class="token punctuation">,</span> checkpoint_file_before<span class="token punctuation">,</span>device<span class="token operator">=</span><span class="token string">"cuda:3"</span><span class="token punctuation">)</span>
model_after <span class="token operator">=</span> init_detector<span class="token punctuation">(</span>config_file<span class="token punctuation">,</span> checkpoint_file_after<span class="token punctuation">,</span>device<span class="token operator">=</span><span class="token string">"cuda:2"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># ÈÄâÂèñÈ™åËØÅÈõÜÁöÑÂâç10Âº†ÂõæÁâáËøõË°åÈ™åËØÅ</span>
imgs <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'/home/lry/data/780b_std/val/*.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span> img <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result_b <span class="token operator">=</span> inference_detector<span class="token punctuation">(</span>model_before<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
    model_before<span class="token punctuation">.</span>show_result<span class="token punctuation">(</span>img<span class="token punctuation">,</span> result_b<span class="token punctuation">,</span> out_file<span class="token operator">=</span>f<span class="token string">'/home/lry/checkpoints/fenghuo/compare/before/demo_val{i}.jpg'</span><span class="token punctuation">)</span>

    result_a <span class="token operator">=</span> inference_detector<span class="token punctuation">(</span>model_after<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
    model_after<span class="token punctuation">.</span>show_result<span class="token punctuation">(</span>img<span class="token punctuation">,</span> result_a<span class="token punctuation">,</span> out_file<span class="token operator">=</span>f<span class="token string">'/home/lry/checkpoints/fenghuo/compare/after/demo_val{i}.jpg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ËÆ≠ÁªÉÊ≥®ÊÑè"><a href="#ËÆ≠ÁªÉÊ≥®ÊÑè" class="headerlink" title="ËÆ≠ÁªÉÊ≥®ÊÑè"></a>ËÆ≠ÁªÉÊ≥®ÊÑè</h2><p>ËøôÈáåËÆ≠ÁªÉÁöÑÊó∂ÂÄô‰∏éÁªÑÈïø‰∫§ÊµÅÁöÑÊó∂ÂÄôÂèëÁé∞ÊúâËøô‰πà‰∏Ä‰∫õÈóÆÈ¢òÔºö</p>

            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">Ëµè</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">‰Ω†ÁöÑËµèËØÜÊòØÊàëÂâçËøõÁöÑÂä®Âäõ!</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">ÊîØ‰ªòÂÆù</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">ÂæÆ ‰ø°</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.bmp" class="reward-img" alt="ÊîØ‰ªòÂÆùÊâìËµè‰∫åÁª¥Á†Å">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.bmp" class="reward-img" alt="ÂæÆ‰ø°ÊâìËµè‰∫åÁª¥Á†Å">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone, qq, weibo, douban"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            
            
            
            <div class="reprint1">
                <p>
                    <span class="reprint1-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;Reprint policy:
                    </span>
                    <a href="https://lry89757.github.io" class="b-link-green">LRY's Blog</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2021/11/09/mmdet-project-of-fenghuo/" class="b-link-green">mmdet &amp;&amp; project of fenghuo</a>
                </p>
            </div>

        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2021/11/16/c-bi-ji-yun-suan-fu-chong-zai/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="C++Á¨îËÆ∞ËøêÁÆóÁ¨¶ÈáçËΩΩ">
                        
                        <span class="card-title">C++Á¨îËÆ∞ËøêÁÆóÁ¨¶ÈáçËΩΩ</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            ÊúÄËøë‰∫ãÊÉÖ‰∏ÄÂ§öËµ∑Êù•ÔºåÂèëÁé∞Ëá™Â∑±ÂÜôÂçöÂÆ¢Ê≤°Êúâ‰πãÂâçÈÇ£‰πàËÆ§Áúü‰∫ÜÔºåÂÜôÂæóÂê´ÈáëÈáè‰πüÊúâÊâÄ‰∏ãÈôçÔºå‰ª•ÂæÄÁÇπÂºÄ‰∏ÄÁúãÈÉΩÊòØ‰∏Ä‰∫õËá™ËÆ§‰∏∫ÈùûÂ∏∏ÊúâÊäÄÊúØÂê´Èáè„ÄÅÂÜôÂæóÈùûÂ∏∏Á≤æÂΩ©ÁöÑÂçöÊñáÔºå‰ΩÜÊòØÁé∞Âú®ÁÇπÂºÄ‰∏ÄÁúãËá™Â∑±ÊúÄËøëÂÜôÁöÑÂçöÊñáÔºåÊàëËá™Â∑±ÈÉΩ‰∏çÊÉ≥ÁÇπÂºÄÂÜçÁúãÁ¨¨‰∫åÈÅçÊØî‰πãÂâçÊï∑Ë°ç‰∫ÜÂ•ΩÂ§öÁúüÊòØÔºåÊó•ÂøóÊõ¥ÊòØÊó©Â∞±‰∏çÊõ¥Êñ∞‰∫ÜÔºåËøô‰∫õÈÉΩ‰∏çÊòØ‰ªÄ‰πàÂ•Ω‰π†ÊÉØ„ÄÇ‰ª•ÂêéË¶ÅÂèäÊó∂Ê≥®ÊÑèËá™Â∑±ÂçöÊñáÁöÑË¥®ÈáèÔºåÂà´Êï¥ÁöÑËá™Â∑±ÈÉΩÁúã‰∏çÊáÇÂ∞±Êõ¥Êó†Ê≥ïÊåáÊúõÂà´‰∫∫ËÉΩÂ§üÂ≠¶Âà∞‰∏úË•ø‰∫Ü„ÄÇ
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2021-11-16
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/C/" class="post-category" target="_blank">
                                    C++
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/C/" target="_blank">
                        <span class="chip bg-color">C++</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/11/06/rpc-explore/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="rpc explore">
                        
                        <span class="card-title">rpc explore</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            PrefaceÊúÄËøëÂú®Â≠¶C++ÔºåÊÉ≥Ë¶ÅÂÜô‰∏Ä‰∫õC++ÁöÑ‰ª£Á†ÅÔºå‰ΩÜÊòØÁõÆÂâçËã¶‰∫é‰∏çÁü•ÈÅìÂÜôÂï•ÊØîËæÉÂ•ΩÔºåÊÉ≥ÂÜô‰∏Ä‰∫õÊØîËæÉÂÆûÁî®ÁöÑÔºå‰ΩÜÊòØÁ°ÆÂÆûÊ≤°Âï•ËÉΩÂäõÔºåÊâæ‰∫ÜÊâæÈ°πÁõÆÁªÑÈïøjhyÔºå‰ªñÂëäËØâÊàëËØ¥ÊúÄËøë‰ªñÊúâ‰∏Ä‰∫õÂÜôËΩÆÂ≠êÁöÑÈúÄÊ±ÇÔºåÊ≠£Â•ΩÊàëÊãøËøô‰∏™ÁªÉ‰∏Ä‰∏ãÊâã„ÄÇ
rpcÔºåËøô‰∏™‰ºº‰πéÊ∂âÂèäÂà∞‰∫ÜÁΩëÁªúÁºñÁ®ã‚Ä¶‚Ä¶
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-11-06
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/C/" class="post-category" target="_blank">
                                    C++
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/C/" target="_blank">
                        <span class="chip bg-color">C++</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'From: LRY's Blog<br />'
            + 'Author: ÈÄØÊ∂¶Èõ®<br />'
            + 'Link: <a href="' + url + '">' + url + '</a><br />'
            + 'Êú¨ÊñáÁ´†Ëëó‰ΩúÊùÉÂΩí‰ΩúËÄÖLurunyuÊâÄÊúâÔºå‰ªª‰ΩïÂΩ¢ÂºèÁöÑËΩ¨ËΩΩÈÉΩËØ∑Ê≥®ÊòéÂá∫Â§Ñ„ÄÇ';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC ÊÇ¨ÊµÆÊåâÈíÆ. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4, h5, h6, h7'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5, h6, h7').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ‰øÆÂ§çÊñáÁ´†Âç°Áâá div ÁöÑÂÆΩÂ∫¶. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // ÂàáÊç¢TOCÁõÆÂΩïÂ±ïÂºÄÊî∂Áº©ÁöÑÁõ∏ÂÖ≥Êìç‰Ωú.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


        <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            Copyright&copy; 2021 ÈÄØÊ∂¶Èõ®. 

            <br>
            <span id="sitetime"></span><span class="my-face">·É¶„Çù‚ó°‚ïπ)„Éé‚ô°</span>
            <br>

            

            
                    
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        ÊÄªËÆøÈóÆÈáè: <span id="busuanzi_value_site_pv" class="white-color"></span>
                    
        
                    
                        <span id="busuanzi_container_site_uv" style='display:none'></span>
                        ‰∫∫Ê¨°&nbsp; | &nbsp;ËÆøÂÆ¢‰∫∫Êï∞: <span id="busuanzi_value_site_uv" class="white-color"></span> ‰∫∫
                    
    
            

            
                &nbsp; | &nbsp;Â≠óÊï∞ÁªüËÆ°:&nbsp;
                <span class="white-color">213.8k</span> Â≠ó
            

            
            <br>

        </div>

        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/LRY89757" class="tooltipped" target="_blank" data-tooltip="ËÆøÈóÆÊàëÁöÑGitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>


 
    <a href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=lry89757@gmail.com" class="tooltipped" target="_blank" data-tooltip="ÈÇÆ‰ª∂ËÅîÁ≥ªÊàë" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>




    <a href="https://zhihu.com/people/yi-ran-fan-te-xi-57-88" class="tooltipped" target="_blank" data-tooltip="ËÆøÈóÆÊàëÁöÑÁü•‰πé" data-position="top" data-delay="50">
        <i class="fa fa-inverse">Áü•</i>
    </a>



    <a href="http://wpa.qq.com/msgrd?v=3&uin=1785435713&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="ËÆøÈóÆÊàëÁöÑQQÁ©∫Èó¥" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS ËÆ¢ÈòÖ" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>

    </div>
</footer>

<div class="progress-bar"></div>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();

        /* Date.UTC() -- ËøîÂõûdateÂØπË±°Ë∑ù‰∏ñÁïåÊ†áÂáÜÊó∂Èó¥(UTC)1970Âπ¥1Êúà1Êó•ÂçàÂ§ú‰πãÈó¥ÁöÑÊØ´ÁßíÊï∞(Êó∂Èó¥Êà≥)
        year - ‰Ωú‰∏∫dateÂØπË±°ÁöÑÂπ¥‰ªΩÔºå‰∏∫4‰ΩçÂπ¥‰ªΩÂÄº
        month - 0-11‰πãÈó¥ÁöÑÊï¥Êï∞ÔºåÂÅö‰∏∫dateÂØπË±°ÁöÑÊúà‰ªΩ
        day - 1-31‰πãÈó¥ÁöÑÊï¥Êï∞ÔºåÂÅö‰∏∫dateÂØπË±°ÁöÑÂ§©Êï∞
        hours - 0(ÂçàÂ§ú24ÁÇπ)-23‰πãÈó¥ÁöÑÊï¥Êï∞ÔºåÂÅö‰∏∫dateÂØπË±°ÁöÑÂ∞èÊó∂Êï∞
        minutes - 0-59‰πãÈó¥ÁöÑÊï¥Êï∞ÔºåÂÅö‰∏∫dateÂØπË±°ÁöÑÂàÜÈíüÊï∞
        seconds - 0-59‰πãÈó¥ÁöÑÊï¥Êï∞ÔºåÂÅö‰∏∫dateÂØπË±°ÁöÑÁßíÊï∞
        microseconds - 0-999‰πãÈó¥ÁöÑÊï¥Êï∞ÔºåÂÅö‰∏∫dateÂØπË±°ÁöÑÊØ´ÁßíÊï∞ */

        var t1 = Date.UTC(2021, 07, 29, 00, 00, 00); //Âåó‰∫¨Êó∂Èó¥2019-8-1 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes *
            minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "Êú¨Á´ôÂ∑≤ÂãâÂº∫ËøêË°å " + diffYears + " Âπ¥ " + diffDays + " Â§© " + diffHours +
            " Â∞èÊó∂ " + diffMinutes + " ÂàÜÈíü " + diffSeconds + " Áßí" ;
    } /*Âõ†‰∏∫Âª∫Á´ôÊó∂Èó¥ËøòÊ≤°Êúâ‰∏ÄÂπ¥ÔºåÂ∞±Â∞Ü‰πãÊ≥®ÈáäÊéâ‰∫Ü„ÄÇÈúÄË¶ÅÁöÑÂèØ‰ª•ÂèñÊ∂à*/
    siteTime();
</script>






        <!-- ÊêúÁ¥¢ÈÅÆÁΩ©Ê°Ü -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
        <!-- ÂõûÂà∞È°∂ÈÉ®ÊåâÈíÆ -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


        <script src="https://cdn.bootcss.com/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdn.bootcss.com/masonry/4.2.2/masonry.pkgd.min.js"></script>
        <script src="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.js"></script>
        <script src="https://cdn.bootcss.com/scrollprogress/3.0.2/scrollProgress.min.js"></script>
        <script src="https://cdn.bootcss.com/lightgallery/1.6.12/js/lightgallery-all.min.js"></script>
        <script src="/js/matery.js"></script>

        <!-- Global site tag (gtag.js) - Google Analytics -->



        
            <script src="/libs/others/clicklove.js"></script>
        

        
            <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        

        
        <script type="text/javascript">
            var OriginTitile = document.title,
                st;
            document.addEventListener("visibilitychange", function () {
                document.hidden ? (document.title = "Áúã‰∏çËßÅÊàëüôà~Áúã‰∏çËßÅÊàëüôà~", clearTimeout(st)) : (document.title =
                    "(‡πë‚Ä¢ÃÄ„ÖÇ‚Ä¢ÃÅ) ‚úßË¢´ÂèëÁé∞‰∫ÜÔΩû", st = setTimeout(function () {
                        document.title = OriginTitile
                    }, 3e3))
            })
        </script>

        <!-- Èº†Ê†áÁÇπÂáªÁÉüËä±ÁàÜÁÇ∏ÊïàÊûú   -->
        
            <canvas class="fireworks" style="position: fixed; left: 0; top: 0; z-index: 1; pointer-events: none;"></canvas>
            <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
            <script type="text/javascript" src="/js/fireworks.js"></script>
        

        <!-- ËÉåÊôØÈõ™Ëä±È£òËêΩÁâπÊïà -->
        

        <!-- Èº†Ê†áÁÇπÂáªÊñáÂ≠óÁâπÊïà -->
        
            <script src="/js/wenzi.js" type="text/javascript"></script>
        

        <!-- ËÉåÊôØÈõ™Ëä±È£òËêΩÁâπÊïà  -->
        
            <script type="text/javascript">
                var windowWidth = $(window).width();
                if (windowWidth > 768) {
                    document.write('<script type="text/javascript" src="/js/xuehuapiaoluo.js"><\/script>');
                }
            </script>
        

        <!-- Âú®Á∫øËÅäÂ§©Â∑•ÂÖ∑   -->
        
            <script src="//code.tidio.co/xxxxxxxxxxxxxxxxxxxxxxxxxxx.js"></script>
            <!--  Âú®Á∫øËÅäÂ§©‰ΩçÁΩÆËá™ÂÆö‰πâ    -->
            <script> 
                $(document).ready(function () {

                    setInterval(change_Tidio, 50);  
                    function change_Tidio() { 

                        var tidio=$("#tidio-chat iframe");
                        if(tidio.css("display")=="block"&& $(window).width()>977 ){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"80px":"20px";   
                            document.getElementById("tidio-chat-iframe").style.right="-15px";   
                            document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        } 
                        else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                            document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        }
                        else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        }

                        if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                            document.getElementById("tidio-chat-iframe").style.zIndex="998";
                        }
                    } 
                }); 
            </script>
        

        <!-- ËÉåÊôØ canvas-nest  -->
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" color="0,0,255" pointColor="0,0,255" opacity= "0.8" zIndex="--1" count="150"src="/libs/background/canvas-nest.js"><\/script>');
            }
            </script>
        

        <!-- ËÉåÊôØÈùôÊ≠¢ÂΩ©Â∏¶  -->
        

        <!-- ËÉåÊôØÂä®ÊÄÅÂΩ©Â∏¶ -->
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" src="/libs/background/ribbon-dynamic.js"><\/script>');
            }
            </script>
        

    <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":200},"mobile":{"show":false},"react":{"opacity":0.7}});</script><script>!function(e){var r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function t(){for(var c=0;c<r.length;c++)t=r[c],void 0,0<=(n=t.getBoundingClientRect()).top&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=r[c];t=o,n=function(){r=r.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}t(),e.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(t,e)})}(this);</script></body>
</html>